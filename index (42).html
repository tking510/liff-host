<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº‹æ¥­åˆ¥ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ v10 - ç´¯ç©ãƒãƒ¼ã‚¸å¯¾å¿œ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f1f5f9;min-height:100vh}
.container{max-width:1400px;margin:0 auto;padding:20px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px}
.header h1{font-size:24px;color:#1e293b}
.header-actions{display:flex;gap:10px;flex-wrap:wrap}
.card{background:white;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.06);padding:20px;margin-bottom:20px}
.tabs{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap;align-items:center}
.tab{padding:10px 18px;border-radius:10px;border:none;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;background:#e2e8f0;color:#475569}
.tab:hover{background:#cbd5e1}
.tab.active{background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:white}
.btn{padding:10px 20px;border-radius:10px;border:none;cursor:pointer;font-weight:600;transition:all 0.2s;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:white}
.btn-secondary{background:#f1f5f9;color:#475569}
.btn-danger{background:#fee2e2;color:#dc2626}
.btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:24px}
.summary-card{border-radius:12px;padding:14px;color:white;background:linear-gradient(135deg,#3b82f6,#1d4ed8)}
.summary-card h3{font-size:10px;opacity:0.9;margin-bottom:4px;text-transform:uppercase}
.summary-card .value{font-size:18px;font-weight:700}
.chart-container{height:300px;margin:20px 0}
.pie-chart-container{height:250px;max-width:300px}
.period-selector{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;align-items:center}
.period-btn{padding:6px 14px;border-radius:8px;border:none;cursor:pointer;font-size:12px;background:#f1f5f9;color:#64748b;transition:all 0.2s}
.period-btn.active{background:#3b82f6;color:white}
.period-btn:hover{background:#e2e8f0}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000}
.modal-content{background:white;border-radius:16px;padding:30px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}
.upload-zone{border:2px dashed #cbd5e1;border-radius:12px;padding:40px;text-align:center;cursor:pointer;transition:all 0.2s}
.upload-zone:hover,.upload-zone.dragover{border-color:#3b82f6;background:#eff6ff}
.hidden{display:none!important}
.table-container{overflow-x:auto;max-height:500px}
table{width:100%;border-collapse:collapse;font-size:12px}
th,td{padding:8px 10px;text-align:left;border-bottom:1px solid #e2e8f0}
th{background:#f8fafc;font-weight:600;color:#64748b;position:sticky;top:0}
tr:hover{background:#f8fafc}
.text-right{text-align:right}
.text-green{color:#16a34a}
.text-red{color:#dc2626}
input,select{padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;width:100%}
input:focus,select:focus{outline:none;border-color:#3b82f6}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:13px;color:#64748b;margin-bottom:6px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.section-title{font-size:16px;font-weight:600;color:#1e293b;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}
.kpi-item{background:#f8fafc;border-radius:10px;padding:12px}
.kpi-item .label{font-size:10px;color:#64748b;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.kpi-item .val{font-size:16px;font-weight:700;color:#1e293b}
.kpi-item .val.negative{color:#dc2626}
footer{text-align:center;color:#94a3b8;font-size:11px;margin-top:30px;padding:20px}
.totals-section{background:linear-gradient(135deg,#0f172a,#1e293b);border-radius:16px;padding:20px;margin-bottom:20px;color:white}
.totals-section .section-title{color:white}
.totals-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}
.total-card{background:rgba(255,255,255,0.1);border-radius:12px;padding:16px;backdrop-filter:blur(10px)}
.total-card h4{font-size:11px;opacity:0.8;margin-bottom:8px;text-transform:uppercase}
.total-card .main-val{font-size:22px;font-weight:700;margin-bottom:4px}
.total-card .sub-val{font-size:12px;opacity:0.7}
.crypto-section{background:linear-gradient(135deg,#1e3a5f,#2d5a87);border-radius:16px;padding:20px;margin-bottom:20px;color:white}
.crypto-section .section-title{color:white}
.crypto-flex{display:flex;flex-wrap:wrap;gap:20px;align-items:flex-start}
.crypto-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;flex:1}
.crypto-card{background:rgba(255,255,255,0.95);border-radius:10px;padding:12px;color:#1e293b}
.crypto-card h5{font-size:10px;color:#64748b;margin-bottom:4px}
.crypto-card .crypto-val{font-size:16px;font-weight:700}
.crypto-card .crypto-pct{font-size:11px;color:#64748b}
.provider-section{background:linear-gradient(135deg,#4a1d6a,#6b2d8a);border-radius:16px;padding:20px;margin-bottom:20px;color:white}
.provider-section .section-title{color:white}
.daily-stats-section{background:linear-gradient(135deg,#1e3a5f,#2d5a87);border-radius:16px;padding:20px;margin-bottom:20px;color:white}
.daily-stats-section .section-title{color:white;margin-bottom:15px}
.daily-stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;max-height:400px;overflow-y:auto}
.payment-stats-section{background:linear-gradient(135deg,#2d5a47,#3d7a67);border-radius:16px;padding:20px;margin-bottom:20px;color:white}
.payment-stats-section .section-title{color:white;margin-bottom:15px}
.payment-stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:12px;max-height:500px;overflow-y:auto}
.payment-month-card{background:rgba(255,255,255,0.1);border-radius:10px;padding:12px;backdrop-filter:blur(5px)}
.payment-month-title{font-weight:bold;font-size:1rem;margin-bottom:10px;color:#90EE90;border-bottom:1px solid rgba(255,255,255,0.2);padding-bottom:5px}
.payment-type-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.1);font-size:0.85rem}
.payment-type-row:last-child{border-bottom:none}
.payment-type-label{color:#b0e0b0;font-weight:500;min-width:70px}
.payment-type-values{display:flex;gap:10px;flex-wrap:wrap}
.payment-stat{color:white;font-size:0.8rem}
.payment-stat-label{color:#a0d0a0;font-size:0.7rem}
.daily-stat-card{background:rgba(255,255,255,0.1);border-radius:10px;padding:12px;border:1px solid rgba(255,255,255,0.2)}
.daily-stat-card .date{font-weight:bold;font-size:14px;margin-bottom:8px;color:#7dd3fc}
.daily-stat-card .stats{display:grid;grid-template-columns:1fr 1fr;gap:6px;font-size:12px}
.daily-stat-card .stat-item{display:flex;justify-content:space-between}
.daily-stat-card .stat-label{color:rgba(255,255,255,0.7)}
.daily-stat-card .stat-val{font-weight:bold}
.provider-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
.provider-card{background:rgba(255,255,255,0.15);border-radius:10px;padding:14px;backdrop-filter:blur(10px)}
.provider-card h5{font-size:12px;margin-bottom:8px;font-weight:600}
.provider-card .provider-stats{display:grid;grid-template-columns:1fr 1fr;gap:6px;font-size:11px}
.provider-card .stat-item{background:rgba(255,255,255,0.1);border-radius:6px;padding:6px 8px}
.provider-card .stat-label{opacity:0.7;font-size:9px}
.provider-card .stat-val{font-weight:600}
.game-section{background:linear-gradient(135deg,#1a472a,#2d6a4f);border-radius:16px;padding:20px;margin-bottom:20px;color:white}
.game-section .section-title{color:white}
.view-toggle{display:flex;gap:8px;margin-bottom:16px}
.view-toggle .toggle-btn{padding:8px 16px;border-radius:8px;border:2px solid #e2e8f0;background:white;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.2s}
.view-toggle .toggle-btn.active{border-color:#3b82f6;background:#eff6ff;color:#1d4ed8}
.chart-row{display:flex;gap:20px;flex-wrap:wrap}
.chart-row .pie-wrapper{flex:0 0 280px}
.chart-row .list-wrapper{flex:1;min-width:200px}
  </style>
<script src="data.js"></script>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ“Š äº‹æ¥­åˆ¥ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ v10 <span style="font-size:14px;background:#10b981;color:white;padding:2px 8px;border-radius:4px;margin-left:8px">ç´¯ç©ãƒãƒ¼ã‚¸å¯¾å¿œ</span></h1>
    <div class="header-actions">
      <span id="sync-status" style="font-size:12px;color:#10b981;margin-right:10px">ğŸ’¾ èª­è¾¼ä¸­...</span>
      <button class="btn btn-secondary" onclick="exportDataJS()" style="background:#10b981;color:white">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ä¿å­˜(å…±æœ‰ç”¨)</button>
      <button class="btn btn-primary" onclick="showUploadModal()">ğŸ“¤ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
      <button class="btn btn-primary" onclick="showReportPromptModal()" style="background:#8b5cf6">ğŸ“ å–¶æ¥­å ±å‘Šæ›¸</button>
      <button class="btn btn-primary" onclick="openTelegramModal()" style="background:linear-gradient(135deg, #0088cc 0%, #00aced 100%)">ğŸ“¨ Telegramé€ä¿¡</button>
      <button class="btn btn-secondary" onclick="createShareLink()">ğŸ”— å…±æœ‰ãƒªãƒ³ã‚¯</button>
      <button class="btn btn-secondary" onclick="showAddBusinessModal()">â• äº‹æ¥­è¿½åŠ </button>
      <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸</button>
    </div>
  </div>
  <div class="tabs" id="business-tabs"></div>
  <div class="view-toggle">
    <button class="toggle-btn active" onclick="setViewMode('period')" id="view-period">ğŸ“… æœŸé–“åˆ¥</button>
    <button class="toggle-btn" onclick="setViewMode('total')" id="view-total">ğŸ“Š å…¨æœŸé–“ãƒˆãƒ¼ã‚¿ãƒ«</button>
  </div>
  <div id="period-selector" class="period-selector"></div>
  <div id="totals-section" class="totals-section hidden">
    <div class="section-title">ğŸ“Š å…¨æœŸé–“ãƒˆãƒ¼ã‚¿ãƒ«ãƒ»å¹³å‡</div>
    <div id="totals-grid" class="totals-grid"></div>
  </div>
  <div id="summary-section"></div>
  
  <div class="card">
    <div class="section-title">ğŸ“ˆ æ¨ç§»ã‚°ãƒ©ãƒ•</div>
    <div class="chart-container"><canvas id="main-chart"></canvas></div>
  </div>
  
  <!-- ç¶™ç¶šKPIæ¨ç§»ã‚°ãƒ©ãƒ•ï¼ˆã‚¹ãƒ­å¤©ç”¨ï¼‰ -->
  <div id="retention-chart-section" class="card hidden">
    <div class="section-title">ğŸ“Š ç¶™ç¶šãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨ç§»</div>
    <div class="chart-container"><canvas id="retention-chart"></canvas></div>
  </div>
  
  <div id="kpi-sections"></div>
  
  <!-- ä»®æƒ³é€šè²¨éŠ˜æŸ„åˆ¥ï¼ˆå††ã‚°ãƒ©ãƒ•ä»˜ãï¼‰ -->
  <div id="crypto-section" class="crypto-section hidden">
    <div class="section-title">ğŸª™ ä»®æƒ³é€šè²¨éŠ˜æŸ„åˆ¥</div>
    <div class="crypto-flex">
      <div class="pie-wrapper"><div class="pie-chart-container"><canvas id="crypto-pie-chart"></canvas></div></div>
      <div class="list-wrapper"><div id="crypto-grid" class="crypto-grid"></div></div>
    </div>
  </div>
  
  <!-- ã‚²ãƒ¼ãƒ ç¨®åˆ¥ï¼ˆãƒ‘ãƒãƒ³ã‚³ãƒ»ãƒ‘ãƒã‚¹ãƒ­ãƒ»ã‚¹ãƒ­ãƒƒãƒˆãƒ»ãƒ©ã‚¤ãƒ–ï¼‰ -->
  <div id="game-section" class="game-section hidden">
    <div class="section-title">ğŸ° ã‚²ãƒ¼ãƒ ç¨®åˆ¥</div>
    <div class="chart-row">
      <div class="pie-wrapper"><div class="pie-chart-container"><canvas id="game-pie-chart"></canvas></div></div>
      <div class="list-wrapper"><div id="game-grid" class="provider-grid"></div></div>
    </div>
  </div>
  
  <!-- ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ¥ -->
  <div id="provider-section" class="provider-section hidden">
    <div class="section-title">ğŸ­ ã‚²ãƒ¼ãƒ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ¥</div>
    <div class="chart-row">
      <div class="pie-wrapper"><div class="pie-chart-container"><canvas id="provider-pie-chart"></canvas></div></div>
      <div class="list-wrapper"><div id="provider-grid" class="provider-grid"></div></div>
    </div>
  </div>
  
  <!-- æ—¥æ¬¡çµ±è¨ˆ -->
  <div id="daily-stats-section" class="daily-stats-section hidden">
    <div class="section-title">ğŸ“… æ—¥æ¬¡çµ±è¨ˆï¼ˆç²¾ç®—æ—¥åˆ¥ï¼‰</div>
    <div id="daily-stats-grid" class="daily-stats-grid"></div>
  </div>
  
  <!-- ç€é‡‘çµ±è¨ˆ -->
  <div id="payment-stats-section" class="payment-stats-section hidden">
    <div class="section-title">ğŸ’° ç€é‡‘çµ±è¨ˆï¼ˆæœˆåˆ¥ï¼‰</div>
    <div id="payment-stats-grid" class="payment-stats-grid"></div>
  </div>
  
  <div id="data-table" class="card">
    <div class="section-title">ğŸ“‹ è©³ç´°ãƒ‡ãƒ¼ã‚¿</div>
    <div class="table-container">
      <table><thead><tr id="table-header"></tr></thead><tbody id="table-body"></tbody></table>
    </div>
  </div>
  <footer>åç›Šç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ v10.0 | ç´¯ç©ãƒãƒ¼ã‚¸å¯¾å¿œç‰ˆ | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã«æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ</footer>
</div>

<div id="upload-modal" class="modal hidden">
  <div class="modal-content">
    <h3 style="margin-bottom:20px">ğŸ“¤ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
    <div class="form-row">
      <div class="form-group"><label>æœŸé–“</label><input type="text" id="upload-period" placeholder="ä¾‹: 2025å¹´10æœˆ"></div>
      <div class="form-group"><label>ãƒ‡ãƒ¼ã‚¿ç¨®åˆ¥</label>
        <select id="upload-type" onchange="toggleExchangeRate()">
          <option value="auto">è‡ªå‹•åˆ¤åˆ¥</option>
          <option value="samExcel">å…ƒamuse/DSC Excel</option>
          <option value="sloten">ã‚¹ãƒ­å¤©KPIã‚·ãƒ¼ãƒˆ</option>
          <option value="konibet">Konibet KPIã‚·ãƒ¼ãƒˆ</option>
          <option value="agent">AMUSEVIP ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</option>
          <option value="ads">åºƒå‘Šãƒ‡ãƒ¼ã‚¿</option>
          <option value="baccarat">ãƒã‚«ãƒ©ãƒ„ãƒ¼ãƒ«</option>
          <option value="customerList">é¡§å®¢ãƒªã‚¹ãƒˆã‚·ãƒ¼ãƒˆ</option>
          <option value="uncollected">æœªå›åã‚·ãƒ¼ãƒˆ</option>
          <option value="bonus">ãƒœãƒ¼ãƒŠã‚¹ã‚·ãƒ¼ãƒˆ</option>
          <option value="delayed">é…ã‚Œå›åã‚·ãƒ¼ãƒˆ</option>
        </select>
      </div>
    </div>
    <div class="form-row" id="exchange-rate-row" style="display:none">
      <div class="form-group">
        <label>ğŸ’± ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ (USDâ†’JPY)</label>
        <input type="number" id="usd-jpy-rate" value="150" min="1" max="500" step="0.1" style="width:120px">
        <span style="font-size:12px;color:#64748b;margin-left:8px">â€»Konibeté‡‘é¡æ›ç®—ç”¨</span>
      </div>
    </div>
    <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()">
      <div style="font-size:40px;margin-bottom:10px">ğŸ“</div>
      <p>ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
      <p style="font-size:12px;color:#94a3b8;margin-top:8px">.xlsx, .xls, .csv å¯¾å¿œ</p>
    </div>
    <input type="file" id="file-input" accept=".xlsx,.xls,.csv" style="display:none" onchange="handleFileUpload(this.files[0])">
    <div id="upload-status" style="margin-top:16px;padding:12px;border-radius:8px;display:none"></div>
    <div style="margin-top:20px;display:flex;gap:10px;justify-content:flex-end">
      <button class="btn btn-secondary" onclick="hideUploadModal()">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<div id="add-business-modal" class="modal hidden">
  <div class="modal-content">
    <h3 style="margin-bottom:20px">â• äº‹æ¥­è¿½åŠ </h3>
    <div class="form-group"><label>äº‹æ¥­å</label><input type="text" id="new-business-name" placeholder="ä¾‹: æ–°è¦äº‹æ¥­"></div>
    <div class="form-group"><label>äº‹æ¥­ã‚¿ã‚¤ãƒ—</label>
      <select id="new-business-type">
        <option value="samExcel">æ¨™æº–ï¼ˆGGR/NGRç­‰ï¼‰</option>
        <option value="sloten">ã‚¹ãƒ­å¤©å½¢å¼</option>
        <option value="konibet">Konibetå½¢å¼</option>
        <option value="agent">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‹</option>
        <option value="ads">åºƒå‘Šå‹</option>
        <option value="baccara">ãƒ„ãƒ¼ãƒ«å‹</option>
      </select>
    </div>
    <div style="margin-top:20px;display:flex;gap:10px;justify-content:flex-end">
      <button class="btn btn-secondary" onclick="hideAddBusinessModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn btn-primary" onclick="addBusiness()">è¿½åŠ </button>
    </div>
  </div>
</div>

<div id="report-prompt-modal" class="modal hidden">
  <div class="modal-content" style="max-width:800px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column">
    <h3 style="margin-bottom:20px">ğŸ“ å–¶æ¥­å ±å‘Šæ›¸ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h3>
    <div style="margin-bottom:12px;display:flex;gap:10px;align-items:center">
      <span style="font-weight:600" id="report-business-period"></span>
      <button class="btn btn-primary" onclick="copyReportPrompt()" style="margin-left:auto">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
    </div>
    <textarea id="report-prompt-text" readonly style="flex:1;min-height:400px;width:100%;padding:16px;border:1px solid #e2e8f0;border-radius:8px;font-family:monospace;font-size:13px;line-height:1.6;resize:none;background:#f8fafc"></textarea>
    <div style="margin-top:16px;display:flex;gap:10px;justify-content:flex-end">
      <button class="btn btn-secondary" onclick="hideReportPromptModal()">é–‰ã˜ã‚‹</button>
    </div>
  </div>
</div>

<script>
// ãƒ‡ãƒ¼ã‚¿ã¯å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆdata.jsï¼‰ã‹ã‚‰èª­ã¿è¾¼ã¿
const DEFAULT_BUSINESSES = {
  'å…ƒamuse': { data: MOTO_AMUSE_DATA, type: 'samExcel' },
  'DSC': { data: DSC_DATA, type: 'samExcel' },
  'ã‚¹ãƒ­å¤©': { data: SLOTEN_DATA, type: 'sloten' },
  'åºƒå‘Š': { data: {}, type: 'ads' },
  'ãƒã‚«ãƒ©ãƒ„ãƒ¼ãƒ«': { data: {}, type: 'baccara' },
  'AMUSEVIP': { data: {}, type: 'agent' },
  'Konibet': { data: KONIBET_DATA, type: 'konibet' },
  'ãƒªãƒ³ã‚¯é›†': { data: {}, type: 'links' }
};

// LZåœ§ç¸®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆè»½é‡ç‰ˆï¼‰
const LZString={compressToEncodedURIComponent:function(a){if(null==a)return"";return LZString._compress(a,6,function(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(b)})},decompressFromEncodedURIComponent:function(a){if(null==a)return"";if(""==a)return null;a=a.replace(/ /g,"+");return LZString._decompress(a.length,32,function(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".indexOf(a.charAt(b))})},_compress:function(a,b,c){if(null==a)return"";var d,e,f,g={},h={},k="",l="",m="",n=2,o=3,p=2,q=[],r=0,s=0;for(f=0;f<a.length;f+=1)if(k=a.charAt(f),Object.prototype.hasOwnProperty.call(g,k)||(g[k]=o++,h[k]=!0),l=m+k,Object.prototype.hasOwnProperty.call(g,l))m=l;else{if(Object.prototype.hasOwnProperty.call(h,m)){if(256>m.charCodeAt(0)){for(d=0;d<p;d++)r<<=1,15==s?(s=0,q.push(c(r)),r=0):s++;for(e=m.charCodeAt(0),d=0;8>d;d++)r=r<<1|1&e,15==s?(s=0,q.push(c(r)),r=0):s++,e>>=1}else{for(e=1,d=0;d<p;d++)r=r<<1|e,15==s?(s=0,q.push(c(r)),r=0):s++,e=0;for(e=m.charCodeAt(0),d=0;16>d;d++)r=r<<1|1&e,15==s?(s=0,q.push(c(r)),r=0):s++,e>>=1}0==--n&&(n=Math.pow(2,p),p++);delete h[m]}else for(e=g[m],d=0;d<p;d++)r=r<<1|1&e,15==s?(s=0,q.push(c(r)),r=0):s++,e>>=1;0==--n&&(n=Math.pow(2,p),p++);g[l]=o++;m=k}if(""!==m){if(Object.prototype.hasOwnProperty.call(h,m)){if(256>m.charCodeAt(0)){for(d=0;d<p;d++)r<<=1,15==s?(s=0,q.push(c(r)),r=0):s++;for(e=m.charCodeAt(0),d=0;8>d;d++)r=r<<1|1&e,15==s?(s=0,q.push(c(r)),r=0):s++,e>>=1}else{for(e=1,d=0;d<p;d++)r=r<<1|e,15==s?(s=0,q.push(c(r)),r=0):s++,e=0;for(e=m.charCodeAt(0),d=0;16>d;d++)r=r<<1|1&e,15==s?(s=0,q.push(c(r)),r=0):s++,e>>=1}0==--n&&(n=Math.pow(2,p),p++);delete h[m]}else for(e=g[m],d=0;d<p;d++)r=r<<1|1&e,15==s?(s=0,q.push(c(r)),r=0):s++,e>>=1;0==--n&&(n=Math.pow(2,p),p++)}for(e=2,d=0;d<p;d++)r=r<<1|1&e,15==s?(s=0,q.push(c(r)),r=0):s++,e>>=1;for(;;)if(r<<=1,15==s){q.push(c(r));break}else s++;return q.join("")},_decompress:function(a,b,c){var d,e,f,g,h,k,l,m=[],n=4,o=4,p=3,q="",r=[],s={val:c(0),position:b,index:1};for(d=0;3>d;d+=1)m[d]=d;for(f=0,h=Math.pow(2,2),k=1;k!=h;)g=s.val&s.position,s.position>>=1,0==s.position&&(s.position=b,s.val=c(s.index++)),f|=(0<g?1:0)*k,k<<=1;switch(f){case 0:for(f=0,h=Math.pow(2,8),k=1;k!=h;)g=s.val&s.position,s.position>>=1,0==s.position&&(s.position=b,s.val=c(s.index++)),f|=(0<g?1:0)*k,k<<=1;l=String.fromCharCode(f);break;case 1:for(f=0,h=Math.pow(2,16),k=1;k!=h;)g=s.val&s.position,s.position>>=1,0==s.position&&(s.position=b,s.val=c(s.index++)),f|=(0<g?1:0)*k,k<<=1;l=String.fromCharCode(f);break;case 2:return""}for(m[3]=l,e=l,r.push(l);;){if(s.index>a)return"";for(f=0,h=Math.pow(2,p),k=1;k!=h;)g=s.val&s.position,s.position>>=1,0==s.position&&(s.position=b,s.val=c(s.index++)),f|=(0<g?1:0)*k,k<<=1;switch(l=f){case 0:for(f=0,h=Math.pow(2,8),k=1;k!=h;)g=s.val&s.position,s.position>>=1,0==s.position&&(s.position=b,s.val=c(s.index++)),f|=(0<g?1:0)*k,k<<=1;m[o++]=String.fromCharCode(f);l=o-1;n--;break;case 1:for(f=0,h=Math.pow(2,16),k=1;k!=h;)g=s.val&s.position,s.position>>=1,0==s.position&&(s.position=b,s.val=c(s.index++)),f|=(0<g?1:0)*k,k<<=1;m[o++]=String.fromCharCode(f);l=o-1;n--;break;case 2:return r.join("")}if(0==n&&(n=Math.pow(2,p),p++),m[l])q=m[l];else if(l===o)q=e+e.charAt(0);else return null;r.push(q);m[o++]=e+q.charAt(0);n--;e=q;0==n&&(n=Math.pow(2,p),p++)}}};

let cloudEnabled = false;

let BUSINESSES = JSON.parse(JSON.stringify(DEFAULT_BUSINESSES));
let currentBusiness = 'å…ƒamuse';
let currentPeriod = null;
let chartInstance = null;
let cryptoPieChart = null;
let gamePieChart = null;
let providerPieChart = null;
let retentionChart = null;
let viewMode = 'period';

// ========== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ==========
function parseNumber(val) {
  if (val === undefined || val === null || val === '' || val === '-' || String(val).startsWith('#')) return null;
  if (typeof val === 'number') return val;
  let cleaned = String(val).replace(/[Â¥ï¿¥$,ã€"\s]/g, '').trim();
  if (cleaned.endsWith('%')) cleaned = cleaned.replace(/%$/, '');
  const num = parseFloat(cleaned);
  return isNaN(num) ? null : num;
}
function formatCurrency(val) {
  if (val == null || isNaN(val)) return '-';
  const abs = Math.abs(val); const sign = val < 0 ? '-' : '';
  if (abs >= 100000000) return sign + 'Â¥' + (abs / 100000000).toFixed(2) + 'å„„';
  if (abs >= 10000) return sign + 'Â¥' + Math.round(abs / 10000).toLocaleString() + 'ä¸‡';
  return sign + 'Â¥' + Math.round(abs).toLocaleString();
}
function formatPercent(val) { 
  if (val == null || isNaN(val)) return '-'; 
  let v = Math.abs(val) <= 1 ? val * 100 : val; 
  return v.toFixed(2) + '%'; 
}
function formatRTP(val) {
  if (val == null || isNaN(val)) return '-';
  // æ§é™¤ç‡ï¼ˆ0.02ãªã©å°ã•ã„å€¤ï¼‰ã®å ´åˆã¯RTPã«å¤‰æ›
  let v = val;
  if (v <= 0.1) v = 1 - v; // æ§é™¤ç‡ã‚’RTPã«å¤‰æ›
  // å°æ•°è¡¨ç¤ºï¼ˆ2æœªæº€ï¼‰ã®å ´åˆã¯100å€ã€æ—¢ã«%è¡¨ç¤ºï¼ˆ2ä»¥ä¸Šï¼‰ã®å ´åˆã¯ãã®ã¾ã¾
  v = v < 2 ? v * 100 : v;
  return v.toFixed(2) + '%';
}
function formatNumber(val) { if (val == null || isNaN(val)) return '-'; return Math.round(val).toLocaleString(); }
function sortPeriods(periods) {
  return [...periods].sort((a, b) => {
    const mA = a.match(/(\d{4})å¹´(\d{1,2})æœˆ/), mB = b.match(/(\d{4})å¹´(\d{1,2})æœˆ/);
    if (mA && mB) { const yA = parseInt(mA[1]), monA = parseInt(mA[2]), yB = parseInt(mB[1]), monB = parseInt(mB[2]); return (yB * 12 + monB) - (yA * 12 + monA); }
    return b.localeCompare(a);
  });
}

// ========== ã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸ ==========
function getBinIdFromURL() { return ''; }
function setBinIdToURL(binId) { }
function updateSyncStatus(msg, isError = false) { const el = document.getElementById('sync-status'); el.textContent = isError ? 'âš ï¸ ' + msg : 'ğŸ’¾ ' + msg; el.style.color = isError ? '#ef4444' : '#10b981'; }

function getShareDataFromURL() {
  const hash = window.location.hash;
  if (hash && hash.startsWith('#data=')) {
    try {
      const compressed = hash.substring(6);
      const json = LZString.decompressFromEncodedURIComponent(compressed);
      return json ? JSON.parse(json) : null;
    } catch (e) { console.error('URL data parse error:', e); }
  }
  return null;
}

function createShareLink() {
  try {
    updateSyncStatus('ãƒªãƒ³ã‚¯ä½œæˆä¸­...');
    // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ï¼ˆDEFAULTå«ã‚€ï¼‰
    const toShare = {};
    Object.keys(BUSINESSES).forEach(key => {
      toShare[key] = BUSINESSES[key];
    });
    
    const json = JSON.stringify(toShare);
    const compressed = LZString.compressToEncodedURIComponent(json);
    const baseUrl = window.location.href.split('#')[0].split('?')[0];
    const shareUrl = baseUrl + '#data=' + compressed;
    
    if (shareUrl.length > 100000) {
      alert('ãƒ‡ãƒ¼ã‚¿ãŒå¤§ãã™ãã¾ã™ã€‚\nä¸€éƒ¨ã®æœŸé–“ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰å…±æœ‰ã—ã¦ãã ã•ã„ã€‚');
      updateSyncStatus('ãƒ‡ãƒ¼ã‚¿éå¤§', true);
      return;
    }
    
    window.history.replaceState({}, '', shareUrl);
    updateSyncStatus('å…±æœ‰ãƒªãƒ³ã‚¯ä½œæˆæ¸ˆ');
    
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(shareUrl).then(() => {
        alert('âœ… å…±æœ‰ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n\nURLé•·: ' + shareUrl.length + 'æ–‡å­—');
      }).catch(() => {
        prompt('å…±æœ‰ãƒªãƒ³ã‚¯ï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ï¼‰:', shareUrl);
      });
    } else {
      prompt('å…±æœ‰ãƒªãƒ³ã‚¯ï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ï¼‰:', shareUrl);
    }
  } catch (e) {
    console.error('createShareLink error:', e);
    updateSyncStatus('ã‚¨ãƒ©ãƒ¼', true);
    alert('å…±æœ‰ãƒªãƒ³ã‚¯ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\nã‚¨ãƒ©ãƒ¼: ' + e.message);
  }
}

// ãƒ‡ãƒ¼ã‚¿ã‚’data.jsã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆGitHubå…±æœ‰ç”¨ï¼‰
function exportDataJS() {
  try {
    let jsContent = '// ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«\n';
    jsContent += '// æœ€çµ‚æ›´æ–°: ' + new Date().toLocaleString('ja-JP') + '\n\n';
    
    // MOTO_AMUSE_DATA
    if (typeof MOTO_AMUSE_DATA !== 'undefined') {
      jsContent += 'const MOTO_AMUSE_DATA = ' + JSON.stringify(MOTO_AMUSE_DATA, null, 2).replace(/"([^"]+)":/g, "'$1':") + ';\n\n';
    }
    
    // DSC_DATA
    if (typeof DSC_DATA !== 'undefined') {
      jsContent += 'const DSC_DATA = ' + JSON.stringify(DSC_DATA, null, 2).replace(/"([^"]+)":/g, "'$1':") + ';\n\n';
    }
    
    // SLOTEN_DATA
    if (typeof SLOTEN_DATA !== 'undefined') {
      jsContent += 'const SLOTEN_DATA = ' + JSON.stringify(SLOTEN_DATA, null, 2).replace(/"([^"]+)":/g, "'$1':") + ';\n\n';
    }
    
    // KONIBET_DATA
    if (typeof KONIBET_DATA !== 'undefined') {
      jsContent += 'const KONIBET_DATA = ' + JSON.stringify(KONIBET_DATA, null, 2).replace(/"([^"]+)":/g, "'$1':") + ';\n\n';
    }
    
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    const blob = new Blob([jsContent], { type: 'text/javascript' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'data.js';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('âœ… data.js ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼\n\nã€GitHubå…±æœ‰æ‰‹é †ã€‘\n1. ã“ã®data.jsã‚’GitHubãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰\n2. å…±æœ‰å…ˆURLã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™');
  } catch (e) {
    console.error('exportDataJS error:', e);
    alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message);
  }
}function showShareURL() { createShareLink(); }
function saveToCloud() { }
function loadCloudData() { return {}; }
function clearCloudData() { }
function mergeWithDefault(sharedData) { const merged = JSON.parse(JSON.stringify(DEFAULT_BUSINESSES)); Object.keys(sharedData).forEach(key => { if (merged[key]) { merged[key].data = { ...merged[key].data, ...(sharedData[key].data || {}) }; merged[key].type = sharedData[key].type || merged[key].type; } else merged[key] = sharedData[key]; }); return merged; }
function saveBusinessData() { 
  try { 
    const backup = {}; 
    Object.keys(BUSINESSES).forEach(k => { 
      const def = DEFAULT_BUSINESSES[k]; 
      if (!def) backup[k] = BUSINESSES[k]; 
      else { 
        const newPeriods = {}; 
        Object.keys(BUSINESSES[k].data).forEach(p => { 
          if (!def.data[p]) newPeriods[p] = BUSINESSES[k].data[p]; 
        }); 
        if (Object.keys(newPeriods).length > 0) backup[k] = { data: newPeriods, type: BUSINESSES[k].type }; 
      } 
    }); 
    localStorage.setItem('dashboard_backup', JSON.stringify(backup)); 
    updateSyncStatus('ä¿å­˜å®Œäº†');
  } catch (e) { console.error('saveBusinessData error:', e); } 
}
async function clearAllData() { if (confirm('å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) { localStorage.removeItem('dashboard_backup'); window.location.href = window.location.pathname; } }
function initializeData() { 
  // 1. URLã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
  const urlData = getShareDataFromURL();
  if (urlData && Object.keys(urlData).length > 0) {
    BUSINESSES = urlData;
    updateSyncStatus('å…±æœ‰ãƒ‡ãƒ¼ã‚¿èª­è¾¼æ¸ˆ');
    selectBusiness(currentBusiness);
    return;
  }
  
  // 2. ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰èª­ã¿è¾¼ã‚€
  try { 
    const backup = localStorage.getItem('dashboard_backup'); 
    if (backup) { 
      const parsed = JSON.parse(backup); 
      Object.keys(parsed).forEach(key => { 
        if (BUSINESSES[key]) BUSINESSES[key].data = { ...BUSINESSES[key].data, ...parsed[key].data }; 
        else BUSINESSES[key] = parsed[key]; 
      }); 
      updateSyncStatus('ãƒ­ãƒ¼ã‚«ãƒ«');
    } else {
      updateSyncStatus('ãƒ­ãƒ¼ã‚«ãƒ«');
    }
  } catch (e) { 
    updateSyncStatus('ãƒ­ãƒ¼ã‚«ãƒ«'); 
  } 
  selectBusiness(currentBusiness); 
}
document.addEventListener('DOMContentLoaded', () => { initializeData(); renderTabs(); setupDragDrop(); });

// ========== è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ ==========
function setViewMode(mode) {
  viewMode = mode;
  document.getElementById('view-period').classList.toggle('active', mode === 'period');
  document.getElementById('view-total').classList.toggle('active', mode === 'total');
  document.getElementById('period-selector').classList.toggle('hidden', mode === 'total');
  document.getElementById('totals-section').classList.toggle('hidden', mode !== 'total');
  if (mode === 'total') renderTotalsSection();
  renderSummary(); renderCryptoSection(); renderGameSection(); renderProviderSection(); renderDailyStatsSection(); renderPaymentStatsSection();
}

// ========== ãƒˆãƒ¼ã‚¿ãƒ«ãƒ»å¹³å‡è¨ˆç®— ==========
function calculateTotalsAndAverages(businessName) {
  const business = BUSINESSES[businessName]; if (!business || !business.data) return null;
  const periods = Object.keys(business.data); if (periods.length === 0) return null;
  const totals = {}, counts = {};
  periods.forEach(period => {
    const periodData = business.data[period], summary = periodData?.ã‚µãƒãƒªãƒ¼ || periodData || {};
    Object.entries(summary).forEach(([key, val]) => { if (typeof val === 'number' && !isNaN(val)) { if (!totals[key]) { totals[key] = 0; counts[key] = 0; } totals[key] += val; counts[key]++; } });
  });
  const result = { totals: {}, averages: {}, periodCount: periods.length };
  Object.keys(totals).forEach(key => { result.totals[key] = totals[key]; result.averages[key] = totals[key] / counts[key]; });
  return result;
}

function renderTotalsSection() {
  const container = document.getElementById('totals-grid');
  const result = calculateTotalsAndAverages(currentBusiness);
  if (!result) { container.innerHTML = '<p style="opacity:0.7">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>'; return; }
  const business = BUSINESSES[currentBusiness], type = business?.type || 'samExcel';
  let metrics = type === 'samExcel' ? [
    { key: 'T/O', alt: ['ç·TO'], label: 'T/O', type: 'total' },
    { key: 'GGR(WIN/LOSE)', alt: ['GGR','WIN/LOSE'], label: 'GGR', type: 'total' },
    { key: 'NGR', alt: ['ç·NGR'], label: 'NGR', type: 'total' },
    { key: 'å›åé‡‘é¡', alt: ['ç·å›åé¡'], label: 'å›åé‡‘é¡', type: 'total' },
    { key: 'å‡ºé‡‘é‡‘é¡', alt: ['ç·å‡ºé‡‘é¡'], label: 'å‡ºé‡‘é‡‘é¡', type: 'total' },
    { key: 'RTP', label: 'RTP', type: 'avg', format: 'rtp' },
    { key: 'å›åç‡(å…¨ä½“)', label: 'å›åç‡', type: 'avg', format: 'percent' },
    { key: 'FTDæ•°', label: 'FTDæ•°', type: 'total', format: 'number' },
    { key: 'æ®‹æœªå›åé‡‘é¡', label: 'æœªå›åé‡‘é¡', type: 'total' },
    { key: 'é…ã‚Œå›åé‡‘é¡', label: 'é…ã‚Œå›å', type: 'total' }
  ] : type === 'sloten' ? [
    { key: 'GGR', label: 'GGR', type: 'total' },
    { key: 'ç·å…¥é‡‘é¡', label: 'ç·å…¥é‡‘é¡', type: 'total' },
    { key: 'ç·å‡ºé‡‘é¡', label: 'ç·å‡ºé‡‘é¡', type: 'total' },
    { key: 'å…¥å‡ºé‡‘å·®åˆ†', label: 'å…¥å‡ºé‡‘å·®åˆ†', type: 'total' },
    { key: 'ç™»éŒ²äººæ•°', label: 'ç™»éŒ²äººæ•°', type: 'total', format: 'number' },
    { key: 'RTP', label: 'RTP', type: 'avg', format: 'rtp' }
  ] : type === 'agent' ? [
    { key: 'å…¥é‡‘åˆè¨ˆ', label: 'å…¥é‡‘åˆè¨ˆ', type: 'total' },
    { key: 'å‡ºé‡‘åˆè¨ˆ', label: 'å‡ºé‡‘åˆè¨ˆ', type: 'total' },
    { key: 'åç›Šåˆè¨ˆ', label: 'åç›Šåˆè¨ˆ', type: 'total' },
    { key: 'NGR', label: 'NGR', type: 'total' },
    { key: 'ãƒ­ãƒ¼ãƒªãƒ³ã‚°å ±é…¬', label: 'ãƒ­ãƒ¼ãƒªãƒ³ã‚°', type: 'total' }
  ] : type === 'ads' ? [
    { key: 'ã‚³ã‚¹ãƒˆ($)', label: 'ã‚³ã‚¹ãƒˆ($)', type: 'total', format: 'number' },
    { key: 'ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³', label: 'IMP', type: 'total', format: 'number' },
    { key: 'ã‚¯ãƒªãƒƒã‚¯', label: 'ã‚¯ãƒªãƒƒã‚¯', type: 'total', format: 'number' },
    { key: 'ç™»éŒ²æ•°', label: 'ç™»éŒ²', type: 'total', format: 'number' },
    { key: 'å…¥é‡‘æ•°', label: 'å…¥é‡‘', type: 'total', format: 'number' }
  ] : type === 'baccara' ? [
    { key: 'ç™»éŒ²æ•°', label: 'ç™»éŒ²æ•°', type: 'total', format: 'number' },
    { key: 'ç·GGR', label: 'GGR', type: 'total' },
    { key: 'ã‚³ã‚¹ãƒˆ', label: 'ã‚³ã‚¹ãƒˆ', type: 'total' },
    { key: 'NGR', label: 'NGR', type: 'total' }
  ] : type === 'konibet' ? [
    { key: 'ç™»éŒ²äººæ•°', label: 'ç™»éŒ²äººæ•°', type: 'total', format: 'number' },
    { key: 'ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°', label: 'ãƒ­ã‚°ã‚¤ãƒ³æ•°', type: 'total', format: 'number' },
    { key: 'FTDæ•°', label: 'FTDæ•°', type: 'total', format: 'number' },
    { key: 'åˆå›å…¥é‡‘é¡', label: 'åˆå›å…¥é‡‘é¡', type: 'total' },
    { key: 'å…¥é‡‘è€…æ•°', label: 'å…¥é‡‘è€…æ•°', type: 'total', format: 'number' },
    { key: 'ç·å…¥é‡‘é¡', label: 'ç·å…¥é‡‘é¡', type: 'total' },
    { key: 'å‡ºé‡‘è€…æ•°', label: 'å‡ºé‡‘è€…æ•°', type: 'total', format: 'number' },
    { key: 'ç·å‡ºé‡‘é¡', label: 'ç·å‡ºé‡‘é¡', type: 'total' },
    { key: 'å…¥å‡ºé‡‘å·®åˆ†', label: 'å…¥å‡ºé‡‘å·®åˆ†', type: 'total' },
    { key: 'æ®‹é«˜', label: 'æ®‹é«˜', type: 'total' },
    { key: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤äººæ•°ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰', label: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–äººæ•°', type: 'total', format: 'number' },
    { key: 'T/O(ãƒªã‚¢ãƒ«ã®ã¿)', alt: ['T/O'], label: 'T/O', type: 'total' },
    { key: 'å‹åˆ©é‡‘(ãƒªã‚¢ãƒ«ã®ã¿)', label: 'å‹åˆ©é‡‘', type: 'total' },
    { key: 'GGR', label: 'GGR', type: 'total' },
    { key: 'ãƒœãƒ¼ãƒŠã‚¹', label: 'ãƒœãƒ¼ãƒŠã‚¹', type: 'total' },
    { key: 'ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒŠã‚¹', label: 'ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒŠã‚¹', type: 'total' },
    { key: 'ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼', label: 'ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼', type: 'total' },
    { key: 'PSPæ‰‹æ•°æ–™', label: 'PSPæ‰‹æ•°æ–™', type: 'total' },
    { key: 'AFFå ±é…¬', label: 'AFFå ±é…¬', type: 'total' },
    { key: 'NGR', label: 'NGR', type: 'total' },
    { key: 'RTP', label: 'RTP', type: 'avg', format: 'rtp' }
  ] : [];
  container.innerHTML = `<div class="total-card" style="grid-column:span 2;"><h4>ğŸ“… å¯¾è±¡æœŸé–“æ•°</h4><div class="main-val">${result.periodCount}æœŸé–“</div></div>` + metrics.map(m => { 
    let totalVal = result.totals[m.key], avgVal = result.averages[m.key]; 
    if ((totalVal == null) && m.alt) { for (const k of m.alt) { if (result.totals[k] != null) { totalVal = result.totals[k]; avgVal = result.averages[k]; break; } } } 
    if (totalVal == null) return ''; 
    let fT, fA; 
    if (m.format === 'rtp') { fT = '-'; fA = formatRTP(avgVal); } 
    else if (m.format === 'percent') { fT = '-'; fA = formatPercent(avgVal); } 
    else if (m.format === 'number') { fT = formatNumber(totalVal); fA = formatNumber(avgVal); } 
    else { fT = formatCurrency(totalVal); fA = formatCurrency(avgVal); } 
    return `<div class="total-card"><h4>${m.label}</h4><div class="main-val">${m.type === 'total' ? fT : fA}</div><div class="sub-val">${m.type === 'total' ? 'å¹³å‡: ' + fA : ''}</div></div>`; 
  }).join('');
}

// ========== ä»®æƒ³é€šè²¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå††ã‚°ãƒ©ãƒ•ä»˜ãï¼‰ ==========
function renderCryptoSection() {
  const section = document.getElementById('crypto-section');
  const container = document.getElementById('crypto-grid');
  const business = BUSINESSES[currentBusiness];
  
  let cryptoData = null;
  let depositTotal = 0;
  let withdrawTotal = 0;
  
  // ç€é‡‘çµ±è¨ˆã®ä»®æƒ³é€šè²¨ãƒ‡ãƒ¼ã‚¿ã‚’å„ªå…ˆçš„ã«ä½¿ç”¨
  const paymentCrypto = business?.data?.['ç€é‡‘çµ±è¨ˆ']?.['ä»®æƒ³é€šè²¨'];
  
  if (paymentCrypto && Object.keys(paymentCrypto).length > 0) {
    // ç€é‡‘çµ±è¨ˆã‹ã‚‰éŠ˜æŸ„åˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆï¼ˆå…¨æœˆåˆç®—ï¼‰
    cryptoData = {};
    Object.entries(paymentCrypto).forEach(([coin, monthlyData]) => {
      if (!cryptoData[coin]) cryptoData[coin] = { ä»¶æ•°: 0, é‡‘é¡: 0 };
      Object.values(monthlyData).forEach(stats => {
        cryptoData[coin].ä»¶æ•° += stats.å›æ•° || 0;
        cryptoData[coin].é‡‘é¡ += stats.é‡‘é¡åˆè¨ˆ || 0;
      });
    });
  } else if (viewMode === 'total') {
    // å…¨æœŸé–“ï¼šå…¨ã¦ã®æœŸé–“ã®ä»®æƒ³é€šè²¨ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
    const allCrypto = {};
    const periods = Object.keys(business?.data || {});
    periods.forEach(period => {
      const periodCrypto = business.data[period]?.ä»®æƒ³é€šè²¨;
      if (periodCrypto) {
        Object.entries(periodCrypto).forEach(([coin, data]) => {
          if (!allCrypto[coin]) allCrypto[coin] = { ä»¶æ•°: 0, é‡‘é¡: 0 };
          allCrypto[coin].ä»¶æ•° += data.ä»¶æ•° || 0;
          allCrypto[coin].é‡‘é¡ += data.é‡‘é¡ || 0;
        });
      }
      depositTotal += business.data[period]?.å…¥é‡‘æ–¹æ³•?.['ä»®æƒ³é€šè²¨'] || 0;
      withdrawTotal += business.data[period]?.å‡ºé‡‘æ–¹æ³•?.['ä»®æƒ³é€šè²¨'] || 0;
    });
    if (Object.keys(allCrypto).length > 0) cryptoData = allCrypto;
  } else {
    const periodData = business?.data?.[currentPeriod];
    cryptoData = periodData?.ä»®æƒ³é€šè²¨ || null;
    depositTotal = periodData?.å…¥é‡‘æ–¹æ³•?.['ä»®æƒ³é€šè²¨'] || 0;
    withdrawTotal = periodData?.å‡ºé‡‘æ–¹æ³•?.['ä»®æƒ³é€šè²¨'] || 0;
  }
  
  if (!cryptoData && depositTotal === 0 && withdrawTotal === 0) { section.classList.add('hidden'); return; }
  section.classList.remove('hidden');
  
  // å††ã‚°ãƒ©ãƒ•ç”¨ãƒ‡ãƒ¼ã‚¿
  const labels = [], values = [], colors = ['#26a17b', '#f7931a', '#627eea', '#23292f', '#eb0029', '#8b5cf6', '#ec4899'];
  let html = '';
  
  if (cryptoData && Object.keys(cryptoData).length > 0) {
    const total = Object.values(cryptoData).reduce((sum, c) => sum + (c.é‡‘é¡ || 0), 0);
    Object.entries(cryptoData).forEach(([coin, data], i) => {
      const amount = data.é‡‘é¡ || 0;
      const pct = total > 0 ? (amount / total * 100).toFixed(1) : 0;
      labels.push(coin); values.push(amount);
      html += `<div class="crypto-card"><h5>${coin}</h5><div class="crypto-val">${formatCurrency(amount)}</div><div class="crypto-pct">${data.ä»¶æ•° || 0}ä»¶ (${pct}%)</div></div>`;
    });
    html = `<div class="crypto-card" style="grid-column:span 2;background:#dcfce7;"><h5>ğŸ’° ä»®æƒ³é€šè²¨åˆè¨ˆ</h5><div class="crypto-val">${formatCurrency(total)}</div></div>` + html;
  } else {
    if (depositTotal > 0) { labels.push('å…¥é‡‘'); values.push(depositTotal); html += `<div class="crypto-card"><h5>å…¥é‡‘</h5><div class="crypto-val">${formatCurrency(depositTotal)}</div></div>`; }
    if (withdrawTotal > 0) { labels.push('å‡ºé‡‘'); values.push(withdrawTotal); html += `<div class="crypto-card"><h5>å‡ºé‡‘</h5><div class="crypto-val">${formatCurrency(withdrawTotal)}</div></div>`; }
  }
  
  container.innerHTML = html;
  
  // å††ã‚°ãƒ©ãƒ•æç”»
  if (cryptoPieChart) cryptoPieChart.destroy();
  if (values.length > 0) {
    const ctx = document.getElementById('crypto-pie-chart').getContext('2d');
    cryptoPieChart = new Chart(ctx, { type: 'doughnut', data: { labels, datasets: [{ data: values, backgroundColor: colors.slice(0, values.length) }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { font: { size: 10 } } } } } });
  }
}

// ========== ã‚²ãƒ¼ãƒ ç¨®åˆ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå††ã‚°ãƒ©ãƒ•ä»˜ãï¼‰ ==========
function renderGameSection() {
  const section = document.getElementById('game-section');
  const container = document.getElementById('game-grid');
  const business = BUSINESSES[currentBusiness];
  
  let games = null;
  
  if (viewMode === 'total') {
    // å…¨æœŸé–“ï¼šå…¨ã¦ã®æœŸé–“ã®ã‚²ãƒ¼ãƒ åˆ¥ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
    const allGames = {};
    const periods = Object.keys(business?.data || {});
    periods.forEach(period => {
      const periodGames = business.data[period]?.ã‚²ãƒ¼ãƒ åˆ¥;
      if (periodGames) {
        Object.entries(periodGames).forEach(([game, stats]) => {
          if (!allGames[game]) allGames[game] = { ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: 0, TO: 0, GGR: 0 };
          allGames[game].ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° += stats.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° || 0;
          allGames[game].TO += stats.TO || 0;
          allGames[game].GGR += stats.GGR || 0;
        });
      }
    });
    if (Object.keys(allGames).length > 0) games = allGames;
  } else {
    const periodData = business?.data?.[currentPeriod];
    games = periodData?.ã‚²ãƒ¼ãƒ åˆ¥;
  }
  
  if (!games || Object.keys(games).length === 0) { section.classList.add('hidden'); return; }
  section.classList.remove('hidden');
  
  const labels = [], values = [], colors = ['#f59e0b', '#3b82f6', '#10b981', '#ef4444', '#8b5cf6'];
  let html = '';
  
  Object.entries(games).forEach(([game, stats], i) => {
    const ggr = stats.GGR || 0;
    labels.push(game); values.push(Math.max(0, ggr));
    html += `<div class="provider-card"><h5>ğŸ° ${game}</h5><div class="provider-stats"><div class="stat-item"><div class="stat-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div><div class="stat-val">${formatNumber(stats.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°)}</div></div><div class="stat-item"><div class="stat-label">T/O</div><div class="stat-val">${formatCurrency(stats.TO)}</div></div><div class="stat-item"><div class="stat-label">GGR</div><div class="stat-val">${formatCurrency(ggr)}</div></div><div class="stat-item"><div class="stat-label">RTP</div><div class="stat-val">${stats.TO > 0 ? formatRTP((stats.TO - ggr) / stats.TO) : '-'}</div></div></div></div>`;
  });
  
  container.innerHTML = html;
  
  if (gamePieChart) gamePieChart.destroy();
  if (values.length > 0) {
    const ctx = document.getElementById('game-pie-chart').getContext('2d');
    gamePieChart = new Chart(ctx, { type: 'doughnut', data: { labels, datasets: [{ data: values, backgroundColor: colors.slice(0, values.length) }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { font: { size: 10 } } } } } });
  }
}

// ========== ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼åˆ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå††ã‚°ãƒ©ãƒ•ä»˜ãï¼‰ ==========
function renderProviderSection() {
  const section = document.getElementById('provider-section');
  const container = document.getElementById('provider-grid');
  const business = BUSINESSES[currentBusiness];
  
  let providers = null;
  
  if (viewMode === 'total') {
    // å…¨æœŸé–“ï¼šå…¨ã¦ã®æœŸé–“ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’é›†è¨ˆ
    const allProviders = {};
    const periods = Object.keys(business?.data || {});
    periods.forEach(period => {
      const periodProviders = business.data[period]?.ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼;
      if (periodProviders) {
        Object.entries(periodProviders).forEach(([name, stats]) => {
          if (!allProviders[name]) allProviders[name] = { ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: 0, è³­ã‘é‡‘é¡: 0, é…å½“é‡‘é¡: 0, GGR: 0 };
          allProviders[name].ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° += stats.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° || 0;
          allProviders[name].è³­ã‘é‡‘é¡ += stats.è³­ã‘é‡‘é¡ || 0;
          allProviders[name].é…å½“é‡‘é¡ += stats.é…å½“é‡‘é¡ || 0;
          allProviders[name].GGR += stats.GGR || 0;
        });
      }
    });
    if (Object.keys(allProviders).length > 0) providers = allProviders;
  } else {
    const periodData = business?.data?.[currentPeriod];
    providers = periodData?.ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼;
  }
  
  if (!providers || Object.keys(providers).length === 0) { section.classList.add('hidden'); return; }
  section.classList.remove('hidden');
  
  const labels = [], values = [], colors = ['#8b5cf6', '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#06b6d4', '#84cc16'];
  let html = '';
  
  // GGRã§ã‚½ãƒ¼ãƒˆ
  const sorted = Object.entries(providers).sort((a, b) => (b[1].GGR || 0) - (a[1].GGR || 0));
  sorted.forEach(([name, stats], i) => {
    const ggr = stats.GGR || 0;
    labels.push(name); values.push(Math.max(0, ggr));
    html += `<div class="provider-card"><h5>ğŸ­ ${name}</h5><div class="provider-stats"><div class="stat-item"><div class="stat-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div><div class="stat-val">${formatNumber(stats.ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°)}</div></div><div class="stat-item"><div class="stat-label">è³­ã‘é‡‘é¡</div><div class="stat-val">${formatCurrency(stats.è³­ã‘é‡‘é¡)}</div></div><div class="stat-item"><div class="stat-label">GGR</div><div class="stat-val">${formatCurrency(ggr)}</div></div><div class="stat-item"><div class="stat-label">RTP</div><div class="stat-val">${stats.è³­ã‘é‡‘é¡ > 0 ? formatRTP(stats.é…å½“é‡‘é¡ / stats.è³­ã‘é‡‘é¡) : '-'}</div></div></div></div>`;
  });
  
  container.innerHTML = html;
  
  if (providerPieChart) providerPieChart.destroy();
  if (values.length > 0) {
    const ctx = document.getElementById('provider-pie-chart').getContext('2d');
    providerPieChart = new Chart(ctx, { type: 'doughnut', data: { labels, datasets: [{ data: values, backgroundColor: colors.slice(0, values.length) }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { font: { size: 10 } } } } } });
  }
}

// ========== æ—¥æ¬¡çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ ==========
function renderDailyStatsSection() {
  const section = document.getElementById('daily-stats-section');
  const container = document.getElementById('daily-stats-grid');
  const business = BUSINESSES[currentBusiness];
  
  let dailyStats = null;
  
  if (viewMode === 'total') {
    // å…¨æœŸé–“ï¼šå…¨ã¦ã®æœŸé–“ã®æ—¥æ¬¡çµ±è¨ˆã‚’é›†è¨ˆ
    const allStats = {};
    const periods = Object.keys(business?.data || {});
    periods.forEach(period => {
      const periodStats = business.data[period]?.æ—¥æ¬¡çµ±è¨ˆ;
      if (periodStats) {
        Object.entries(periodStats).forEach(([date, stats]) => {
          if (!allStats[date]) allStats[date] = { äººæ•°: 0, ä¿¡ç”¨æ åˆè¨ˆ: 0, å›åé‡‘é¡åˆè¨ˆ: 0, ä¿¡ç”¨æ ä¸­å¤®å€¤: 0, å›åé‡‘é¡ä¸­å¤®å€¤: 0 };
          allStats[date].äººæ•° += stats.äººæ•° || 0;
          allStats[date].ä¿¡ç”¨æ åˆè¨ˆ += stats.ä¿¡ç”¨æ åˆè¨ˆ || 0;
          allStats[date].å›åé‡‘é¡åˆè¨ˆ += stats.å›åé‡‘é¡åˆè¨ˆ || 0;
        });
      }
    });
    if (Object.keys(allStats).length > 0) dailyStats = allStats;
  } else {
    const periodData = business?.data?.[currentPeriod];
    dailyStats = periodData?.æ—¥æ¬¡çµ±è¨ˆ;
  }
  
  if (!dailyStats || Object.keys(dailyStats).length === 0) {
    section.classList.add('hidden');
    return;
  }
  section.classList.remove('hidden');
  
  let html = '';
  const sortedDates = Object.keys(dailyStats).sort();
  
  sortedDates.forEach(date => {
    const s = dailyStats[date];
    // æ—¥ä»˜ã‚’è¦‹ã‚„ã™ãå¤‰æ›ï¼ˆ2025/10/02 â†’ 10/2ï¼‰
    const dateParts = date.split('/');
    const shortDate = dateParts.length === 3 ? `${parseInt(dateParts[1])}/${parseInt(dateParts[2])}` : date;
    
    html += `
      <div class="daily-stat-card">
        <div class="date">ğŸ“… ${shortDate}</div>
        <div class="stats">
          <div class="stat-item"><span class="stat-label">äººæ•°</span><span class="stat-val">${s.äººæ•°}äºº</span></div>
          <div class="stat-item"><span class="stat-label">ä¿¡ç”¨æ è¨ˆ</span><span class="stat-val">Â¥${(s.ä¿¡ç”¨æ åˆè¨ˆ/10000).toFixed(0)}ä¸‡</span></div>
          <div class="stat-item"><span class="stat-label">å›åé‡‘é¡</span><span class="stat-val">Â¥${(s.å›åé‡‘é¡åˆè¨ˆ/10000).toFixed(0)}ä¸‡</span></div>
          <div class="stat-item"><span class="stat-label">ä¿¡ç”¨æ ä¸­å¤®å€¤</span><span class="stat-val">Â¥${((s.ä¿¡ç”¨æ ä¸­å¤®å€¤ || 0)/10000).toFixed(0)}ä¸‡</span></div>
        </div>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

// ========== ç€é‡‘çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ ==========
function renderPaymentStatsSection() {
  const section = document.getElementById('payment-stats-section');
  const container = document.getElementById('payment-stats-grid');
  const business = BUSINESSES[currentBusiness];
  
  const paymentStats = business?.data?.['ç€é‡‘çµ±è¨ˆ'];
  
  if (!paymentStats || Object.keys(paymentStats).length === 0) {
    section.classList.add('hidden');
    return;
  }
  section.classList.remove('hidden');
  
  // æœˆåˆ¥ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´ç†ï¼ˆä»®æƒ³é€šè²¨ã¯éŠ˜æŸ„åˆ¥ã«å±•é–‹ï¼‰
  const monthlyData = {};
  const displayTypes = []; // è¡¨ç¤ºé †åºã‚’ä¿æŒ
  
  Object.keys(paymentStats).forEach(type => {
    const typeStats = paymentStats[type];
    
    if (type === 'ä»®æƒ³é€šè²¨') {
      // ä»®æƒ³é€šè²¨ã¯éŠ˜æŸ„åˆ¥ã«ãƒã‚¹ãƒˆã—ã¦ã„ã‚‹
      Object.keys(typeStats).forEach(coin => {
        const coinStats = typeStats[coin];
        const displayKey = `ä»®æƒ³é€šè²¨-${coin}`;
        if (!displayTypes.includes(displayKey)) displayTypes.push(displayKey);
        
        Object.entries(coinStats).forEach(([month, stats]) => {
          if (!monthlyData[month]) monthlyData[month] = {};
          monthlyData[month][displayKey] = stats;
        });
      });
    } else {
      // EC, Paypay, å€‹äººã¯å¾“æ¥é€šã‚Š
      if (!displayTypes.includes(type)) displayTypes.push(type);
      Object.entries(typeStats).forEach(([month, stats]) => {
        if (!monthlyData[month]) monthlyData[month] = {};
        monthlyData[month][type] = stats;
      });
    }
  });
  
  // æœˆã‚’ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
  const sortedMonths = Object.keys(monthlyData).sort((a, b) => {
    const parseMonth = (m) => {
      const match = m.match(/(\d{4})å¹´(\d{1,2})æœˆ/);
      return match ? parseInt(match[1]) * 100 + parseInt(match[2]) : 0;
    };
    return parseMonth(b) - parseMonth(a);
  });
  
  let html = '';
  const typeColors = { 
    'EC': '#4fc3f7', 'Paypay': '#ff6b6b', 'å€‹äºº': '#6bcb77',
    'ä»®æƒ³é€šè²¨-USDT': '#26a17b', 'ä»®æƒ³é€šè²¨-BTC': '#f7931a', 'ä»®æƒ³é€šè²¨-ETH': '#627eea',
    'ä»®æƒ³é€šè²¨-XRP': '#23292f', 'ä»®æƒ³é€šè²¨-TRX': '#eb0029', 'ä»®æƒ³é€šè²¨-ãã®ä»–': '#888888'
  };
  
  sortedMonths.forEach(month => {
    const data = monthlyData[month];
    html += `<div class="payment-month-card">`;
    html += `<div class="payment-month-title">ğŸ“† ${month}</div>`;
    
    // æœˆã®åˆè¨ˆã‚’è¨ˆç®—
    let monthTotal = { å›æ•°: 0, é‡‘é¡: 0 };
    let cryptoTotal = { å›æ•°: 0, é‡‘é¡: 0 };
    
    // éä»®æƒ³é€šè²¨ã‚’å…ˆã«è¡¨ç¤º
    ['EC', 'Paypay', 'å€‹äºº'].forEach(type => {
      const stats = data[type];
      if (!stats) return;
      
      const color = typeColors[type] || '#ffffff';
      html += `
        <div class="payment-type-row">
          <span class="payment-type-label" style="color:${color}">${type}</span>
          <div class="payment-type-values">
            <div class="payment-stat"><span class="payment-stat-label">äººæ•°</span> ${stats.äººæ•°}äºº</div>
            <div class="payment-stat"><span class="payment-stat-label">å›æ•°</span> ${stats.å›æ•°}å›</div>
            <div class="payment-stat"><span class="payment-stat-label">é‡‘é¡</span> Â¥${(stats.é‡‘é¡åˆè¨ˆ/10000).toFixed(1)}ä¸‡</div>
            <div class="payment-stat"><span class="payment-stat-label">ä¸­å¤®å€¤</span> Â¥${(stats.ä¸­å¤®å€¤/10000).toFixed(1)}ä¸‡</div>
          </div>
        </div>
      `;
      monthTotal.å›æ•° += stats.å›æ•°;
      monthTotal.é‡‘é¡ += stats.é‡‘é¡åˆè¨ˆ;
    });
    
    // ä»®æƒ³é€šè²¨ã®éŠ˜æŸ„åˆ¥ã‚’è¡¨ç¤º
    const cryptoCoins = Object.keys(data).filter(k => k.startsWith('ä»®æƒ³é€šè²¨-'));
    if (cryptoCoins.length > 0) {
      html += `<div style="margin-top:6px;padding-top:6px;border-top:1px dashed rgba(255,255,255,0.2)">`;
      html += `<div style="font-size:0.75rem;color:#ffd93d;margin-bottom:4px">ğŸ’ ä»®æƒ³é€šè²¨ï¼ˆéŠ˜æŸ„åˆ¥ï¼‰</div>`;
      
      cryptoCoins.forEach(coinKey => {
        const stats = data[coinKey];
        const coinName = coinKey.replace('ä»®æƒ³é€šè²¨-', '');
        const color = typeColors[coinKey] || '#ffd93d';
        
        html += `
          <div class="payment-type-row" style="padding:3px 0">
            <span class="payment-type-label" style="color:${color};font-size:0.8rem">${coinName}</span>
            <div class="payment-type-values">
              <div class="payment-stat"><span class="payment-stat-label">äºº</span> ${stats.äººæ•°}</div>
              <div class="payment-stat"><span class="payment-stat-label">å›</span> ${stats.å›æ•°}</div>
              <div class="payment-stat"><span class="payment-stat-label">é¡</span> Â¥${(stats.é‡‘é¡åˆè¨ˆ/10000).toFixed(1)}ä¸‡</div>
              <div class="payment-stat"><span class="payment-stat-label">ä¸­å¤®</span> Â¥${(stats.ä¸­å¤®å€¤/10000).toFixed(1)}ä¸‡</div>
            </div>
          </div>
        `;
        cryptoTotal.å›æ•° += stats.å›æ•°;
        cryptoTotal.é‡‘é¡ += stats.é‡‘é¡åˆè¨ˆ;
      });
      
      // ä»®æƒ³é€šè²¨å°è¨ˆ
      if (cryptoCoins.length > 1) {
        html += `
          <div class="payment-type-row" style="padding:3px 0;border-top:1px dotted rgba(255,255,255,0.15)">
            <span class="payment-type-label" style="color:#ffd93d;font-size:0.75rem">ä»®æƒ³é€šè²¨è¨ˆ</span>
            <div class="payment-type-values">
              <div class="payment-stat"><span class="payment-stat-label">å›</span> ${cryptoTotal.å›æ•°}</div>
              <div class="payment-stat"><span class="payment-stat-label">é¡</span> Â¥${(cryptoTotal.é‡‘é¡/10000).toFixed(1)}ä¸‡</div>
            </div>
          </div>
        `;
      }
      html += `</div>`;
      
      monthTotal.å›æ•° += cryptoTotal.å›æ•°;
      monthTotal.é‡‘é¡ += cryptoTotal.é‡‘é¡;
    }
    
    // æœˆåˆè¨ˆè¡Œ
    html += `
      <div class="payment-type-row" style="border-top:2px solid rgba(255,255,255,0.3);margin-top:8px;padding-top:8px">
        <span class="payment-type-label" style="color:#90EE90;font-weight:bold">åˆè¨ˆ</span>
        <div class="payment-type-values">
          <div class="payment-stat"><span class="payment-stat-label">å›æ•°</span> ${monthTotal.å›æ•°}å›</div>
          <div class="payment-stat"><span class="payment-stat-label">é‡‘é¡</span> Â¥${(monthTotal.é‡‘é¡/10000).toFixed(1)}ä¸‡</div>
        </div>
      </div>
    `;
    
    html += `</div>`;
  });
  
  container.innerHTML = html;
}

// ========== ç¶™ç¶šKPIæ¨ç§»ã‚°ãƒ©ãƒ• ==========
function renderRetentionChart() {
  const section = document.getElementById('retention-chart-section');
  const business = BUSINESSES[currentBusiness];
  
  // ã‚¹ãƒ­å¤©ä»¥å¤–ã¯éè¡¨ç¤º
  if (business?.type !== 'sloten') {
    section.classList.add('hidden');
    if (retentionChart) { retentionChart.destroy(); retentionChart = null; }
    return;
  }
  
  const data = business.data || {};
  const periods = sortPeriods(Object.keys(data)).reverse().slice(-12);
  
  if (periods.length === 0) {
    section.classList.add('hidden');
    return;
  }
  
  section.classList.remove('hidden');
  const ctx = document.getElementById('retention-chart').getContext('2d');
  if (retentionChart) retentionChart.destroy();
  
  const datasets = [
    {
      label: 'ç™»éŒ²äººæ•°',
      data: periods.map(p => data[p]?.ã‚µãƒãƒªãƒ¼?.['ç™»éŒ²äººæ•°'] || 0),
      backgroundColor: 'rgba(59, 130, 246, 0.7)',
      borderColor: 'rgba(59, 130, 246, 1)',
      borderWidth: 2,
      type: 'bar'
    },
    {
      label: 'å‰æœˆç™»éŒ²ã‹ã‚‰ã®ç¶™ç¶š',
      data: periods.map(p => data[p]?.ã‚µãƒãƒªãƒ¼?.['å‰æœˆç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°'] || 0),
      backgroundColor: 'rgba(16, 185, 129, 0.7)',
      borderColor: 'rgba(16, 185, 129, 1)',
      borderWidth: 2,
      type: 'bar'
    },
    {
      label: 'å‰ã€…æœˆç™»éŒ²ã‹ã‚‰ã®ç¶™ç¶š',
      data: periods.map(p => data[p]?.ã‚µãƒãƒªãƒ¼?.['å‰ã€…æœˆç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°'] || 0),
      backgroundColor: 'rgba(245, 158, 11, 0.7)',
      borderColor: 'rgba(245, 158, 11, 1)',
      borderWidth: 2,
      type: 'bar'
    },
    {
      label: '3ã‹æœˆä»¥ä¸Šå‰ã‹ã‚‰ã®ç¶™ç¶š',
      data: periods.map(p => data[p]?.ã‚µãƒãƒªãƒ¼?.['3ã‹æœˆä»¥ä¸Šå‰ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°'] || 0),
      backgroundColor: 'rgba(139, 92, 246, 0.7)',
      borderColor: 'rgba(139, 92, 246, 1)',
      borderWidth: 2,
      type: 'bar'
    },
    {
      label: 'å‰æœˆç¶™ç¶šç‡',
      data: periods.map(p => {
        const rate = data[p]?.ã‚µãƒãƒªãƒ¼?.['å‰æœˆç¶™ç¶šç‡'];
        return rate ? rate * 100 : 0;
      }),
      borderColor: 'rgba(239, 68, 68, 1)',
      backgroundColor: 'rgba(239, 68, 68, 0.1)',
      borderWidth: 3,
      type: 'line',
      yAxisID: 'y1',
      tension: 0.3
    }
  ];
  
  retentionChart = new Chart(ctx, {
    data: { labels: periods, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: {
        y: {
          beginAtZero: true,
          position: 'left',
          title: { display: true, text: 'äººæ•°' },
          ticks: { callback: v => v.toLocaleString() }
        },
        y1: {
          beginAtZero: true,
          position: 'right',
          max: 100,
          title: { display: true, text: 'ç¶™ç¶šç‡(%)' },
          grid: { drawOnChartArea: false },
          ticks: { callback: v => v + '%' }
        }
      }
    }
  });
}

// ========== ãƒ¡ã‚¤ãƒ³æç”» ==========
function renderTabs() { const container = document.getElementById('business-tabs'); container.innerHTML = Object.keys(BUSINESSES).map(name => `<button class="tab ${name === currentBusiness ? 'active' : ''}" onclick="selectBusiness('${name}')">${name}</button>`).join('') + '<button class="btn btn-danger" onclick="deleteBusiness()" style="margin-left:auto">ğŸ—‘ï¸</button>'; }
function selectBusiness(name) { 
  currentBusiness = name; 
  renderTabs();
  
  // ãƒªãƒ³ã‚¯é›†ã‚¿ãƒ–ã®å ´åˆã¯å°‚ç”¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  if (name === 'ãƒªãƒ³ã‚¯é›†') {
    document.getElementById('period-selector').innerHTML = '';
    document.getElementById('summary-section').innerHTML = '';
    document.getElementById('kpiCards').innerHTML = '';
    document.getElementById('chart-container').style.display = 'none';
    document.getElementById('retention-chart-container').style.display = 'none';
    document.getElementById('data-table').style.display = 'none';
    renderLinksTab();
    return;
  }
  
  // é€šå¸¸ã®äº‹æ¥­ã‚¿ãƒ–
  document.getElementById('chart-container').style.display = 'block';
  document.getElementById('retention-chart-container').style.display = 'block';
  document.getElementById('data-table').style.display = 'block';
  
  const business = BUSINESSES[name], data = business?.data || {}, periods = sortPeriods(Object.keys(data)); 
  currentPeriod = periods[0] || null; 
  renderPeriodSelector(periods); 
  if (viewMode === 'total') renderTotalsSection(); 
  renderSummary(); 
  renderKPISections(); 
  renderCryptoSection(); 
  renderGameSection(); 
  renderProviderSection(); 
  renderDailyStatsSection(); 
  renderPaymentStatsSection(); 
  renderChart(); 
  renderRetentionChart(); 
  renderTable(); 
}
function renderPeriodSelector(periods) { const container = document.getElementById('period-selector'); if (periods.length === 0) { container.innerHTML = '<span style="color:#94a3b8;font-size:13px">ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</span>'; return; } container.innerHTML = periods.map(p => `<button class="period-btn ${p === currentPeriod ? 'active' : ''}" onclick="selectPeriod('${p}')">${p}</button>`).join('') + `<button class="btn btn-danger" style="padding:4px 10px;font-size:11px" onclick="deletePeriod()">æœŸé–“å‰Šé™¤</button>`; }
function selectPeriod(period) { currentPeriod = period; renderPeriodSelector(sortPeriods(Object.keys(BUSINESSES[currentBusiness]?.data || {}))); renderSummary(); renderKPISections(); renderCryptoSection(); renderGameSection(); renderProviderSection(); renderDailyStatsSection(); renderPaymentStatsSection(); renderTable(); }
function deletePeriod() { const business = BUSINESSES[currentBusiness], periods = Object.keys(business?.data || {}); if (periods.length <= 1) { alert('æœ€å¾Œã®æœŸé–“ã¯å‰Šé™¤ã§ãã¾ã›ã‚“'); return; } if (confirm(`ã€Œ${currentPeriod}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) { delete business.data[currentPeriod]; saveBusinessData(); selectBusiness(currentBusiness); } }

function renderSummary() {
  const container = document.getElementById('summary-section');
  const business = BUSINESSES[currentBusiness];
  if (!business) { container.innerHTML = ''; return; }
  let data;
  if (viewMode === 'total') { const result = calculateTotalsAndAverages(currentBusiness); if (!result) { container.innerHTML = ''; return; } data = result.totals; }
  else { const periodData = business.data?.[currentPeriod]; data = periodData?.ã‚µãƒãƒªãƒ¼ || periodData || {}; }
  if (!data || Object.keys(data).length === 0) { container.innerHTML = '<div class="card" style="text-align:center;padding:40px;color:#94a3b8">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>'; return; }
  const type = business.type || 'samExcel';
  const colors = ['linear-gradient(135deg,#3b82f6,#1d4ed8)','linear-gradient(135deg,#10b981,#059669)','linear-gradient(135deg,#f59e0b,#d97706)','linear-gradient(135deg,#ef4444,#dc2626)','linear-gradient(135deg,#8b5cf6,#7c3aed)','linear-gradient(135deg,#ec4899,#db2777)'];
  
  // Konibetå°‚ç”¨ã®è©³ç´°ã‚µãƒãƒªãƒ¼è¡¨ç¤º
  if (type === 'konibet') {
    // åŸºæœ¬æŒ‡æ¨™ã‚°ãƒ«ãƒ¼ãƒ—
    const basicCards = [
      { key: 'ç™»éŒ²äººæ•°', alt: ['ç™»éŒ²'], label: 'ç™»éŒ²äººæ•°', format: 'number' },
      { key: 'ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°', alt: ['ãƒ­ã‚°ã‚¤ãƒ³'], label: 'ãƒ­ã‚°ã‚¤ãƒ³æ•°', format: 'number' },
      { key: 'FTDæ•°', alt: ['FTD', 'åˆå›å…¥é‡‘äººæ•°(FTD)'], label: 'FTDæ•°', format: 'number' },
      { key: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤äººæ•°ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰', alt: ['ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤äººæ•°', 'ãƒ™ãƒƒãƒˆäººæ•°'], label: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–äººæ•°', format: 'number' }
    ];
    // å…¥å‡ºé‡‘ã‚°ãƒ«ãƒ¼ãƒ—
    const depositCards = [
      { key: 'å…¥é‡‘è€…æ•°', alt: ['å…¥é‡‘äººæ•°'], label: 'å…¥é‡‘è€…æ•°', format: 'number' },
      { key: 'ç·å…¥é‡‘é¡', alt: ['å…¥é‡‘é¡'], label: 'å…¥é‡‘é¡' },
      { key: 'å‡ºé‡‘è€…æ•°', label: 'å‡ºé‡‘è€…æ•°', format: 'number' },
      { key: 'ç·å‡ºé‡‘é¡', alt: ['å‡ºé‡‘é¡'], label: 'å‡ºé‡‘é¡' },
      { key: 'å…¥å‡ºé‡‘å·®åˆ†', alt: ['å…¥é‡‘ã¨å‡ºé‡‘ã®å·®'], label: 'å…¥å‡ºé‡‘å·®åˆ†' },
      { key: 'æ®‹é«˜', label: 'æ®‹é«˜' }
    ];
    // åç›ŠæŒ‡æ¨™ã‚°ãƒ«ãƒ¼ãƒ—
    const revenueCards = [
      { key: 'T/O(ãƒªã‚¢ãƒ«ã®ã¿)', alt: ['T/O', 'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼'], label: 'T/O' },
      { key: 'å‹åˆ©é‡‘(ãƒªã‚¢ãƒ«ã®ã¿)', alt: ['å‹åˆ©é‡‘'], label: 'å‹åˆ©é‡‘' },
      { key: 'GGR', label: 'GGR' },
      { key: 'ãƒœãƒ¼ãƒŠã‚¹', alt: ['ãƒœãƒ¼ãƒŠã‚¹ï¼ˆFSé™¤ãï¼‰'], label: 'ãƒœãƒ¼ãƒŠã‚¹' },
      { key: 'ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒŠã‚¹', alt: ['ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒŠã‚¹(FSç­‰)'], label: 'ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒŠã‚¹' },
      { key: 'ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼', label: 'ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼' },
      { key: 'PSPæ‰‹æ•°æ–™', label: 'PSPæ‰‹æ•°æ–™' },
      { key: 'AFFå ±é…¬', label: 'AFFå ±é…¬' },
      { key: 'NGR', label: 'NGR' }
    ];
    // æ¯”ç‡æŒ‡æ¨™ã‚°ãƒ«ãƒ¼ãƒ—
    const ratioCards = [
      { key: 'RTP', label: 'RTP', format: 'percent' },
      { key: 'æ–°è¦å…¥é‡‘è»¢ç§»ç‡', label: 'æ–°è¦å…¥é‡‘è»¢ç§»ç‡', format: 'percent' },
      { key: 'å¹³å‡å…¥é‡‘é¡', alt: ['å¹³å‡å…¥é‡‘é¡(äººæ•°/ãƒ‡ã‚¤ãƒª)'], label: 'å¹³å‡å…¥é‡‘é¡' },
      { key: 'T/Oå€ç‡', label: 'T/Oå€ç‡', format: 'number' },
      { key: 'ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸ç‡', alt: ['ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸ç‡(å…¥é‡‘ã«å¯¾ã—ã¦)'], label: 'ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸ç‡', format: 'percent' },
      { key: 'GGRç‡', alt: ['å…¥é‡‘é¡ã«å¯¾ã—ã¦ã®GGRå‰²åˆ'], label: 'GGRç‡', format: 'percent' },
      { key: 'NGRç‡', alt: ['å…¥é‡‘ã«å¯¾ã—ã¦ã®NGRå‰²åˆ'], label: 'NGRç‡', format: 'percent' }
    ];
    
    const renderCardGroup = (cards, title, bgColors) => {
      const cardHtml = cards.map((card, i) => {
        let val = data[card.key];
        if (val == null && card.alt) { for (const k of card.alt) { if (data[k] != null) { val = data[k]; break; } } }
        if (val == null) return '';
        let formatted = card.format === 'percent' ? formatPercent(val) : card.format === 'number' ? formatNumber(val) : formatCurrency(val);
        const bg = val < 0 && card.format !== 'percent' ? 'linear-gradient(135deg,#ef4444,#dc2626)' : bgColors[i % bgColors.length];
        return `<div class="summary-card" style="background:${bg}"><h3>${card.label}</h3><div class="value">${formatted}</div></div>`;
      }).filter(h => h).join('');
      if (!cardHtml) return '';
      return `<div style="margin-bottom:16px"><div style="font-size:12px;color:#64748b;margin-bottom:8px;font-weight:600">${title}</div><div class="summary-grid">${cardHtml}</div></div>`;
    };
    
    const basicColors = ['linear-gradient(135deg,#3b82f6,#1d4ed8)','linear-gradient(135deg,#0ea5e9,#0284c7)','linear-gradient(135deg,#06b6d4,#0891b2)','linear-gradient(135deg,#14b8a6,#0d9488)'];
    const depositColors = ['linear-gradient(135deg,#10b981,#059669)','linear-gradient(135deg,#22c55e,#16a34a)','linear-gradient(135deg,#f97316,#ea580c)','linear-gradient(135deg,#ef4444,#dc2626)','linear-gradient(135deg,#8b5cf6,#7c3aed)','linear-gradient(135deg,#6366f1,#4f46e5)'];
    const revenueColors = ['linear-gradient(135deg,#f59e0b,#d97706)','linear-gradient(135deg,#fbbf24,#f59e0b)','linear-gradient(135deg,#84cc16,#65a30d)','linear-gradient(135deg,#ec4899,#db2777)','linear-gradient(135deg,#f43f5e,#e11d48)','linear-gradient(135deg,#a855f7,#9333ea)','linear-gradient(135deg,#d946ef,#c026d3)','linear-gradient(135deg,#fb7185,#f43f5e)','linear-gradient(135deg,#4ade80,#22c55e)'];
    const ratioColors = ['linear-gradient(135deg,#6366f1,#4f46e5)','linear-gradient(135deg,#8b5cf6,#7c3aed)','linear-gradient(135deg,#a855f7,#9333ea)','linear-gradient(135deg,#d946ef,#c026d3)','linear-gradient(135deg,#ec4899,#db2777)','linear-gradient(135deg,#f43f5e,#e11d48)','linear-gradient(135deg,#fb7185,#f43f5e)'];
    
    container.innerHTML = renderCardGroup(basicCards, 'ğŸ“Š åŸºæœ¬æŒ‡æ¨™', basicColors) + 
                         renderCardGroup(depositCards, 'ğŸ’µ å…¥å‡ºé‡‘', depositColors) +
                         renderCardGroup(revenueCards, 'ğŸ’° åç›ŠæŒ‡æ¨™', revenueColors) + 
                         renderCardGroup(ratioCards, 'ğŸ“ˆ æ¯”ç‡æŒ‡æ¨™', ratioColors);
    return;
  }
  
  // ãƒã‚«ãƒ©ãƒ„ãƒ¼ãƒ«å°‚ç”¨ã®è©³ç´°ã‚µãƒãƒªãƒ¼è¡¨ç¤º
  if (type === 'baccara') {
    const followerCards = [
      { key: 'Twitter', label: 'Twitter', format: 'number' },
      { key: 'Instagram', label: 'Instagram', format: 'number' },
      { key: 'TikTok', label: 'TikTok', format: 'number' },
      { key: 'YouTube', label: 'YouTube', format: 'number' },
      { key: 'LINEå…¬å¼', label: 'LINEå…¬å¼', format: 'number' },
      { key: 'KICK', label: 'KICK', format: 'number' },
      { key: 'åˆè¨ˆãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼', label: 'åˆè¨ˆ', format: 'number' }
    ];
    const bizCards = [
      { key: 'ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°', label: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°', format: 'number' },
      { key: 'ç·å…¥é‡‘é¡', label: 'ç·å…¥é‡‘é¡' },
      { key: 'å¹³å‡T/O', label: 'å¹³å‡T/O' },
      { key: 'ç·GGR', label: 'GGR' },
      { key: 'ã‚³ã‚¹ãƒˆ', label: 'ã‚³ã‚¹ãƒˆ' },
      { key: 'NGR', label: 'NGR' }
    ];
    const renderCardGroup = (cards, title, bgColors) => {
      const cardHtml = cards.map((card, i) => {
        let val = data[card.key];
        if (val == null) return '';
        let formatted = card.format === 'number' ? formatNumber(val) : formatCurrency(val);
        const bg = val < 0 ? 'linear-gradient(135deg,#ef4444,#dc2626)' : bgColors[i % bgColors.length];
        return `<div class="summary-card" style="background:${bg}"><h3>${card.label}</h3><div class="value">${formatted}</div></div>`;
      }).filter(h => h).join('');
      if (!cardHtml) return '';
      return `<div style="margin-bottom:16px"><div style="font-size:12px;color:#64748b;margin-bottom:8px;font-weight:600">${title}</div><div class="summary-grid">${cardHtml}</div></div>`;
    };
    const followerColors = ['linear-gradient(135deg,#3b82f6,#1d4ed8)','linear-gradient(135deg,#ec4899,#db2777)','linear-gradient(135deg,#000000,#333333)','linear-gradient(135deg,#ef4444,#dc2626)','linear-gradient(135deg,#22c55e,#16a34a)','linear-gradient(135deg,#4ade80,#22c55e)','linear-gradient(135deg,#8b5cf6,#7c3aed)'];
    const bizColors = ['linear-gradient(135deg,#10b981,#059669)','linear-gradient(135deg,#f59e0b,#d97706)','linear-gradient(135deg,#f97316,#ea580c)','linear-gradient(135deg,#22c55e,#16a34a)','linear-gradient(135deg,#ef4444,#dc2626)','linear-gradient(135deg,#8b5cf6,#7c3aed)'];
    container.innerHTML = renderCardGroup(followerCards, 'ğŸ“± SNSãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°', followerColors) + renderCardGroup(bizCards, 'ğŸ’° åç›Š', bizColors);
    return;
  }
  
  let cards = type === 'samExcel' ? [{ key: 'GGR(WIN/LOSE)', alt: ['GGR','WIN/LOSE'], label: 'GGR' },{ key: 'ç·å…¥é‡‘é¡', alt: ['å›åé‡‘é¡'], label: 'ç·å…¥é‡‘é¡' },{ key: 'ç·å‡ºé‡‘é¡', alt: ['å‡ºé‡‘é‡‘é¡'], label: 'ç·å‡ºé‡‘é¡' },{ key: 'å…¥å‡ºé‡‘å·®åˆ†', label: 'å…¥å‡ºé‡‘å·®åˆ†' },{ key: 'ç™»éŒ²äººæ•°', alt: ['ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°'], label: 'ç™»éŒ²äººæ•°', format: 'number' }] : type === 'sloten' ? [{ key: 'GGR', label: 'GGR' },{ key: 'ç·å…¥é‡‘é¡', label: 'ç·å…¥é‡‘é¡' },{ key: 'ç·å‡ºé‡‘é¡', label: 'ç·å‡ºé‡‘é¡' },{ key: 'å…¥å‡ºé‡‘å·®åˆ†', label: 'å…¥å‡ºé‡‘å·®åˆ†' },{ key: 'RTP', label: 'RTP', format: 'percent' },{ key: 'ç™»éŒ²äººæ•°', label: 'ç™»éŒ²äººæ•°', format: 'number' }] : type === 'konibet' ? [{ key: 'ç™»éŒ²äººæ•°', label: 'ç™»éŒ²äººæ•°', format: 'number' },{ key: 'ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°', label: 'ãƒ­ã‚°ã‚¤ãƒ³æ•°', format: 'number' },{ key: 'FTDæ•°', label: 'FTDæ•°', format: 'number' },{ key: 'åˆå›å…¥é‡‘é¡', label: 'åˆå›å…¥é‡‘é¡' },{ key: 'å…¥é‡‘è€…æ•°', label: 'å…¥é‡‘è€…æ•°', format: 'number' },{ key: 'ç·å…¥é‡‘é¡', label: 'ç·å…¥é‡‘é¡' },{ key: 'å‡ºé‡‘è€…æ•°', label: 'å‡ºé‡‘è€…æ•°', format: 'number' },{ key: 'ç·å‡ºé‡‘é¡', label: 'ç·å‡ºé‡‘é¡' },{ key: 'å…¥å‡ºé‡‘å·®åˆ†', label: 'å…¥å‡ºé‡‘å·®åˆ†' },{ key: 'æ®‹é«˜', label: 'æ®‹é«˜' },{ key: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤äººæ•°ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰', label: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–äººæ•°', format: 'number' },{ key: 'T/O(ãƒªã‚¢ãƒ«ã®ã¿)', label: 'T/O' },{ key: 'å‹åˆ©é‡‘(ãƒªã‚¢ãƒ«ã®ã¿)', label: 'å‹åˆ©é‡‘' },{ key: 'RTP', label: 'RTP', format: 'percent' },{ key: 'GGR', label: 'GGR' },{ key: 'ãƒœãƒ¼ãƒŠã‚¹', label: 'ãƒœãƒ¼ãƒŠã‚¹' },{ key: 'ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒŠã‚¹', label: 'ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒŠã‚¹' },{ key: 'ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼', label: 'ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼' },{ key: 'PSPæ‰‹æ•°æ–™', label: 'PSPæ‰‹æ•°æ–™' },{ key: 'AFFå ±é…¬', label: 'AFFå ±é…¬' },{ key: 'NGR', label: 'NGR' }] : type === 'ads' ? [{ key: 'ã‚³ã‚¹ãƒˆ(ç¨è¾¼)', label: 'ã‚³ã‚¹ãƒˆ' },{ key: 'ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³', label: 'IMP', format: 'number' },{ key: 'ã‚¯ãƒªãƒƒã‚¯', label: 'ã‚¯ãƒªãƒƒã‚¯', format: 'number' },{ key: 'ç™»éŒ²æ•°', label: 'ç™»éŒ²', format: 'number' },{ key: 'å…¥é‡‘æ•°', label: 'å…¥é‡‘', format: 'number' },{ key: 'ç™»éŒ²CPA', label: 'ç™»éŒ²CPA' },{ key: 'å…¥é‡‘CPA', label: 'å…¥é‡‘CPA' }] : type === 'agent' ? [{ key: 'å…¥é‡‘åˆè¨ˆ', label: 'å…¥é‡‘åˆè¨ˆ' },{ key: 'å‡ºé‡‘åˆè¨ˆ', label: 'å‡ºé‡‘åˆè¨ˆ' },{ key: 'åç›Šåˆè¨ˆ', label: 'åç›Šåˆè¨ˆ' },{ key: 'NGR', label: 'NGR' }] : [];
  container.innerHTML = '<div class="summary-grid">' + cards.map((card, i) => { let val = data[card.key]; if (val == null && card.alt) { for (const k of card.alt) { if (data[k] != null) { val = data[k]; break; } } } if (val == null) return ''; let formatted = card.key === 'RTP' ? formatRTP(val) : card.format === 'percent' ? formatPercent(val) : card.format === 'number' ? formatNumber(val) : formatCurrency(val); const bg = val < 0 && card.format !== 'percent' ? 'linear-gradient(135deg,#ef4444,#dc2626)' : colors[i % colors.length]; return `<div class="summary-card" style="background:${bg}"><h3>${card.label}</h3><div class="value">${formatted}</div></div>`; }).join('') + '</div>';
}

function renderKPISections() {
  const container = document.getElementById('kpi-sections');
  const business = BUSINESSES[currentBusiness];
  if (!business) { container.innerHTML = ''; return; }
  
  let data;
  if (viewMode === 'total') {
    const result = calculateTotalsAndAverages(currentBusiness);
    if (!result) { container.innerHTML = ''; return; }
    data = result.totals;
  } else {
    const periodData = business.data?.[currentPeriod];
    data = periodData?.ã‚µãƒãƒªãƒ¼ || periodData || {};
  }
  
  if (!data || Object.keys(data).length === 0) { container.innerHTML = ''; return; }
  const type = business.type || 'samExcel';
  if (type === 'agent' || type === 'ads' || type === 'baccara') { container.innerHTML = ''; return; }
  
  // Konibetå°‚ç”¨KPIã‚»ã‚¯ã‚·ãƒ§ãƒ³
  if (type === 'konibet') {
    const exchangeRate = data['ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ(USD/JPY)'] || 150;
    const konibetSections = [
      { 
        title: 'ğŸ“Š å®Ÿç¸¾', 
        keys: ['ç™»éŒ²','FTD','MAU','å…¥é‡‘é¡','ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼','AFFå›ºå®šè²»','NGR'], 
        bg: '#dbeafe',
        format: { 'ç™»éŒ²': 'number', 'FTD': 'number', 'MAU': 'number', 'å…¥é‡‘é¡': 'currency', 'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼': 'currency', 'AFFå›ºå®šè²»': 'currency', 'NGR': 'currency' }
      },
      { 
        title: 'ğŸ¯ ç›®æ¨™', 
        keys: ['ç™»éŒ²ç›®æ¨™','FTDç›®æ¨™','MAUç›®æ¨™','å…¥é‡‘é¡ç›®æ¨™','ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼ç›®æ¨™','AFFå›ºå®šè²»ç›®æ¨™','NGRç›®æ¨™'], 
        bg: '#fef3c7',
        format: { 'ç™»éŒ²ç›®æ¨™': 'number', 'FTDç›®æ¨™': 'number', 'MAUç›®æ¨™': 'number', 'å…¥é‡‘é¡ç›®æ¨™': 'currency', 'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼ç›®æ¨™': 'currency', 'AFFå›ºå®šè²»ç›®æ¨™': 'currency', 'NGRç›®æ¨™': 'currency' }
      },
      { 
        title: 'ğŸ“ˆ é”æˆç‡', 
        keys: ['ç™»éŒ²é”æˆç‡','FTDé”æˆç‡','MAUé”æˆç‡','å…¥é‡‘é¡é”æˆç‡','ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼é”æˆç‡','NGRé”æˆç‡'], 
        bg: '#dcfce7',
        format: { 'ç™»éŒ²é”æˆç‡': 'percent', 'FTDé”æˆç‡': 'percent', 'MAUé”æˆç‡': 'percent', 'å…¥é‡‘é¡é”æˆç‡': 'percent', 'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼é”æˆç‡': 'percent', 'NGRé”æˆç‡': 'percent' }
      }
    ];
    
    // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆæƒ…å ±ãƒãƒŠãƒ¼
    container.innerHTML = `<div style="background:linear-gradient(135deg,#059669,#10b981);color:white;padding:12px 20px;border-radius:12px;margin-bottom:16px;display:flex;align-items:center;gap:12px">
      <span style="font-size:20px">ğŸ’±</span>
      <span><strong>ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ:</strong> $1 = Â¥${exchangeRate} ã§æ›ç®—æ¸ˆã¿</span>
    </div>`;
    
    container.innerHTML += konibetSections.map(section => {
      const items = section.keys.filter(k => data[k] != null);
      if (items.length === 0) return '';
      return `<div class="card" style="background:${section.bg}"><div class="section-title">${section.title}</div><div class="kpi-grid">${items.map(key => {
        const val = data[key];
        const fmt = section.format[key];
        let formatted = fmt === 'percent' ? formatPercent(val) : fmt === 'currency' ? formatCurrency(val) : formatNumber(val);
        const isNeg = typeof val === 'number' && val < 0;
        const isLow = fmt === 'percent' && typeof val === 'number' && val < 0.8;
        return `<div class="kpi-item"><div class="label">${key}</div><div class="val ${isNeg ? 'negative' : ''}" style="${isLow ? 'color:#f59e0b' : ''}">${formatted}</div></div>`;
      }).join('')}</div></div>`;
    }).join('');
    
    // é€±æ¬¡è©³ç´°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯è¡¨ç¤º
    if (viewMode !== 'total') {
      const periodData = business.data?.[currentPeriod];
      if (periodData?.é€±æ¬¡è©³ç´° && periodData.é€±æ¬¡è©³ç´°.length > 0) {
        container.innerHTML += `<div class="card" style="background:#f1f5f9">
          <div class="section-title">ğŸ“… é€±æ¬¡è©³ç´°</div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>é€±</th>
                  <th class="text-right">ç™»éŒ²</th>
                  <th class="text-right">FTD</th>
                  <th class="text-right">MAU</th>
                  <th class="text-right">å…¥é‡‘é¡</th>
                  <th class="text-right">T/O</th>
                  <th class="text-right">NGR</th>
                  <th class="text-right">ç™»éŒ²ç‡</th>
                  <th class="text-right">å…¥é‡‘ç‡</th>
                </tr>
              </thead>
              <tbody>
                ${periodData.é€±æ¬¡è©³ç´°.map(w => `
                  <tr>
                    <td>${w.é€±}</td>
                    <td class="text-right">${formatNumber(w.ç™»éŒ²)}</td>
                    <td class="text-right">${formatNumber(w.FTD)}</td>
                    <td class="text-right">${formatNumber(w.MAU)}</td>
                    <td class="text-right">${formatCurrency(w.å…¥é‡‘é¡)}</td>
                    <td class="text-right">${formatCurrency(w.ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼)}</td>
                    <td class="text-right ${w.NGR < 0 ? 'text-red' : ''}">${formatCurrency(w.NGR)}</td>
                    <td class="text-right">${formatPercent(w['ç™»éŒ²é”æˆç‡'])}</td>
                    <td class="text-right">${formatPercent(w['å…¥é‡‘é¡é”æˆç‡'])}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>`;
      }
    }
    return;
  }
  
  const sections = [
    { title: 'ğŸ“ å–¶æ¥­KPI', keys: ['ãƒªã‚¹ãƒˆä»¶æ•°','ç·ç™»éŒ²æ•°','ç™»éŒ²äººæ•°','æ‰“é›»æ•°','ç€é›»æ•°','LINEç™»éŒ²æ•°','ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ•°','ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°','ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤äººæ•°ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯ï¼‰','ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°','å…¥é‡‘è€…æ•°(ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¦ãƒ‹ãƒ¼ã‚¯)'], bg: '#dbeafe' },
    { title: 'ğŸ¯ è»¢æ›KPI', keys: ['FTPæ•°','FTPç‡','FTDæ•°','FTDç‡','FTWæ•°','FTWç‡','FTDWæ•°','FTDWç‡','FTDã®ã¿å…¥é‡‘è€…æ•°','FTDã®ã¿ç‡','2ndå…¥é‡‘è€…æ•°','2ndç‡','3rdå…¥é‡‘è€…æ•°','3rdç‡','Activeå…¥é‡‘è€…æ•°','Activeç‡','ä»Šæœˆç™»éŒ²ã®FTDä»¥é™ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°','ä»Šæœˆç™»éŒ²FTDä»¥é™ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²åˆ'], bg: '#dcfce7' },
    { title: 'ğŸ”„ ç¶™ç¶šKPI', keys: ['å‰æœˆãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³æ•°','å¼•ç¶™ããƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°','å‰æœˆç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°','å‰æœˆç¶™ç¶šç‡','å‰ã€…æœˆç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°','å‰ã€…æœˆç¶™ç¶šç‡','3ã‹æœˆä»¥ä¸Šå‰ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°','3ã‹æœˆä»¥ä¸Šå‰ç¶™ç¶šç‡'], bg: '#fef3c7' },
    { title: 'ğŸ’° åç›ŠKPI', keys: ['T/O','ç·TO','T/O(ãƒªã‚¢ãƒ«ã®ã¿)','å‹åˆ©é‡‘','å‹åˆ©é‡‘(ãƒªã‚¢ãƒ«ã®ã¿)','RTP','GGR(WIN/LOSE)','GGR','WIN/LOSE','LTV(WIN/LOSE)','GGRLTV','ç·å·®åˆ†åˆ©ç›Š','ç·NGR','å¹³å‡NGR'], bg: '#e0e7ff' },
    { title: 'ğŸ’µ å›åKPI', keys: ['å›åäºˆå®šé‡‘é¡','å›åé‡‘é¡','ç·å›åé¡','å›åç‡(å…¨ä½“)','å›åç‡(ä»Šæœˆ)','å‡ºé‡‘é‡‘é¡','ç·å‡ºé‡‘é¡','GGR(å›åé‡‘é¡-å‡ºé‡‘é‡‘é¡)','å›åå‡ºé‡‘å·®åˆ†','LTV(GGR)','NGR','ç·å…¥é‡‘é¡','å…¥å‡ºé‡‘å·®åˆ†'], bg: '#fce7f3' },
    { title: 'ğŸ¦ ä¿¡ç”¨ãƒ»ãƒœãƒ¼ãƒŠã‚¹KPI', keys: ['ç·ä¿¡ç”¨æ ','å¹³å‡ä¿¡ç”¨æ ','å¹³å‡Creditå˜ä¾¡','ç·ãƒœãƒ¼ãƒŠã‚¹','ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡è€…æ•°','ç·ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸é‡‘é¡','ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡å…¥é‡‘é¡','ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡NGR'], bg: '#fef9c3' },
    { title: 'ğŸ“Š é¡§å®¢åˆ†æKPI', keys: ['å¹³å‡ãƒ—ãƒ¬ã‚¤æœˆé–“','äº‹å‰æ¸…ç®—å›æ•°','äº‹å‰æ¸…ç®—é‡‘é¡','äº‹å‰æ¸…ç®—å‰²åˆ','äº‹å‰æ¸…ç®—ä»¶æ•°å‰²åˆ','é€šå¸¸æ¸…ç®—å›æ•°','é€šå¸¸æ¸…ç®—é‡‘é¡','é€šå¸¸æ¸…ç®—å‰²åˆ','é€šå¸¸æ¸…ç®—ä»¶æ•°å‰²åˆ'], bg: '#e0f2fe' },
    { title: 'âš ï¸ æœªå›åãƒ»é…ã‚ŒKPI', keys: ['æœªå›åè€…æ•°','æ®‹æœªå›åé‡‘é¡','é…ã‚Œå›åä»¶æ•°','é…ã‚Œå›åé‡‘é¡'], bg: '#fee2e2' },
    { title: 'ğŸ‘¥ æ‹…å½“è€…KPI', keys: ['æ‹…å½“è€…æ•°','æ‹…å½“è€…è¨ˆ_ç™»éŒ²æ•°','æ‹…å½“è€…è¨ˆ_FTDæ•°','æ‹…å½“è€…è¨ˆ_GGR','æ‹…å½“è€…è¨ˆ_NGR'], bg: '#e0e7ff' }
  ];
  const percentKeys = ['FTPç‡','FTDç‡','FTWç‡','FTDWç‡','RTP','å›åç‡(å…¨ä½“)','å›åç‡(ä»Šæœˆ)','ä»Šæœˆç™»éŒ²FTDä»¥é™ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²åˆ','å‰æœˆç¶™ç¶šç‡','å‰ã€…æœˆç¶™ç¶šç‡','3ã‹æœˆä»¥ä¸Šå‰ç¶™ç¶šç‡','äº‹å‰æ¸…ç®—å‰²åˆ','é€šå¸¸æ¸…ç®—å‰²åˆ','äº‹å‰æ¸…ç®—ä»¶æ•°å‰²åˆ','é€šå¸¸æ¸…ç®—ä»¶æ•°å‰²åˆ','FTDã®ã¿ç‡','2ndç‡','3rdç‡','Activeç‡'];
  const currencyKeys = ['T/O','ç·TO','T/O(ãƒªã‚¢ãƒ«ã®ã¿)','å‹åˆ©é‡‘','å‹åˆ©é‡‘(ãƒªã‚¢ãƒ«ã®ã¿)','GGR(WIN/LOSE)','GGR','WIN/LOSE','LTV(WIN/LOSE)','å›åäºˆå®šé‡‘é¡','å›åé‡‘é¡','ç·å›åé¡','å‡ºé‡‘é‡‘é¡','ç·å‡ºé‡‘é¡','GGR(å›åé‡‘é¡-å‡ºé‡‘é‡‘é¡)','å›åå‡ºé‡‘å·®åˆ†','LTV(GGR)','NGR','åˆè¨ˆçµŒè²»','ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ•ã‚£ãƒ¼','äººä»¶è²»','é€šä¿¡è²»','ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–','ãƒšã‚¤ãƒ¡ãƒ³ãƒˆãƒ•ã‚£ãƒ¼','é›‘è²»ãƒ»ç¦åˆ©åšç”Ÿç­‰','BK','åˆ©ç›Š','ç·å…¥é‡‘é¡','ç·å‡ºé‡‘é¡','å…¥å‡ºé‡‘å·®åˆ†','GGRLTV','ç·å·®åˆ†åˆ©ç›Š','ç·NGR','å¹³å‡NGR','ç·ä¿¡ç”¨æ ','å¹³å‡ä¿¡ç”¨æ ','å¹³å‡Creditå˜ä¾¡','ç·ãƒœãƒ¼ãƒŠã‚¹','ç·ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸é‡‘é¡','ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡å…¥é‡‘é¡','ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡NGR','æ®‹æœªå›åé‡‘é¡','é…ã‚Œå›åé‡‘é¡','æ‹…å½“è€…è¨ˆ_GGR','æ‹…å½“è€…è¨ˆ_NGR','äº‹å‰æ¸…ç®—é‡‘é¡','é€šå¸¸æ¸…ç®—é‡‘é¡'];
  container.innerHTML = sections.map(section => { const items = section.keys.filter(k => data[k] != null); if (items.length === 0) return ''; return `<div class="card" style="background:${section.bg}"><div class="section-title">${section.title}</div><div class="kpi-grid">${items.map(key => { const val = data[key]; let formatted = key === 'RTP' ? formatRTP(val) : percentKeys.includes(key) ? formatPercent(val) : currencyKeys.includes(key) ? formatCurrency(val) : formatNumber(val); const isNeg = typeof val === 'number' && val < 0; return `<div class="kpi-item"><div class="label">${key}</div><div class="val ${isNeg ? 'negative' : ''}">${formatted}</div></div>`; }).join('')}</div></div>`; }).join('');
  
  // å…¥é‡‘/å‡ºé‡‘æ–¹æ³•ã€Affiliateã€ãƒªã‚¹ãƒˆç¨®åˆ¥
  if (viewMode !== 'total') {
    const periodData = business.data?.[currentPeriod];
    if (periodData?.ãƒªã‚¹ãƒˆç¨®åˆ¥) {
      const listOrder = ['B', 'E', 'T', 'S', 'BE', 'C', 'ç´¹ä»‹', 'ãã®ä»–'];
      const sortedList = listOrder.filter(k => periodData.ãƒªã‚¹ãƒˆç¨®åˆ¥[k] != null).map(k => [k, periodData.ãƒªã‚¹ãƒˆç¨®åˆ¥[k]]);
      container.innerHTML += `<div class="card" style="background:#f0fdf4"><div class="section-title">ğŸ“‹ ãƒªã‚¹ãƒˆç¨®åˆ¥</div><div class="kpi-grid">${sortedList.map(([k,v]) => `<div class="kpi-item"><div class="label">${k}</div><div class="val">${formatNumber(v)}ä»¶</div></div>`).join('')}</div></div>`;
    }
    if (periodData?.å…¥é‡‘æ–¹æ³•) container.innerHTML += `<div class="card" style="background:#e0f2fe"><div class="section-title">ğŸ’³ å…¥é‡‘æ–¹æ³•</div><div class="kpi-grid">${Object.entries(periodData.å…¥é‡‘æ–¹æ³•).map(([k,v]) => `<div class="kpi-item"><div class="label">${k}</div><div class="val">${formatCurrency(v)}</div></div>`).join('')}</div></div>`;
    if (periodData?.å‡ºé‡‘æ–¹æ³•) container.innerHTML += `<div class="card" style="background:#fef9c3"><div class="section-title">ğŸ¦ å‡ºé‡‘æ–¹æ³•</div><div class="kpi-grid">${Object.entries(periodData.å‡ºé‡‘æ–¹æ³•).map(([k,v]) => `<div class="kpi-item"><div class="label">${k}</div><div class="val">${formatCurrency(v)}</div></div>`).join('')}</div></div>`;
    if (periodData?.Affiliate) container.innerHTML += `<div class="card" style="background:#ecfdf5"><div class="section-title">ğŸ¤ Affiliate</div><div class="kpi-grid">${Object.entries(periodData.Affiliate).map(([k,v]) => `<div class="kpi-item"><div class="label">${k}</div><div class="val">${k.includes('ç‡') ? formatPercent(v) : k.includes('æ•°') ? formatNumber(v) : formatCurrency(v)}</div></div>`).join('')}</div></div>`;
  } else {
    // å…¨æœŸé–“ãƒ¢ãƒ¼ãƒ‰ï¼šãƒªã‚¹ãƒˆç¨®åˆ¥ã‚’é›†è¨ˆ
    const allListTypes = {};
    const validListTypes = ['B', 'E', 'T', 'S', 'BE', 'C', 'ç´¹ä»‹'];
    const periods = Object.keys(business.data || {});
    periods.forEach(period => {
      const listTypes = business.data[period]?.ãƒªã‚¹ãƒˆç¨®åˆ¥;
      if (listTypes) {
        Object.entries(listTypes).forEach(([type, count]) => {
          let targetType = validListTypes.includes(type) ? type : 'ãã®ä»–';
          if (!allListTypes[targetType]) allListTypes[targetType] = 0;
          allListTypes[targetType] += count;
        });
      }
    });
    if (Object.keys(allListTypes).length > 0) {
      const listOrder = ['B', 'E', 'T', 'S', 'BE', 'C', 'ç´¹ä»‹', 'ãã®ä»–'];
      const sortedList = listOrder.filter(k => allListTypes[k] != null).map(k => [k, allListTypes[k]]);
      container.innerHTML += `<div class="card" style="background:#f0fdf4"><div class="section-title">ğŸ“‹ ãƒªã‚¹ãƒˆç¨®åˆ¥ï¼ˆå…¨æœŸé–“ï¼‰</div><div class="kpi-grid">${sortedList.map(([k,v]) => `<div class="kpi-item"><div class="label">${k}</div><div class="val">${formatNumber(v)}ä»¶</div></div>`).join('')}</div></div>`;
    }
  }
}

function renderChart() {
  const ctx = document.getElementById('main-chart').getContext('2d');
  const business = BUSINESSES[currentBusiness];
  if (!business) { if (chartInstance) chartInstance.destroy(); return; }
  const data = business.data || {};
  const periods = sortPeriods(Object.keys(data)).reverse().slice(-12);
  if (chartInstance) chartInstance.destroy();
  if (periods.length === 0) { ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); return; }
  const type = business.type || 'samExcel';
  let datasets = type === 'samExcel' ? [{ label: 'GGR', data: periods.map(p => { const d = data[p]?.ã‚µãƒãƒªãƒ¼ || data[p] || {}; return d['GGR(WIN/LOSE)'] || d['GGR'] || d['WIN/LOSE'] || 0; }), backgroundColor: 'rgba(59,130,246,0.7)' },{ label: 'NGR', data: periods.map(p => (data[p]?.ã‚µãƒãƒªãƒ¼?.['NGR'] || data[p]?.['NGR'] || 0)), backgroundColor: 'rgba(16,185,129,0.7)' }] : type === 'sloten' ? [{ label: 'GGR', data: periods.map(p => (data[p]?.ã‚µãƒãƒªãƒ¼?.['GGR'] || data[p]?.['GGR'] || 0)), backgroundColor: 'rgba(59,130,246,0.7)' },{ label: 'å…¥å‡ºé‡‘å·®åˆ†', data: periods.map(p => (data[p]?.ã‚µãƒãƒªãƒ¼?.['å…¥å‡ºé‡‘å·®åˆ†'] || data[p]?.['å…¥å‡ºé‡‘å·®åˆ†'] || 0)), backgroundColor: 'rgba(16,185,129,0.7)' }] : type === 'konibet' ? [{ label: 'å…¥é‡‘é¡', data: periods.map(p => (data[p]?.ã‚µãƒãƒªãƒ¼?.['ç·å…¥é‡‘é¡'] || data[p]?.ã‚µãƒãƒªãƒ¼?.['å…¥é‡‘é¡'] || 0)), backgroundColor: 'rgba(59,130,246,0.7)' },{ label: 'NGR', data: periods.map(p => (data[p]?.ã‚µãƒãƒªãƒ¼?.['NGR'] || 0)), backgroundColor: 'rgba(16,185,129,0.7)' },{ label: 'å…¥å‡ºé‡‘å·®åˆ†', data: periods.map(p => (data[p]?.ã‚µãƒãƒªãƒ¼?.['å…¥å‡ºé‡‘å·®åˆ†'] || 0)), backgroundColor: 'rgba(245,158,11,0.7)' }] : [{ label: 'GGR', data: periods.map(p => (data[p]?.ã‚µãƒãƒªãƒ¼?.['ç·GGR'] || data[p]?.ã‚µãƒãƒªãƒ¼?.['GGR'] || 0)), backgroundColor: 'rgba(59,130,246,0.7)' }];
  chartInstance = new Chart(ctx, { type: 'bar', data: { labels: periods, datasets }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } }, scales: { y: { beginAtZero: true, ticks: { callback: v => 'Â¥' + (v / 1000000).toFixed(0) + 'M' } } } } });
}

function renderTable() {
  const business = BUSINESSES[currentBusiness];
  let data;
  if (viewMode === 'total') {
    const result = calculateTotalsAndAverages(currentBusiness);
    data = result ? result.totals : {};
  } else {
    const periodData = business?.data?.[currentPeriod];
    data = periodData?.ã‚µãƒãƒªãƒ¼ || periodData || {};
  }
  const header = document.getElementById('table-header');
  const body = document.getElementById('table-body');
  header.innerHTML = '<th>é …ç›®</th><th class="text-right">å€¤</th>';
  const percentKeys = ['FTPç‡','FTDç‡','FTWç‡','FTDWç‡','RTP','å›åç‡(å…¨ä½“)','å›åç‡(ä»Šæœˆ)','ä»Šæœˆç™»éŒ²FTDä»¥é™ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²åˆ','å‰æœˆç¶™ç¶šç‡','å‰ã€…æœˆç¶™ç¶šç‡'];
  const currencyKeys = ['T/O','ç·TO','T/O(ãƒªã‚¢ãƒ«ã®ã¿)','å‹åˆ©é‡‘','å‹åˆ©é‡‘(ãƒªã‚¢ãƒ«ã®ã¿)','GGR(WIN/LOSE)','GGR','WIN/LOSE','LTV(WIN/LOSE)','å›åäºˆå®šé‡‘é¡','å›åé‡‘é¡','ç·å›åé¡','å‡ºé‡‘é‡‘é¡','ç·å‡ºé‡‘é¡','GGR(å›åé‡‘é¡-å‡ºé‡‘é‡‘é¡)','å›åå‡ºé‡‘å·®åˆ†','LTV(GGR)','NGR','åˆè¨ˆçµŒè²»','ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ•ã‚£ãƒ¼','äººä»¶è²»','é€šä¿¡è²»','ã‚¤ãƒ³ã‚»ãƒ³ãƒ†ã‚£ãƒ–','ãƒšã‚¤ãƒ¡ãƒ³ãƒˆãƒ•ã‚£ãƒ¼','é›‘è²»ãƒ»ç¦åˆ©åšç”Ÿç­‰','BK','åˆ©ç›Š','ç·å…¥é‡‘é¡','å…¥å‡ºé‡‘å·®åˆ†','GGRLTV','ç·å·®åˆ†åˆ©ç›Š','ç·NGR','å¹³å‡NGR','ç·ä¿¡ç”¨æ ','å¹³å‡ä¿¡ç”¨æ ','å¹³å‡Creditå˜ä¾¡','ç·ãƒœãƒ¼ãƒŠã‚¹','ç·ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸é‡‘é¡','ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡å…¥é‡‘é¡','ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡NGR','æ®‹æœªå›åé‡‘é¡','é…ã‚Œå›åé‡‘é¡','æ‹…å½“è€…è¨ˆ_GGR','æ‹…å½“è€…è¨ˆ_NGR','äº‹å‰æ¸…ç®—é‡‘é¡','é€šå¸¸æ¸…ç®—é‡‘é¡'];
  const percentKeysTable = ['FTPç‡','FTDç‡','FTWç‡','FTDWç‡','RTP','å›åç‡(å…¨ä½“)','å›åç‡(ä»Šæœˆ)','ä»Šæœˆç™»éŒ²FTDä»¥é™ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰²åˆ','å‰æœˆç¶™ç¶šç‡','å‰ã€…æœˆç¶™ç¶šç‡','3ã‹æœˆä»¥ä¸Šå‰ç¶™ç¶šç‡','äº‹å‰æ¸…ç®—å‰²åˆ','é€šå¸¸æ¸…ç®—å‰²åˆ','äº‹å‰æ¸…ç®—ä»¶æ•°å‰²åˆ','é€šå¸¸æ¸…ç®—ä»¶æ•°å‰²åˆ','FTDã®ã¿ç‡','2ndç‡','3rdç‡','Activeç‡'];
  body.innerHTML = Object.entries(data).map(([key, value]) => { if (value === null || value === undefined) return ''; let formatted = key === 'RTP' ? formatRTP(value) : percentKeysTable.includes(key) ? formatPercent(value) : currencyKeys.includes(key) ? formatCurrency(value) : typeof value === 'number' ? formatNumber(value) : String(value); const isNeg = typeof value === 'number' && value < 0; return `<tr><td>${key}</td><td class="text-right ${isNeg ? 'text-red' : ''}">${formatted}</td></tr>`; }).join('');
}

// ========== ãƒ¢ãƒ¼ãƒ€ãƒ« ==========
function showUploadModal() { document.getElementById('upload-modal').classList.remove('hidden'); document.getElementById('upload-status').style.display = 'none'; toggleExchangeRate(); }
function hideUploadModal() { document.getElementById('upload-modal').classList.add('hidden'); }
function toggleExchangeRate() { const type = document.getElementById('upload-type').value; const row = document.getElementById('exchange-rate-row'); row.style.display = (type === 'konibet' || type === 'auto') ? 'block' : 'none'; }
function showAddBusinessModal() { document.getElementById('add-business-modal').classList.remove('hidden'); }
function hideAddBusinessModal() { document.getElementById('add-business-modal').classList.add('hidden'); }
function setupDragDrop() { const zone = document.getElementById('upload-zone'); zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); }); zone.addEventListener('dragleave', () => zone.classList.remove('dragover')); zone.addEventListener('drop', e => { e.preventDefault(); zone.classList.remove('dragover'); if (e.dataTransfer.files[0]) handleFileUpload(e.dataTransfer.files[0]); }); }
function showStatus(msg, isError = false) { const s = document.getElementById('upload-status'); s.style.display = 'block'; s.style.background = isError ? '#fee2e2' : '#dcfce7'; s.style.color = isError ? '#dc2626' : '#16a34a'; s.textContent = msg; }

// ========== ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ==========
function handleFileUpload(file) {
  if (!file) return;
  const period = document.getElementById('upload-period').value || new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' }).replace(' ', '');
  const uploadType = document.getElementById('upload-type').value;
  const reader = new FileReader();
  if (file.name.endsWith('.zip')) { showStatus('ZIPãƒ•ã‚¡ã‚¤ãƒ«ã¯éå¯¾å¿œã§ã™', true); return; }
  reader.onload = function(e) {
    try {
      if (file.name.endsWith('.csv')) handleCSV(e.target.result, period, uploadType, file.name);
      else { const data = new Uint8Array(e.target.result); const workbook = XLSX.read(data, { type: 'array' }); handleExcel(workbook, period, uploadType, file.name); }
    } catch (err) { showStatus('ã‚¨ãƒ©ãƒ¼: ' + err.message, true); }
  };
  if (file.name.endsWith('.csv')) reader.readAsText(file, 'UTF-8');
  else reader.readAsArrayBuffer(file);
}

function handleCSV(text, period, uploadType, filename) {
  const parseCSVLine = (line) => { const result = []; let current = ''; let inQuotes = false; for (let i = 0; i < line.length; i++) { const c = line[i]; if (c === '"') inQuotes = !inQuotes; else if (c === ',' && !inQuotes) { result.push(current.trim().replace(/^"|"$/g, '')); current = ''; } else current += c; } result.push(current.trim().replace(/^"|"$/g, '')); return result; };
  const lines = text.replace(/\r\n/g, '\n').split('\n').filter(l => l.trim()).map(l => parseCSVLine(l));
  if (lines.length < 2) { showStatus('CSVã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', true); return; }
  const headerStr = lines[0].join(',').toLowerCase();
  const fn = filename.toLowerCase();
  
  // å…¨è¡Œã®ãƒ†ã‚­ã‚¹ãƒˆã‚’çµåˆã—ã¦ãƒã‚§ãƒƒã‚¯
  const allText = lines.slice(0, 60).map(r => r.join(',')).join(' ').toLowerCase();
  
  const isCustomerList = fn.includes('é¡§å®¢ãƒªã‚¹ãƒˆ') || fn.includes('customer');
  const isUncollected = fn.includes('æœªå›å') || headerStr.includes('æ®‹æœªå›åé‡‘é¡');
  const isDelayed = fn.includes('é…ã‚Œå›å') || fn.includes('é…ã‚Œ');
  const isBonus = fn.includes('ãƒœãƒ¼ãƒŠã‚¹') && !allText.includes('ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼');
  const isAgent = fn.includes('ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ') || fn.includes('agent') || headerStr.includes('teamkyoto');
  const isAds = fn.includes('æ—¥æŠ¥') || fn.includes('åºƒå‘Š') || (headerStr.includes('ã‚³ã‚¹ãƒˆ') && headerStr.includes('ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³'));
  const isSloten = fn.includes('ã‚¹ãƒ­å¤©') || (headerStr.includes('é …ç›®å') && headerStr.includes('æœˆæ¬¡'));
  const isKonibet = fn.includes('konibet') || fn.includes('ã‚³ãƒ‹ãƒ™ãƒƒãƒˆ') || (headerStr.includes('sign-up') && headerStr.includes('ftd') && headerStr.includes('mau') && headerStr.includes('deposits'));
  
  // SAMé¡§å®¢ç®¡ç†ã‚·ãƒ¼ãƒˆã®æ¤œå‡º
  const isCustomerManagement = fn.includes('é¡§å®¢ç®¡ç†ã‚·ãƒ¼ãƒˆ') || (allText.includes('äº‹å‰ç²¾ç®—é‡‘é¡') && allText.includes('å›åç‡') && allText.includes('ä¿¡ç”¨æ é‡‘é¡'));
  
  // ç€é‡‘ç¢ºèªã‚·ãƒ¼ãƒˆã®æ¤œå‡º
  const isPaymentConfirm = fn.includes('ç€é‡‘') || fn.includes('ecç€é‡‘') || fn.includes('paypay') || fn.includes('ä»®æƒ³é€šè²¨') || fn.includes('å€‹äººç€é‡‘') || 
    (allText.includes('ç€é‡‘ç¢ºèª') && (allText.includes('å…¥é‡‘é¡') || allText.includes('å…¥é‡‘æ—¥')));
  
  // Konibetæ—¥æ¬¡KPIã‚·ãƒ¼ãƒˆï¼ˆæ—¥æœ¬èªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰ã®æ¤œå‡º
  // è¤‡æ•°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¯¾å¿œ
  const isKonibetDaily = (allText.includes('åç›®') && allText.includes('ç™»éŒ²') && allText.includes('ggr') && allText.includes('ngr')) ||
                         (allText.includes('ãƒ­ã‚¸ãƒƒã‚¯') && allText.match(/\d{4}\/\d{1,2}\/\d{1,2}/)) ||
                         (allText.includes('åˆå›å…¥é‡‘äººæ•°') && allText.includes('ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼')) ||
                         (allText.includes('ç›®æ¨™') && allText.includes('åˆè¨ˆ') && allText.includes('ç™»éŒ²') && allText.includes('ggr')) ||
                         (allText.includes('åˆè¨ˆ') && allText.includes('ftd') && allText.includes('ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼') && allText.includes('ngr')) ||
                         (allText.includes('å‰æœˆ') && allText.includes('åˆè¨ˆ') && allText.includes('ç™»éŒ²') && allText.includes('ggr')) ||
                         (allText.includes('å…ˆæœˆæ¯”è¼ƒ') && allText.includes('åˆè¨ˆ') && allText.includes('ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼'));
  
  if (uploadType === 'auto') {
    // Konibetæ—¥æ¬¡KPIã‚·ãƒ¼ãƒˆï¼ˆæ—¥æœ¬èªï¼‰ã‚’å„ªå…ˆçš„ã«ãƒã‚§ãƒƒã‚¯
    if (isKonibetDaily) { parseKonibetDailyCSV(lines, period, fn); return; }
    if (isKonibet) { parseKonibetCSV(lines, period, fn); return; }
    if (isSloten) { parseSlotenCSV(lines, period, fn); return; }
    if (isPaymentConfirm) { parsePaymentConfirmCSV(lines, period, fn, filename); return; }
    if (isCustomerManagement) { parseCustomerManagementCSV(lines, period, fn); return; }
    if (isCustomerList) { parseCustomerListCSV(lines, period, fn); return; }
    if (isUncollected) { parseUncollectedCSV(lines, period, fn); return; }
    if (isDelayed) { parseDelayedCSV(lines, period, fn); return; }
    if (isBonus) { parseBonusCSV(lines, period, fn); return; }
    if (isAgent) { parseAgentCSV(lines, period); return; }
    if (isAds) { parseAdsCSV(lines, period); return; }
  }
  if (uploadType === 'sloten') { parseSlotenCSV(lines, period, fn); return; }
  if (uploadType === 'konibet') { 
    // konibeté¸æŠæ™‚ã‚‚æ—¥æœ¬èªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯
    if (isKonibetDaily) { parseKonibetDailyCSV(lines, period, fn); return; }
    parseKonibetCSV(lines, period, fn); return; 
  }
  if (uploadType === 'customerList') { parseCustomerListCSV(lines, period, fn); return; }
  if (uploadType === 'uncollected') { parseUncollectedCSV(lines, period, fn); return; }
  if (uploadType === 'bonus') { parseBonusCSV(lines, period, fn); return; }
  if (uploadType === 'delayed') { parseDelayedCSV(lines, period, fn); return; }
  if (uploadType === 'agent') { parseAgentCSV(lines, period); return; }
  if (uploadType === 'ads') { parseAdsCSV(lines, period); return; }
  
  showStatus('CSVã®å½¢å¼ã‚’åˆ¤åˆ¥ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);
}

// ========== å„ç¨®CSVãƒ‘ãƒ¼ã‚µãƒ¼ ==========

// Konibet æ—¥æ¬¡KPIã‚·ãƒ¼ãƒˆç”¨ãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆæ—¥æœ¬èªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰
function parseKonibetDailyCSV(lines, period, filename) {
  // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆï¼ˆUSD â†’ JPYï¼‰- å…¥åŠ›æ¬„ã‹ã‚‰å–å¾—ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ150
  const rateInput = document.getElementById('usd-jpy-rate');
  const USD_TO_JPY = rateInput ? parseFloat(rateInput.value) || 150 : 150;
  
  // KPIãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆåç›® â†’ KPIåï¼‰
  const kpiMapping = {
    'ç™»éŒ²': 'ç™»éŒ²äººæ•°',
    'ãƒ­ã‚°ã‚¤ãƒ³': 'ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°',
    'åˆå›å…¥é‡‘äººæ•°(FTD)': 'FTDæ•°',
    'åˆå›å…¥é‡‘äººæ•°': 'FTDæ•°',
    'FTD': 'FTDæ•°',
    'åˆå›å…¥é‡‘é¡': 'åˆå›å…¥é‡‘é¡',
    'å…¥é‡‘äººæ•°': 'å…¥é‡‘è€…æ•°',
    'å…¥é‡‘é¡': 'ç·å…¥é‡‘é¡',
    'å®Ÿéš›ã®å‡ºé‡‘äººæ•°': 'å‡ºé‡‘è€…æ•°',
    'å®Ÿéš›ã®å‡ºé‡‘é¡': 'ç·å‡ºé‡‘é¡',
    'å‡ºé‡‘é¡': 'ç·å‡ºé‡‘é¡',
    'å…¥é‡‘ã¨å‡ºé‡‘ã®å·®': 'å…¥å‡ºé‡‘å·®åˆ†',
    'ãƒ™ãƒƒãƒˆäººæ•°': 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤äººæ•°',
    'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼': 'T/O',
    'GGR': 'GGR',
    'winé¡': 'å‹åˆ©é‡‘',
    'ãƒœãƒ¼ãƒŠã‚¹ï¼ˆFSé™¤ãï¼‰': 'ãƒœãƒ¼ãƒŠã‚¹',
    'ãƒœãƒ¼ãƒŠã‚¹': 'ãƒœãƒ¼ãƒŠã‚¹',
    'ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼': 'ã‚²ãƒ¼ãƒ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ•ã‚£ãƒ¼',
    'PSPæ‰‹æ•°æ–™': 'PSPæ‰‹æ•°æ–™',
    'AFFå ±é…¬': 'AFFå ±é…¬',
    'NGR': 'NGR',
    'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…æ®‹é«˜': 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæ®‹é«˜',
    'æ–°è¦å…¥é‡‘è»¢ç§»ç‡': 'æ–°è¦å…¥é‡‘è»¢ç§»ç‡',
    'å¹³å‡å…¥é‡‘é¡(äººæ•°/ãƒ‡ã‚¤ãƒª)': 'å¹³å‡å…¥é‡‘é¡',
    'å¹³å‡å…¥é‡‘é¡(daily)': 'å¹³å‡å…¥é‡‘é¡',
    'å‡ºé‡‘äººæ•°å‰²åˆ': 'å‡ºé‡‘äººæ•°å‰²åˆ',
    'å‡ºé‡‘å‰²åˆ(ãƒœãƒ¼ãƒŠã‚¹è¾¼ã¿)': 'å‡ºé‡‘å‰²åˆ',
    'T/Oå€ç‡': 'T/Oå€ç‡',
    'T/Oå€ç‡(Bonusè¾¼)': 'T/Oå€ç‡(Bonusè¾¼)',
    'ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸ç‡(å…¥é‡‘ã«å¯¾ã—ã¦)': 'ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸ç‡',
    'å…¥é‡‘é¡ã«å¯¾ã—ã¦ã®GGRå‰²åˆ': 'GGRç‡',
    'å…¥é‡‘ã«å¯¾ã—ã¦ã®NGRå‰²åˆ': 'NGRç‡',
    'RTP(ã‚²ãƒ¼ãƒ ç¨®é¡ã”ã¨ã«è¨ˆæ¸¬ã—ã¦ã„ãå¿…è¦ã‚ã‚Š)': 'RTP',
    'RTP': 'RTP',
    'LTV(GGRãƒ™ãƒ¼ã‚¹)': 'LTV(GGR)',
    'LTV(GGRãƒ™ãƒ¼ã‚¹)å®Ÿå…¥é‡‘äººæ•°': 'LTV(GGR)',
    'LTV(NGRãƒ™ãƒ¼ã‚¹)': 'LTV(NGR)',
    'LTV(NGRãƒ™ãƒ¼ã‚¹)å®Ÿå…¥é‡‘äººæ•°': 'LTV(NGR)'
  };
  
  // USDãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆç‚ºæ›¿æ›ç®—ãŒå¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
  const usdFields = [
    'åˆå›å…¥é‡‘é¡', 'å…¥é‡‘é¡', 'å‡ºé‡‘é¡', 'å…¥é‡‘ã¨å‡ºé‡‘ã®å·®', 'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼', 
    'GGR', 'winé¡', 'ãƒœãƒ¼ãƒŠã‚¹ï¼ˆFSé™¤ãï¼‰', 'ãƒœãƒ¼ãƒŠã‚¹', 'ã‚²ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼', 
    'PSPæ‰‹æ•°æ–™', 'NGR', 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…æ®‹é«˜', 'å¹³å‡å…¥é‡‘é¡(äººæ•°/ãƒ‡ã‚¤ãƒª)', 'å¹³å‡å…¥é‡‘é¡(daily)',
    'å®Ÿéš›ã®å‡ºé‡‘é¡', 'LTV(GGRãƒ™ãƒ¼ã‚¹)', 'LTV(NGRãƒ™ãƒ¼ã‚¹)', 'ãƒœãƒ¼ãƒŠã‚¹ï¼‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼‹PSP',
    'ãƒœãƒ¼ãƒŠã‚¹ï¼‹ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ï¼‹PSPï¼‹AFF', 'AFFå ±é…¬', 'LTV(GGRãƒ™ãƒ¼ã‚¹)å®Ÿå…¥é‡‘äººæ•°', 'LTV(NGRãƒ™ãƒ¼ã‚¹)å®Ÿå…¥é‡‘äººæ•°'
  ];
  
  const summary = {};
  let headerRowIndex = -1;
  let labelColIndex = -1;  // KPIåã®åˆ—
  let totalColIndex = -1;  // åˆè¨ˆã®åˆ—
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’æ¢ã™
  // è¤‡æ•°ã®å½¢å¼ã«å¯¾å¿œ: ã€Œåˆè¨ˆã€åˆ—ã‚’æ¢ã—ã¦ãã®ä½ç½®ã‚’åŸºæº–ã«ã™ã‚‹
  for (let i = 0; i < Math.min(5, lines.length); i++) {
    const row = lines[i];
    if (!row) continue;
    
    // ã€Œåˆè¨ˆã€åˆ—ã‚’æ¢ã™
    let totalIdx = row.findIndex(cell => String(cell || '').trim() === 'åˆè¨ˆ');
    if (totalIdx < 0) continue;
    
    // å½¢å¼ã‚’åˆ¤å®šï¼ˆãƒ‡ãƒ¼ã‚¿è¡Œã®æœ€åˆã®åˆ—ã«KPIåãŒã‚ã‚‹ï¼‰
    headerRowIndex = i;
    labelColIndex = 0;  // KPIåã¯å¸¸ã«åˆ—0
    totalColIndex = totalIdx;
    break;
  }
  
  if (headerRowIndex < 0) {
    showStatus('Konibetæ—¥æ¬¡KPIã‚·ãƒ¼ãƒˆã®å½¢å¼ã‚’èªè­˜ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);
    return;
  }
  
  // æœŸé–“åã‚’å–å¾—ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã®æ—¥ä»˜ã‹ã‚‰ï¼‰
  let periodName = period;
  const headerRow = lines[headerRowIndex];
  for (let j = totalColIndex + 1; j < headerRow.length; j++) {
    const cell = String(headerRow[j] || '').trim();
    // ã€Œ1æœˆ1æ—¥(é‡‘)ã€ã‚„ã€Œ12æœˆ1æ—¥(ç«)ã€å½¢å¼
    const dateMatch = cell.match(/(\d{1,2})æœˆ(\d{1,2})æ—¥/);
    if (dateMatch) {
      const month = parseInt(dateMatch[1]);
      // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰å¹´ã‚’æ¨æ¸¬ã€ãªã‘ã‚Œã°æœŸé–“å…¥åŠ›æ¬„ã‹ã‚‰
      const yearMatch = filename.match(/(202\d)/);
      let year = yearMatch ? yearMatch[1] : null;
      if (!year) {
        const inputPeriod = document.getElementById('upload-period')?.value || '';
        const inputYearMatch = inputPeriod.match(/(202\d)/);
        year = inputYearMatch ? inputYearMatch[1] : '2022';
      }
      periodName = `${year}å¹´${month}æœˆ`;
      break;
    }
  }
  
  // ãƒ‡ãƒ¼ã‚¿è¡Œã‚’èª­ã¿å–ã‚Š
  for (let i = headerRowIndex + 1; i < lines.length; i++) {
    const row = lines[i];
    if (!row || row.length < totalColIndex + 1) continue;
    
    let rawLabel = String(row[labelColIndex] || '').trim();
    if (!rawLabel || rawLabel === '' || rawLabel.startsWith('çµ±è¨ˆ')) continue;
    
    // ã‚¹ãƒšãƒ¼ã‚¹ã‚„ç‰¹æ®Šæ–‡å­—ã‚’æ­£è¦åŒ–
    rawLabel = rawLabel.replace(/\s+/g, '');
    
    // åˆè¨ˆåˆ—ã®å€¤ã‚’å–å¾—
    const totalVal = row[totalColIndex];
    if (totalVal === undefined || totalVal === null || totalVal === '') continue;
    
    // #DIV/0! ãªã©ã®ã‚¨ãƒ©ãƒ¼å€¤ã‚’ã‚¹ã‚­ãƒƒãƒ—
    if (String(totalVal).includes('#')) continue;
    
    // KPIåã‚’ãƒãƒƒãƒ”ãƒ³ã‚°
    const kpiName = kpiMapping[rawLabel] || rawLabel;
    
    // å€¤ã‚’ãƒ‘ãƒ¼ã‚¹
    let val = parseNumber(totalVal);
    if (val === null) continue;
    
    // USDãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å ´åˆã¯ç‚ºæ›¿æ›ç®—
    if (usdFields.some(f => rawLabel.includes(f) || rawLabel === f)) {
      val = val * USD_TO_JPY;
    }
    
    // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å ´åˆ
    const isPercent = rawLabel.includes('ç‡') || rawLabel.includes('å‰²åˆ') || rawLabel.includes('RTP');
    if (isPercent && Math.abs(val) > 1) {
      val = val / 100; // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¡¨è¨˜ã‚’å°æ•°ã«å¤‰æ›
    }
    
    // é‡è¤‡ã‚­ãƒ¼ã¯æœ€åˆã®å€¤ã‚’å„ªå…ˆï¼ˆGGRãªã©ï¼‰
    if (summary[kpiName] === undefined) {
      summary[kpiName] = val;
    }
  }
  
  // è¨ˆç®—é …ç›®ã‚’è¿½åŠ 
  if (summary['ç·å…¥é‡‘é¡'] && summary['ç·å‡ºé‡‘é¡'] && !summary['å…¥å‡ºé‡‘å·®åˆ†']) {
    summary['å…¥å‡ºé‡‘å·®åˆ†'] = summary['ç·å…¥é‡‘é¡'] - summary['ç·å‡ºé‡‘é¡'];
  }
  if (summary['T/O'] && summary['å‹åˆ©é‡‘'] && !summary['GGR']) {
    summary['GGR'] = summary['T/O'] - summary['å‹åˆ©é‡‘'];
  }
  if (summary['GGR'] && summary['T/O'] && !summary['RTP']) {
    summary['RTP'] = summary['å‹åˆ©é‡‘'] / summary['T/O'];
  }
  
  // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜
  summary['ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ(USD/JPY)'] = USD_TO_JPY;
  
  // BUSINESSESã«ä¿å­˜ï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒ¼ã‚¸ï¼‰
  const existingKonibet = BUSINESSES['Konibet'].data[periodName]?.ã‚µãƒãƒªãƒ¼ || {};
  BUSINESSES['Konibet'].data[periodName] = {
    ...BUSINESSES['Konibet'].data[periodName],
    ã‚µãƒãƒªãƒ¼: { ...existingKonibet, ...summary }
  };
  
  const kpiCount = Object.keys(summary).length;
  showStatus(`Konibetæ—¥æ¬¡KPIå–è¾¼å®Œäº†: ${periodName} (${kpiCount}é …ç›®) â€»USDâ†’JPY: Â¥${USD_TO_JPY}æ›ç®—`);
  selectBusiness('Konibet'); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseKonibetCSV(lines, period, filename) {
  // Konibet KPI CSVãƒ‘ãƒ¼ã‚µãƒ¼
  // CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
  // è¡Œ1: ãƒ˜ãƒƒãƒ€ãƒ¼ (,KPI,sign-up,FTD,MAU,Deposits,T/0,AFF cost,NGR)
  // è¡Œ2-13: æœˆåˆ¥KPIç›®æ¨™å€¤
  // è¡Œ16ä»¥é™: å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ï¼ˆé€±æ¬¡ï¼‰
  
  // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆï¼ˆUSD â†’ JPYï¼‰- å…¥åŠ›æ¬„ã‹ã‚‰å–å¾—ã€ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ150
  const rateInput = document.getElementById('usd-jpy-rate');
  const USD_TO_JPY = rateInput ? parseFloat(rateInput.value) || 150 : 150;
  
  const yearMatch = filename.match(/202[0-9]/);
  const year = yearMatch ? yearMatch[0] : new Date().getFullYear().toString();
  
  const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  const monthsJP = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
  
  // KPIç›®æ¨™å€¤ã‚’èª­ã¿å–ã‚Šï¼ˆè¡Œ2-13ï¼‰
  const targets = {};
  for (let i = 1; i <= 13; i++) {
    const row = lines[i];
    if (!row || row.length < 8) continue;
    const monthName = String(row[1] || '').trim();
    const monthIdx = months.findIndex(m => m.toLowerCase() === monthName.toLowerCase());
    if (monthIdx < 0) continue;
    
    targets[monthsJP[monthIdx]] = {
      'ç™»éŒ²ç›®æ¨™': parseNumber(row[2]) || 0,
      'FTDç›®æ¨™': parseNumber(row[3]) || 0,
      'MAUç›®æ¨™': parseNumber(row[4]) || 0,
      'å…¥é‡‘é¡ç›®æ¨™': (parseNumber(row[5]) || 0) * USD_TO_JPY,
      'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼ç›®æ¨™': (parseNumber(row[6]) || 0) * USD_TO_JPY,
      'AFFå›ºå®šè²»ç›®æ¨™': (parseNumber(row[7]) || 0) * USD_TO_JPY,
      'NGRç›®æ¨™': (parseNumber(row[8]) || 0) * USD_TO_JPY
    };
  }
  
  // å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Š
  let currentMonth = null;
  let monthlyData = {};
  let weeklyDetails = {};
  
  for (let i = 16; i < lines.length; i++) {
    const row = lines[i];
    if (!row || row.length < 8) continue;
    
    const col0 = String(row[0] || '').trim();
    const col1 = String(row[1] || '').trim();
    
    // æœˆåã®æ¤œå‡º
    const monthIdx = months.findIndex(m => m.toLowerCase() === col0.toLowerCase());
    if (monthIdx >= 0) {
      currentMonth = monthsJP[monthIdx];
      if (!monthlyData[currentMonth]) {
        monthlyData[currentMonth] = { weeks: [], totals: null };
        weeklyDetails[currentMonth] = [];
      }
    }
    
    if (!currentMonth) continue;
    
    // Weekè¡Œã¾ãŸã¯In Totalè¡Œ
    const isWeek = col1.toLowerCase().includes('week');
    const isTotal = col1.toLowerCase().includes('in total') || col1.toLowerCase().includes('total');
    
    if (isWeek || isTotal) {
      const weekData = {
        é€±: col1,
        ç™»éŒ²: parseNumber(row[2]) || 0,
        FTD: parseNumber(row[3]) || 0,
        MAU: parseNumber(row[4]) || 0,
        å…¥é‡‘é¡: (parseNumber(row[5]) || 0) * USD_TO_JPY,
        ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼: (parseNumber(row[6]) || 0) * USD_TO_JPY,
        'AFFå›ºå®šè²»': (parseNumber(row[7]) || 0) * USD_TO_JPY,
        NGR: (parseNumber(row[8]) || 0) * USD_TO_JPY,
        'ç™»éŒ²é”æˆç‡': parseNumber(row[9]) || 0,
        'FTDé”æˆç‡': parseNumber(row[10]) || 0,
        'MAUé”æˆç‡': parseNumber(row[11]) || 0,
        'å…¥é‡‘é¡é”æˆç‡': parseNumber(row[12]) || 0,
        'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼é”æˆç‡': parseNumber(row[13]) || 0,
        'AFFå›ºå®šè²»é”æˆç‡': parseNumber(row[14]) || 0,
        'NGRé”æˆç‡': parseNumber(row[15]) || 0
      };
      
      if (isTotal) {
        monthlyData[currentMonth].totals = weekData;
      } else {
        weeklyDetails[currentMonth].push(weekData);
      }
    }
  }
  
  // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«å¤‰æ›
  let count = 0;
  Object.keys(monthlyData).forEach(month => {
    const data = monthlyData[month];
    const target = targets[month] || {};
    const totals = data.totals || {};
    
    // å®Ÿç¸¾ãŒãªã„æœˆã¯ã‚¹ã‚­ãƒƒãƒ—
    if (!totals.ç™»éŒ² && !totals.FTD && !totals.MAU) return;
    
    const periodName = `${year}å¹´${month}`;
    const summary = {
      // å®Ÿç¸¾
      'ç™»éŒ²': totals.ç™»éŒ² || 0,
      'FTD': totals.FTD || 0,
      'MAU': totals.MAU || 0,
      'å…¥é‡‘é¡': totals.å…¥é‡‘é¡ || 0,
      'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼': totals.ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼ || 0,
      'AFFå›ºå®šè²»': totals['AFFå›ºå®šè²»'] || 0,
      'NGR': totals.NGR || 0,
      // ç›®æ¨™
      'ç™»éŒ²ç›®æ¨™': target['ç™»éŒ²ç›®æ¨™'] || 0,
      'FTDç›®æ¨™': target['FTDç›®æ¨™'] || 0,
      'MAUç›®æ¨™': target['MAUç›®æ¨™'] || 0,
      'å…¥é‡‘é¡ç›®æ¨™': target['å…¥é‡‘é¡ç›®æ¨™'] || 0,
      'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼ç›®æ¨™': target['ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼ç›®æ¨™'] || 0,
      'AFFå›ºå®šè²»ç›®æ¨™': target['AFFå›ºå®šè²»ç›®æ¨™'] || 0,
      'NGRç›®æ¨™': target['NGRç›®æ¨™'] || 0,
      // é”æˆç‡
      'ç™»éŒ²é”æˆç‡': totals['ç™»éŒ²é”æˆç‡'] || 0,
      'FTDé”æˆç‡': totals['FTDé”æˆç‡'] || 0,
      'MAUé”æˆç‡': totals['MAUé”æˆç‡'] || 0,
      'å…¥é‡‘é¡é”æˆç‡': totals['å…¥é‡‘é¡é”æˆç‡'] || 0,
      'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼é”æˆç‡': totals['ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼é”æˆç‡'] || 0,
      'NGRé”æˆç‡': totals['NGRé”æˆç‡'] || 0,
      // ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ
      'ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ(USD/JPY)': USD_TO_JPY
    };
    
    // é€±æ¬¡è©³ç´°ãƒ‡ãƒ¼ã‚¿
    const weeks = weeklyDetails[month] || [];
    
    // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒ¼ã‚¸
    const existingKonibet2 = BUSINESSES['Konibet'].data[periodName]?.ã‚µãƒãƒªãƒ¼ || {};
    const existingWeeks = BUSINESSES['Konibet'].data[periodName]?.é€±æ¬¡è©³ç´° || [];
    BUSINESSES['Konibet'].data[periodName] = {
      ...BUSINESSES['Konibet'].data[periodName],
      ã‚µãƒãƒªãƒ¼: { ...existingKonibet2, ...summary },
      ...(weeks.length > 0 ? { é€±æ¬¡è©³ç´°: weeks } : (existingWeeks.length > 0 ? { é€±æ¬¡è©³ç´°: existingWeeks } : {}))
    };
    count++;
  });
  
  showStatus(`Konibet KPIå–è¾¼å®Œäº†: ${count}æœŸé–“ (${year}å¹´) â€»USDâ†’JPY: Â¥${USD_TO_JPY}æ›ç®—`);
  selectBusiness('Konibet'); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseSlotenCSV(lines, period, filename) {
  const kpi = {};
  let periodName = period;
  const match = filename.match(/(\d{4})(\d{2})/);
  if (match) periodName = `${match[1]}å¹´${parseInt(match[2])}æœˆ`;
  lines.forEach((row, idx) => { if (!row || row.length < 2) return; const rawLabel = String(row[0] || '').trim(); if (!rawLabel || rawLabel === 'é …ç›®å') return; const val = parseNumber(row[1]); if (val === null) return; const cleanLabel = rawLabel.split('/')[0].trim(); if (idx < 90 || kpi[cleanLabel] === undefined) kpi[cleanLabel] = val; });
  if (kpi['å…¥å‡ºé‡‘å·®åˆ†'] === undefined && kpi['ç·å…¥é‡‘é¡'] !== undefined && kpi['ç·å‡ºé‡‘é¡'] !== undefined) kpi['å…¥å‡ºé‡‘å·®åˆ†'] = kpi['ç·å…¥é‡‘é¡'] - kpi['ç·å‡ºé‡‘é¡'];
  const existingSloten = BUSINESSES['ã‚¹ãƒ­å¤©'].data[periodName]?.ã‚µãƒãƒªãƒ¼ || {};
  BUSINESSES['ã‚¹ãƒ­å¤©'].data[periodName] = { ...BUSINESSES['ã‚¹ãƒ­å¤©'].data[periodName], ã‚µãƒãƒªãƒ¼: { ...existingSloten, ...kpi } };
  showStatus(`ã‚¹ãƒ­å¤©KPIå–è¾¼å®Œäº†: ${periodName}`);
  selectBusiness('ã‚¹ãƒ­å¤©'); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseCustomerListCSV(lines, period, filename) {
  const fn = filename.toLowerCase();
  const isDSC = fn.includes('ãƒªã‚¹ãƒˆd') || fn.includes('d.csv') || filename.includes('ãƒªã‚¹ãƒˆD') || filename.includes('é¡§å®¢ãƒªã‚¹ãƒˆD');
  const target = isDSC ? 'DSC' : 'å…ƒamuse';
  
  // 4è¡Œç›®ï¼ˆindex 3ï¼‰ãŒãƒ˜ãƒƒãƒ€ãƒ¼è¡Œ
  const headerRowIdx = 3;
  const header = lines[headerRowIdx] || [];
  const colIdx = {};
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
  header.forEach((h, idx) => { 
    const col = String(h).trim(); 
    if (col === 'FULLNAME1' || col === 'åå‰') colIdx.name = idx; 
    if (col === 'credit' || col === 'ä¿¡ç”¨æ ' || col === 'Credit') colIdx.credit = idx; 
    if (col.includes('ãƒˆãƒ¼ã‚¿ãƒ«å›åé¡') || col === 'å›åé¡') colIdx.collected = idx; 
    if (col.includes('ãƒˆãƒ¼ã‚¿ãƒ«å‡ºé‡‘é¡') || col === 'å‡ºé‡‘é¡') colIdx.withdraw = idx; 
    if (col.includes('ãƒˆãƒ¼ã‚¿ãƒ«å·®åˆ†åˆ©ç›Š') || col === 'å·®åˆ†åˆ©ç›Š') colIdx.diff = idx; 
    if (col === 'å…¥é‡‘å›æ•°') colIdx.depCount = idx; 
    if (col === 'å‡ºé‡‘å›æ•°') colIdx.wdCount = idx; 
    if (col === 'NGR' && !colIdx.ngr) colIdx.ngr = idx;
    if (col === 'ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸ç·é‡‘é¡' || col === 'ãƒœãƒ¼ãƒŠã‚¹' || col.includes('ãƒœãƒ¼ãƒŠã‚¹')) colIdx.bonus = idx;
    if (col === 'ãƒ—ãƒ¬ã‚¤æœˆé–“' || col.includes('ãƒ—ãƒ¬ã‚¤æœˆ')) colIdx.playMonths = idx;
    if (col === 'äº‹å‰æ¸…ç®—å›æ•°' || col === 'äº‹å‰å›æ•°') colIdx.preSettleCount = idx;
    if (col === 'äº‹å‰æ¸…ç®—é‡‘é¡' || col === 'äº‹å‰é‡‘é¡') colIdx.preSettleAmount = idx;
    if (col === 'é€šå¸¸æ¸…ç®—å›æ•°' || col === 'é€šå¸¸å›æ•°' || col === 'å›åå›æ•°') colIdx.normalSettleCount = idx;
    if (col === 'é€šå¸¸æ¸…ç®—é‡‘é¡' || col === 'é€šå¸¸é‡‘é¡' || col === 'å›åé‡‘é¡') colIdx.normalSettleAmount = idx;
    if (col === 'ãƒªã‚¹ãƒˆç¨®åˆ¥' || col === 'ãƒªã‚¹ãƒˆ' || col === 'List') colIdx.listType = idx;
    if (col === 'FTD' || col === 'FTDæ—¥') colIdx.ftdDate = idx;
    if (col === 'FTW' || col === 'FTWæ—¥') colIdx.ftwDate = idx;
  });
  
  // ARåˆ—(44)ã‹ã‚‰BEåˆ—(57)ã®ç¯„å›²ã‚‚ãƒã‚§ãƒƒã‚¯ï¼ˆãƒªã‚¹ãƒˆç¨®åˆ¥ç”¨ï¼‰- 0å§‹ã¾ã‚Šãªã®ã§43ã‹ã‚‰56
  if (colIdx.listType === undefined) {
    for (let i = 43; i <= 56; i++) {
      const col = String(header[i] || '').trim();
      if (col === 'ãƒªã‚¹ãƒˆç¨®åˆ¥' || col === 'ãƒªã‚¹ãƒˆ' || col === 'List' || col.includes('ãƒªã‚¹ãƒˆ')) {
        colIdx.listType = i;
        break;
      }
    }
  }
  
  let stats = { 
    ç·ç™»éŒ²æ•°: 0, ç·å›åé¡: 0, ç·å‡ºé‡‘é¡: 0, ç·å·®åˆ†åˆ©ç›Š: 0, ç·NGR: 0, 
    FTDæ•°: 0, FTWæ•°: 0, FTDWæ•°: 0, ç·ä¿¡ç”¨æ : 0, ç·ãƒœãƒ¼ãƒŠã‚¹: 0, ç·ãƒ—ãƒ¬ã‚¤æœˆé–“: 0, 
    äº‹å‰æ¸…ç®—å›æ•°: 0, äº‹å‰æ¸…ç®—é‡‘é¡: 0, é€šå¸¸æ¸…ç®—å›æ•°: 0, é€šå¸¸æ¸…ç®—é‡‘é¡: 0 
  };
  const listTypes = {};
  
  // 5è¡Œç›®ï¼ˆindex 4ï¼‰ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿é–‹å§‹
  for (let i = headerRowIdx + 1; i < lines.length; i++) { 
    const row = lines[i]; 
    if (!row || row.length < 5) continue; 
    
    const nameIdx = colIdx.name !== undefined ? colIdx.name : 1;
    const name = String(row[nameIdx] || '').trim(); 
    if (!name || name === 'æ‹…å½“è€…' || name.includes('ã‚»ãƒ«') || name === '' || name === 'FULLNAME1') continue;
    
    stats.ç·ç™»éŒ²æ•°++; 
    
    const collected = parseNumber(row[colIdx.collected]) || 0; 
    const withdraw = parseNumber(row[colIdx.withdraw]) || 0; 
    const diff = parseNumber(row[colIdx.diff]) || 0; 
    const ngr = parseNumber(row[colIdx.ngr]) || 0; 
    const credit = parseNumber(row[colIdx.credit]) || 0; 
    const bonus = parseNumber(row[colIdx.bonus]) || 0;
    const playMonths = parseNumber(row[colIdx.playMonths]) || 0;
    const preSettleCount = parseNumber(row[colIdx.preSettleCount]) || 0;
    const preSettleAmount = parseNumber(row[colIdx.preSettleAmount]) || 0;
    const normalSettleCount = parseNumber(row[colIdx.normalSettleCount]) || 0;
    const normalSettleAmount = parseNumber(row[colIdx.normalSettleAmount]) || 0;
    const depCount = parseNumber(row[colIdx.depCount]) || 0; 
    const wdCount = parseNumber(row[colIdx.wdCount]) || 0; 
    
    stats.ç·å›åé¡ += collected; 
    stats.ç·å‡ºé‡‘é¡ += withdraw; 
    stats.ç·å·®åˆ†åˆ©ç›Š += diff; 
    stats.ç·NGR += ngr; 
    stats.ç·ä¿¡ç”¨æ  += credit;
    stats.ç·ãƒœãƒ¼ãƒŠã‚¹ += bonus;
    stats.ç·ãƒ—ãƒ¬ã‚¤æœˆé–“ += playMonths;
    stats.äº‹å‰æ¸…ç®—å›æ•° += preSettleCount;
    stats.äº‹å‰æ¸…ç®—é‡‘é¡ += preSettleAmount;
    stats.é€šå¸¸æ¸…ç®—å›æ•° += normalSettleCount;
    stats.é€šå¸¸æ¸…ç®—é‡‘é¡ += normalSettleAmount;
    
    // FTD/FTWåˆ¤å®š
    const ftdDate = row[colIdx.ftdDate] ? String(row[colIdx.ftdDate]).trim() : '';
    const ftwDate = row[colIdx.ftwDate] ? String(row[colIdx.ftwDate]).trim() : '';
    const hasFTD = ftdDate !== '' || depCount > 0 || collected > 0; 
    const hasFTW = ftwDate !== '' || wdCount > 0 || withdraw > 0; 
    if (hasFTD) { stats.FTDæ•°++; if (hasFTW) stats.FTDWæ•°++; } 
    if (hasFTW) stats.FTWæ•°++;
    
    // ãƒªã‚¹ãƒˆç¨®åˆ¥é›†è¨ˆï¼ˆB, E, T, S, BE, C, ç´¹ä»‹ã®ã¿ã€ãã‚Œä»¥å¤–ã¯ãã®ä»–ï¼‰
    if (colIdx.listType !== undefined) {
      let listType = String(row[colIdx.listType] || '').trim();
      if (listType && listType !== '' && listType !== 'ãƒªã‚¹ãƒˆç¨®åˆ¥') {
        const validTypes = ['B', 'E', 'T', 'S', 'BE', 'C', 'ç´¹ä»‹'];
        if (!validTypes.includes(listType)) {
          listType = 'ãã®ä»–';
        }
        if (!listTypes[listType]) listTypes[listType] = 0;
        listTypes[listType]++;
      }
    }
  }
  
  // è¨ˆç®—é …ç›®
  stats['FTDç‡'] = stats.ç·ç™»éŒ²æ•° > 0 ? stats.FTDæ•° / stats.ç·ç™»éŒ²æ•° : 0;
  stats['FTWç‡'] = stats.ç·ç™»éŒ²æ•° > 0 ? stats.FTWæ•° / stats.ç·ç™»éŒ²æ•° : 0;
  stats['FTDWç‡'] = stats.FTDæ•° > 0 ? stats.FTDWæ•° / stats.FTDæ•° : 0;
  stats['å›åå‡ºé‡‘å·®åˆ†'] = stats.ç·å›åé¡ - stats.ç·å‡ºé‡‘é¡;
  stats['å¹³å‡ä¿¡ç”¨æ '] = stats.ç·ç™»éŒ²æ•° > 0 ? stats.ç·ä¿¡ç”¨æ  / stats.ç·ç™»éŒ²æ•° : 0;
  stats['å¹³å‡Creditå˜ä¾¡'] = stats.FTDæ•° > 0 ? stats.ç·ä¿¡ç”¨æ  / stats.FTDæ•° : 0;
  stats['å¹³å‡ãƒ—ãƒ¬ã‚¤æœˆé–“'] = stats.ç·ç™»éŒ²æ•° > 0 ? stats.ç·ãƒ—ãƒ¬ã‚¤æœˆé–“ / stats.ç·ç™»éŒ²æ•° : 0;
  
  // äº‹å‰æ¸…ç®—ãƒ»é€šå¸¸æ¸…ç®—ã®å‰²åˆ
  const totalSettleAmount = stats.äº‹å‰æ¸…ç®—é‡‘é¡ + stats.é€šå¸¸æ¸…ç®—é‡‘é¡;
  const totalSettleCount = stats.äº‹å‰æ¸…ç®—å›æ•° + stats.é€šå¸¸æ¸…ç®—å›æ•°;
  stats['äº‹å‰æ¸…ç®—å‰²åˆ'] = totalSettleAmount > 0 ? stats.äº‹å‰æ¸…ç®—é‡‘é¡ / totalSettleAmount : 0;
  stats['é€šå¸¸æ¸…ç®—å‰²åˆ'] = totalSettleAmount > 0 ? stats.é€šå¸¸æ¸…ç®—é‡‘é¡ / totalSettleAmount : 0;
  stats['äº‹å‰æ¸…ç®—ä»¶æ•°å‰²åˆ'] = totalSettleCount > 0 ? stats.äº‹å‰æ¸…ç®—å›æ•° / totalSettleCount : 0;
  stats['é€šå¸¸æ¸…ç®—ä»¶æ•°å‰²åˆ'] = totalSettleCount > 0 ? stats.é€šå¸¸æ¸…ç®—å›æ•° / totalSettleCount : 0;
  
  const existing = BUSINESSES[target].data[period]?.ã‚µãƒãƒªãƒ¼ || {};
  // 0ã®å€¤ã§æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ãªã„
  const mergedStats = { ...existing };
  Object.entries(stats).forEach(([key, val]) => {
    if (val !== 0 || existing[key] === undefined) {
      mergedStats[key] = val;
    }
  });
  BUSINESSES[target].data[period] = { 
    ã‚µãƒãƒªãƒ¼: mergedStats,
    ...(Object.keys(listTypes).length > 0 ? { ãƒªã‚¹ãƒˆç¨®åˆ¥: listTypes } : (BUSINESSES[target].data[period]?.ãƒªã‚¹ãƒˆç¨®åˆ¥ ? { ãƒªã‚¹ãƒˆç¨®åˆ¥: BUSINESSES[target].data[period].ãƒªã‚¹ãƒˆç¨®åˆ¥ } : {}))
  };
  
  const listInfo = Object.keys(listTypes).length > 0 ? `, ãƒªã‚¹ãƒˆç¨®åˆ¥${Object.keys(listTypes).length}ç¨®(${Object.entries(listTypes).map(([k,v])=>k+':'+v).join(',')})` : '';
  showStatus(`é¡§å®¢ãƒªã‚¹ãƒˆå–è¾¼å®Œäº†: ${target} ${stats.ç·ç™»éŒ²æ•°}ä»¶, FTD${stats.FTDæ•°}ä»¶, äº‹å‰æ¸…ç®—${stats.äº‹å‰æ¸…ç®—å›æ•°}ä»¶/${formatCurrency(stats.äº‹å‰æ¸…ç®—é‡‘é¡)}${listInfo}`);
  selectBusiness(target); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseUncollectedCSV(lines, period, filename) {
  const fn = filename.toLowerCase();
  const isDSC = fn.includes('ã‚·ãƒ¼ãƒˆd') || fn.includes('d.csv') || filename.includes('ã‚·ãƒ¼ãƒˆD');
  const target = isDSC ? 'DSC' : 'å…ƒamuse';
  let total = 0, count = 0;
  for (let i = 0; i < Math.min(5, lines.length); i++) { const row = lines[i]; if (!row) continue; const rowStr = row.join(','); if (rowStr.includes('æœªå›åé‡‘ç·é¡')) { for (let j = 0; j < row.length; j++) { const val = parseNumber(row[j]); if (val && val > 1000000) { total = val; break; } } for (let j = 0; j < row.length; j++) { const val = parseNumber(row[j]); if (val && val > 0 && val < 10000) { count = val; break; } } break; } }
  if (total === 0) { const colIdx = lines[0].findIndex(h => String(h).includes('æ®‹æœªå›å')); for (let i = 1; i < lines.length; i++) { const val = parseNumber(lines[i][colIdx >= 0 ? colIdx : 0]) || 0; total += val; } count = lines.length - 1; }
  const data = { 'æœªå›åè€…æ•°': count, 'æ®‹æœªå›åé‡‘é¡': total };
  const existing = BUSINESSES[target].data[period]?.ã‚µãƒãƒªãƒ¼ || {};
  BUSINESSES[target].data[period] = { ã‚µãƒãƒªãƒ¼: { ...existing, ...data } };
  showStatus(`æœªå›åã‚·ãƒ¼ãƒˆå–è¾¼å®Œäº†: ${target} ${count}äºº, ${formatCurrency(total)}`);
  selectBusiness(target); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseBonusCSV(lines, period, filename) {
  const fn = filename.toLowerCase();
  const isDSC = fn.includes('ãƒœãƒ¼ãƒŠã‚¹d') || fn.includes('d.csv') || filename.includes('ãƒœãƒ¼ãƒŠã‚¹D');
  const target = isDSC ? 'DSC' : 'å…ƒamuse';
  let totalBonus = 0, count = 0;
  for (let i = 0; i < lines.length; i++) { const row = lines[i]; if (!row) continue; const firstCol = String(row[0] || '').trim().toUpperCase(); if (firstCol === 'TOTAL') { totalBonus = parseNumber(row[1]) || 0; break; } }
  let foundTotal = false;
  for (let i = 1; i < lines.length; i++) { const row = lines[i]; if (!row) continue; const firstCol = String(row[0] || '').trim().toUpperCase(); if (firstCol === 'TOTAL') { foundTotal = true; continue; } if (!foundTotal) continue; if (row[3] && String(row[3]).trim()) count++; }
  const data = { 'ãƒœãƒ¼ãƒŠã‚¹å¯¾è±¡è€…æ•°': count, 'ç·ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸é‡‘é¡': totalBonus };
  const existing = BUSINESSES[target].data[period]?.ã‚µãƒãƒªãƒ¼ || {};
  BUSINESSES[target].data[period] = { ã‚µãƒãƒªãƒ¼: { ...existing, ...data } };
  showStatus(`ãƒœãƒ¼ãƒŠã‚¹ã‚·ãƒ¼ãƒˆå–è¾¼å®Œäº†: ${target} ${count}äºº, ${formatCurrency(totalBonus)}`);
  selectBusiness(target); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseDelayedCSV(lines, period, filename) {
  const fn = filename.toLowerCase();
  const isDSC = fn.includes('å›åd') || fn.includes('d.csv') || filename.includes('å›åD');
  const target = isDSC ? 'DSC' : 'å…ƒamuse';
  let totalDelayed = 0, count = 0;
  const header = lines[0] || [];
  const amountIdx = header.findIndex(h => String(h).includes('ä»Šå›è¿”æ¸ˆé‡‘é¡'));
  for (let i = 1; i < lines.length; i++) { const row = lines[i]; if (!row || row.length < 10) continue; const amount = parseNumber(row[amountIdx >= 0 ? amountIdx : 10]) || 0; if (amount > 0) { totalDelayed += amount; count++; } }
  const data = { 'é…ã‚Œå›åä»¶æ•°': count, 'é…ã‚Œå›åé‡‘é¡': totalDelayed };
  const existing = BUSINESSES[target].data[period]?.ã‚µãƒãƒªãƒ¼ || {};
  BUSINESSES[target].data[period] = { ã‚µãƒãƒªãƒ¼: { ...existing, ...data } };
  showStatus(`é…ã‚Œå›åã‚·ãƒ¼ãƒˆå–è¾¼å®Œäº†: ${target} ${count}ä»¶, ${formatCurrency(totalDelayed)}`);
  selectBusiness(target); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

// SAMé¡§å®¢ç®¡ç†ã‚·ãƒ¼ãƒˆç”¨ãƒ‘ãƒ¼ã‚µãƒ¼
function parseCustomerManagementCSV(lines, period, filename) {
  const fn = filename.toLowerCase();
  // ãƒ•ã‚¡ã‚¤ãƒ«åæœ«å°¾ã«DãŒã‚ã‚Œã°DSCã€ãªã‘ã‚Œã°AMUSE
  const isDSC = fn.includes('d.csv') || fn.includes('æœˆd.csv') || filename.includes('D.csv') || filename.match(/æœˆD\.csv$/i) || filename.match(/\dæœˆD\./i);
  const target = isDSC ? 'DSC' : 'å…ƒamuse';
  
  // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æœŸé–“ã‚’æŠ½å‡ºï¼ˆä¾‹: "SAMé¡§å®¢ç®¡ç†ã‚·ãƒ¼ãƒˆ_-_2025å¹´10æœˆD.csv"ï¼‰
  const periodMatch = filename.match(/(\d{4})å¹´(\d{1,2})æœˆ/);
  let periodName = period;
  if (periodMatch) {
    periodName = `${periodMatch[1]}å¹´${parseInt(periodMatch[2])}æœˆ`;
  }
  
  // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‹ã‚‰ã‚«ãƒ©ãƒ ä½ç½®ã‚’ç‰¹å®š
  const header = lines[0] || [];
  const colMap = {};
  header.forEach((cell, idx) => {
    const h = String(cell || '').trim();
    if (h.includes('äº‹å‰ç²¾ç®—é‡‘é¡')) colMap['äº‹å‰ç²¾ç®—é‡‘é¡'] = idx;
    else if (h.includes('ä»Šæœˆåˆ†å›åé¡')) colMap['ä»Šæœˆåˆ†å›åé¡'] = idx;
    else if (h.includes('å›åç‡') && h.includes('ä»Šæœˆ')) colMap['å›åç‡(ä»Šæœˆ)'] = idx;
    else if (h.includes('å›åç‡') && h.includes('å…¨')) colMap['å›åç‡(å…¨ä½“)'] = idx;
    else if (h.includes('ä¿¡ç”¨æ é‡‘é¡')) colMap['ä¿¡ç”¨æ é‡‘é¡'] = idx;
    else if (h.includes('å›åäºˆå®šé‡‘é¡')) colMap['å›åäºˆå®šé‡‘é¡'] = idx;
    else if (h.includes('å›åæ¸ˆé‡‘é¡')) colMap['å›åæ¸ˆé‡‘é¡'] = idx;
    else if (h.includes('å‡ºé‡‘æ¸ˆé‡‘é¡')) colMap['å‡ºé‡‘æ¸ˆé‡‘é¡'] = idx;
    else if (h === 'å·®åˆ†') colMap['å·®åˆ†'] = idx;
  });
  
  // åˆè¨ˆè¡Œã‚’æ¢ã™
  let totalRow = null;
  for (let i = 0; i < lines.length; i++) {
    const row = lines[i];
    if (!row) continue;
    for (let j = 0; j < Math.min(row.length, 10); j++) {
      const cell = String(row[j] || '').trim();
      if (cell === 'åˆè¨ˆ') {
        totalRow = row;
        break;
      }
    }
    if (totalRow) break;
  }
  
  const extracted = {};
  
  const parseYen = (val) => {
    if (!val) return null;
    const s = String(val).replace(/[Â¥ï¿¥,\s]/g, '').replace(/%/g, '');
    const n = parseFloat(s);
    return isNaN(n) ? null : n;
  };
  
  if (totalRow) {
    if (colMap['äº‹å‰ç²¾ç®—é‡‘é¡'] !== undefined) extracted['äº‹å‰ç²¾ç®—é‡‘é¡'] = parseYen(totalRow[colMap['äº‹å‰ç²¾ç®—é‡‘é¡']]);
    if (colMap['ä»Šæœˆåˆ†å›åé¡'] !== undefined) extracted['å›åé‡‘é¡'] = parseYen(totalRow[colMap['ä»Šæœˆåˆ†å›åé¡']]);
    if (colMap['å›åç‡(ä»Šæœˆ)'] !== undefined) {
      const rate = parseYen(totalRow[colMap['å›åç‡(ä»Šæœˆ)']]);
      if (rate !== null) extracted['å›åç‡(ä»Šæœˆ)'] = rate > 1 ? rate / 100 : rate;
    }
    if (colMap['å›åç‡(å…¨ä½“)'] !== undefined) {
      const rate = parseYen(totalRow[colMap['å›åç‡(å…¨ä½“)']]);
      if (rate !== null) extracted['å›åç‡(å…¨ä½“)'] = rate > 1 ? rate / 100 : rate;
    }
    if (colMap['ä¿¡ç”¨æ é‡‘é¡'] !== undefined) extracted['ç·ä¿¡ç”¨æ '] = parseYen(totalRow[colMap['ä¿¡ç”¨æ é‡‘é¡']]);
    if (colMap['å›åäºˆå®šé‡‘é¡'] !== undefined) extracted['å›åäºˆå®šé‡‘é¡'] = parseYen(totalRow[colMap['å›åäºˆå®šé‡‘é¡']]);
    if (colMap['å›åæ¸ˆé‡‘é¡'] !== undefined) extracted['å›åæ¸ˆé‡‘é¡'] = parseYen(totalRow[colMap['å›åæ¸ˆé‡‘é¡']]);
    if (colMap['å‡ºé‡‘æ¸ˆé‡‘é¡'] !== undefined) extracted['å‡ºé‡‘é‡‘é¡'] = parseYen(totalRow[colMap['å‡ºé‡‘æ¸ˆé‡‘é¡']]);
    if (colMap['å·®åˆ†'] !== undefined) extracted['GGR(å›åé‡‘é¡-å‡ºé‡‘é‡‘é¡)'] = parseYen(totalRow[colMap['å·®åˆ†']]);
  }
  
  // è©³ç´°ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’æ¢ã™ï¼ˆKYCã§å§‹ã¾ã‚‹è¡Œï¼‰
  let detailStart = -1;
  let detailColMap = {};
  for (let i = 0; i < lines.length; i++) {
    const row = lines[i];
    if (row && String(row[0] || '').trim() === 'KYC') {
      detailStart = i;
      row.forEach((cell, idx) => {
        const h = String(cell || '').trim();
        if (h === 'ç²¾ç®—æ—¥') detailColMap['ç²¾ç®—æ—¥'] = idx;
        else if (h === 'ä¿¡ç”¨æ ') detailColMap['ä¿¡ç”¨æ '] = idx;
        else if (h === 'å›åå®Œäº†é‡‘é¡') detailColMap['å›åå®Œäº†é‡‘é¡'] = idx;
        else if (h === 'å›åé‡‘é¡') detailColMap['å›åé‡‘é¡è©³ç´°'] = idx;
      });
      break;
    }
  }
  
  // æ—¥æ¬¡çµ±è¨ˆã‚’é›†è¨ˆ
  const dailyStats = {};
  if (detailStart >= 0 && detailColMap['ç²¾ç®—æ—¥'] !== undefined) {
    for (let i = detailStart + 1; i < lines.length; i++) {
      const row = lines[i];
      if (!row || row.length < 12) continue;
      
      let date = String(row[detailColMap['ç²¾ç®—æ—¥']] || '').trim();
      // æ­£è¦ã®æ—¥ä»˜å½¢å¼ã®ã¿ï¼ˆæ¬¡ã‚µã‚¤ã‚¯ãƒ«ãªã©ã¯é™¤å¤–ï¼‰
      if (!date || date.includes('æ¬¡ã‚µã‚¤ã‚¯ãƒ«') || !date.match(/^\d{4}\/\d{1,2}\/\d{1,2}$/)) continue;
      
      const credit = parseYen(row[detailColMap['ä¿¡ç”¨æ ']]) || 0;
      const collection = parseYen(row[detailColMap['å›åå®Œäº†é‡‘é¡']]) || 0;
      
      if (!dailyStats[date]) {
        dailyStats[date] = { äººæ•°: 0, ä¿¡ç”¨æ åˆè¨ˆ: 0, å›åé‡‘é¡åˆè¨ˆ: 0, ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ: [], å›åé‡‘é¡ãƒªã‚¹ãƒˆ: [] };
      }
      
      dailyStats[date].äººæ•°++;
      dailyStats[date].ä¿¡ç”¨æ åˆè¨ˆ += credit;
      dailyStats[date].å›åé‡‘é¡åˆè¨ˆ += collection;
      if (credit > 0) dailyStats[date].ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ.push(credit);
      if (collection > 0) dailyStats[date].å›åé‡‘é¡ãƒªã‚¹ãƒˆ.push(collection);
    }
    
    // ä¸­å¤®å€¤ã‚’è¨ˆç®—
    Object.keys(dailyStats).forEach(date => {
      const s = dailyStats[date];
      s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ.sort((a, b) => a - b);
      s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ.sort((a, b) => a - b);
      s.ä¿¡ç”¨æ ä¸­å¤®å€¤ = s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ.length > 0 ? 
        (s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ.length % 2 === 0 ? 
          (s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ[s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ.length/2-1] + s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ[s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ.length/2]) / 2 :
          s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ[Math.floor(s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ.length/2)]) : 0;
      s.å›åé‡‘é¡ä¸­å¤®å€¤ = s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ.length > 0 ?
        (s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ.length % 2 === 0 ?
          (s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ[s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ.length/2-1] + s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ[s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ.length/2]) / 2 :
          s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ[Math.floor(s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ.length/2)]) : 0;
      delete s.ä¿¡ç”¨æ ãƒªã‚¹ãƒˆ;
      delete s.å›åé‡‘é¡ãƒªã‚¹ãƒˆ;
    });
  }
  
  // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨ãƒãƒ¼ã‚¸
  if (!BUSINESSES[target].data[periodName]) {
    BUSINESSES[target].data[periodName] = { ã‚µãƒãƒªãƒ¼: {} };
  }
  Object.assign(BUSINESSES[target].data[periodName].ã‚µãƒãƒªãƒ¼, extracted);
  
  // æ—¥æ¬¡çµ±è¨ˆã‚’è¿½åŠ 
  if (Object.keys(dailyStats).length > 0) {
    BUSINESSES[target].data[periodName].æ—¥æ¬¡çµ±è¨ˆ = dailyStats;
  }
  
  const dailyCount = Object.keys(dailyStats).length;
  showStatus(`${target} ${periodName} é¡§å®¢ç®¡ç†ãƒ‡ãƒ¼ã‚¿å–è¾¼å®Œäº†: å›åé‡‘é¡ Â¥${(extracted['å›åé‡‘é¡'] || 0).toLocaleString()}ã€æ—¥æ¬¡çµ±è¨ˆ ${dailyCount}æ—¥åˆ†`);
  selectBusiness(target); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

// ç€é‡‘ç¢ºèªã‚·ãƒ¼ãƒˆç”¨ãƒ‘ãƒ¼ã‚µãƒ¼ï¼ˆECç€é‡‘ã€Paypayã€ä»®æƒ³é€šè²¨ã€å€‹äººï¼‰
function parsePaymentConfirmCSV(lines, period, fnLower, filename) {
  // ãƒ•ã‚¡ã‚¤ãƒ«åæœ«å°¾ã«DãŒã‚ã‚Œã°DSCã€ãªã‘ã‚Œã°AMUSE
  const isDSC = fnLower.includes('d.csv') || fnLower.includes('ç€é‡‘ç¢ºèªd') || fnLower.includes('ç€é‡‘d') || 
    filename.includes('D.csv') || filename.match(/D\.csv$/i);
  const target = isDSC ? 'DSC' : 'å…ƒamuse';
  
  // ç€é‡‘ç¨®åˆ¥ã‚’åˆ¤å®š
  let paymentType = '';
  if (fnLower.includes('ec') || fnLower.includes('ï½…ï½ƒ')) paymentType = 'EC';
  else if (fnLower.includes('paypay')) paymentType = 'Paypay';
  else if (fnLower.includes('ä»®æƒ³é€šè²¨')) paymentType = 'ä»®æƒ³é€šè²¨';
  else if (fnLower.includes('å€‹äºº')) paymentType = 'å€‹äºº';
  else paymentType = 'ãã®ä»–';
  
  const parseYen = (val) => {
    if (!val) return null;
    const s = String(val).replace(/[Â¥ï¿¥,\s"]/g, '');
    const n = parseFloat(s);
    return isNaN(n) ? null : n;
  };
  
  const parseDate = (val) => {
    if (!val) return null;
    const s = String(val).trim();
    let match = s.match(/(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})/);
    if (match) return { year: parseInt(match[1]), month: parseInt(match[2]), day: parseInt(match[3]) };
    match = s.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);
    if (match) return { year: parseInt(match[3]), month: parseInt(match[1]), day: parseInt(match[2]) };
    match = s.match(/^(\d{1,2})[\/\-](\d{1,2})$/);
    if (match) return { year: 2025, month: parseInt(match[1]), day: parseInt(match[2]) };
    return null;
  };
  
  // æœˆåˆ¥çµ±è¨ˆã‚’é›†è¨ˆï¼ˆä»®æƒ³é€šè²¨ã¯éŠ˜æŸ„åˆ¥ãƒ»æœˆåˆ¥ï¼‰
  const monthlyStats = {};
  const coinStats = {}; // ä»®æƒ³é€šè²¨ç”¨ï¼šéŠ˜æŸ„åˆ¥ãƒ»æœˆåˆ¥
  let totalCount = 0;
  let totalAmount = 0;
  
  for (let i = 0; i < lines.length; i++) {
    const row = lines[i];
    if (!row || row.length < 5) continue;
    
    let dateInfo = null;
    let amount = null;
    let phone = '';
    let coin = ''; // ä»®æƒ³é€šè²¨éŠ˜æŸ„
    
    if (paymentType === 'EC') {
      dateInfo = parseDate(row[3]);
      amount = parseYen(row[4]);
      phone = String(row[0] || '').replace(/[\s\-]/g, '');
    } else if (paymentType === 'Paypay') {
      dateInfo = parseDate(row[5]);
      amount = parseYen(row[4]);
      phone = String(row[1] || '').replace(/[\s\-]/g, '');
    } else if (paymentType === 'å€‹äºº') {
      dateInfo = parseDate(row[5]);
      amount = parseYen(row[4]);
      phone = String(row[1] || '').replace(/[\s\-]/g, '');
    } else if (paymentType === 'ä»®æƒ³é€šè²¨') {
      const entryType = String(row[0] || '').trim();
      if (entryType !== 'å…¥é‡‘') continue;
      dateInfo = parseDate(row[1]);
      amount = parseYen(row[8]);
      phone = String(row[2] || '').replace(/[\s\-]/g, '');
      coin = String(row[5] || '').trim() || 'ãã®ä»–';
    }
    
    if (!dateInfo || !amount || amount <= 0) continue;
    if (phone && !phone.match(/^0\d/)) continue;
    
    const monthKey = `${dateInfo.year}å¹´${dateInfo.month}æœˆ`;
    
    if (paymentType === 'ä»®æƒ³é€šè²¨') {
      // ä»®æƒ³é€šè²¨ã¯éŠ˜æŸ„åˆ¥ã«é›†è¨ˆ
      if (!coinStats[coin]) coinStats[coin] = {};
      if (!coinStats[coin][monthKey]) {
        coinStats[coin][monthKey] = { äººæ•°Set: new Set(), å›æ•°: 0, é‡‘é¡åˆè¨ˆ: 0, é‡‘é¡ãƒªã‚¹ãƒˆ: [] };
      }
      if (phone) coinStats[coin][monthKey].äººæ•°Set.add(phone);
      coinStats[coin][monthKey].å›æ•°++;
      coinStats[coin][monthKey].é‡‘é¡åˆè¨ˆ += amount;
      coinStats[coin][monthKey].é‡‘é¡ãƒªã‚¹ãƒˆ.push(amount);
    } else {
      // EC, Paypay, å€‹äººã¯å¾“æ¥é€šã‚Š
      if (!monthlyStats[monthKey]) {
        monthlyStats[monthKey] = { äººæ•°Set: new Set(), å›æ•°: 0, é‡‘é¡åˆè¨ˆ: 0, é‡‘é¡ãƒªã‚¹ãƒˆ: [] };
      }
      if (phone) monthlyStats[monthKey].äººæ•°Set.add(phone);
      monthlyStats[monthKey].å›æ•°++;
      monthlyStats[monthKey].é‡‘é¡åˆè¨ˆ += amount;
      monthlyStats[monthKey].é‡‘é¡ãƒªã‚¹ãƒˆ.push(amount);
    }
    
    totalCount++;
    totalAmount += amount;
  }
  
  // ä¸­å¤®å€¤ã‚’è¨ˆç®—ã—ã¦Setã‚’ã‚«ã‚¦ãƒ³ãƒˆã«å¤‰æ›
  const calcMedian = (stats) => {
    Object.keys(stats).forEach(key => {
      const s = stats[key];
      if (s.äººæ•°Set) {
        s.äººæ•° = s.äººæ•°Set.size;
        delete s.äººæ•°Set;
      }
      if (s.é‡‘é¡ãƒªã‚¹ãƒˆ) {
        s.é‡‘é¡ãƒªã‚¹ãƒˆ.sort((a, b) => a - b);
        const len = s.é‡‘é¡ãƒªã‚¹ãƒˆ.length;
        s.ä¸­å¤®å€¤ = len > 0 ?
          (len % 2 === 0 ? (s.é‡‘é¡ãƒªã‚¹ãƒˆ[len/2-1] + s.é‡‘é¡ãƒªã‚¹ãƒˆ[len/2]) / 2 : s.é‡‘é¡ãƒªã‚¹ãƒˆ[Math.floor(len/2)]) : 0;
        delete s.é‡‘é¡ãƒªã‚¹ãƒˆ;
      }
    });
  };
  
  // ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´
  if (!BUSINESSES[target].data['ç€é‡‘çµ±è¨ˆ']) {
    BUSINESSES[target].data['ç€é‡‘çµ±è¨ˆ'] = {};
  }
  
  if (paymentType === 'ä»®æƒ³é€šè²¨') {
    // ä»®æƒ³é€šè²¨ã¯éŠ˜æŸ„åˆ¥ã«æ ¼ç´
    Object.keys(coinStats).forEach(coin => calcMedian(coinStats[coin]));
    BUSINESSES[target].data['ç€é‡‘çµ±è¨ˆ']['ä»®æƒ³é€šè²¨'] = coinStats;
    const coinCount = Object.keys(coinStats).length;
    showStatus(`${target} ä»®æƒ³é€šè²¨ç€é‡‘å–è¾¼å®Œäº†: ${totalCount}ä»¶, Â¥${totalAmount.toLocaleString()}, ${coinCount}éŠ˜æŸ„`);
  } else {
    calcMedian(monthlyStats);
    BUSINESSES[target].data['ç€é‡‘çµ±è¨ˆ'][paymentType] = monthlyStats;
    const monthCount = Object.keys(monthlyStats).length;
    showStatus(`${target} ${paymentType}ç€é‡‘å–è¾¼å®Œäº†: ${totalCount}ä»¶, Â¥${totalAmount.toLocaleString()}, ${monthCount}ãƒ¶æœˆåˆ†`);
  }
  
  selectBusiness(target); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseAgentCSV(lines, period) {
  let weeklyData = [];
  let totals = { å…¥é‡‘åˆè¨ˆ: 0, å‡ºé‡‘åˆè¨ˆ: 0, åç›Šåˆè¨ˆ: 0, TOåˆè¨ˆ: 0, ãƒ­ãƒ¼ãƒªãƒ³ã‚°åˆè¨ˆ: 0, å¤§é˜ªåˆè¨ˆ: 0 };
  for (let i = 2; i < lines.length; i++) { const row = lines[i]; if (!row || row.length < 17) continue; const col7 = (row[7] || '').trim(); const col12 = (row[12] || '').trim(); const isOldFormat = col7.includes('/') && !col7.toLowerCase().includes('kyoto'); const isNewFormat = col7 === '' && col12.includes('/'); if (isOldFormat || isNewFormat) { const æ—¥ä»˜ = isOldFormat ? col7 : col12; const å…¥é‡‘ = parseNumber(row[8]) || 0; const å‡ºé‡‘ = parseNumber(row[9]) || 0; const åç›Š = parseNumber(row[11]) || 0; const TO = parseNumber(row[13]) || 0; const ãƒ­ãƒ¼ãƒªãƒ³ã‚° = parseNumber(row[14]) || 0; const å¤§é˜ª = parseNumber(row[16]) || 0; const ãƒ­ãƒ¼ãƒªãƒ³ã‚°å ±é…¬ = ãƒ­ãƒ¼ãƒªãƒ³ã‚° + å¤§é˜ª; const NGR = åç›Š - ãƒ­ãƒ¼ãƒªãƒ³ã‚°å ±é…¬; totals.å…¥é‡‘åˆè¨ˆ += å…¥é‡‘; totals.å‡ºé‡‘åˆè¨ˆ += å‡ºé‡‘; totals.åç›Šåˆè¨ˆ += åç›Š; totals.TOåˆè¨ˆ += TO; totals.ãƒ­ãƒ¼ãƒªãƒ³ã‚°åˆè¨ˆ += ãƒ­ãƒ¼ãƒªãƒ³ã‚°; totals.å¤§é˜ªåˆè¨ˆ += å¤§é˜ª; weeklyData.push({ æ—¥ä»˜, å…¥é‡‘, å‡ºé‡‘, åç›Š, 'T/O': TO, ãƒ­ãƒ¼ãƒªãƒ³ã‚°, å¤§é˜ª, ãƒ­ãƒ¼ãƒªãƒ³ã‚°å ±é…¬, NGR }); } }
  const ãƒ­ãƒ¼ãƒªãƒ³ã‚°å ±é…¬åˆè¨ˆ = totals.ãƒ­ãƒ¼ãƒªãƒ³ã‚°åˆè¨ˆ + totals.å¤§é˜ªåˆè¨ˆ;
  const NGRåˆè¨ˆ = totals.åç›Šåˆè¨ˆ - ãƒ­ãƒ¼ãƒªãƒ³ã‚°å ±é…¬åˆè¨ˆ;
  BUSINESSES['AMUSEVIP'].data['å…¨æœŸé–“'] = { ã‚µãƒãƒªãƒ¼: { ...totals, 'ãƒ­ãƒ¼ãƒªãƒ³ã‚°å ±é…¬': ãƒ­ãƒ¼ãƒªãƒ³ã‚°å ±é…¬åˆè¨ˆ, 'NGR': NGRåˆè¨ˆ, 'ç²¾ç®—å›æ•°': weeklyData.length }, é€±åˆ¥: weeklyData };
  showStatus(`ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå–è¾¼å®Œäº†: ${weeklyData.length}å›, åç›Š${formatCurrency(totals.åç›Šåˆè¨ˆ)}`);
  selectBusiness('AMUSEVIP'); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseAdsCSV(lines, period) {
  const header = lines[0].map(h => String(h || '').toLowerCase().replace(/\n/g, '').trim());
  const costIdx = header.findIndex(h => h.includes('ã‚³ã‚¹ãƒˆ') || h === 'cost');
  const impIdx = header.findIndex(h => h.includes('ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³') || h.includes('imp'));
  const clickIdx = header.findIndex(h => h.includes('ã‚¯ãƒªãƒƒã‚¯') || h.includes('click'));
  const regIdx = header.findIndex(h => h === 'ç™»éŒ²æ•°' || h === 'registrations');
  const depIdx = header.findIndex(h => h === 'å…¥é‡‘æ•°' || h === 'deposits');
  let totals = { ã‚³ã‚¹ãƒˆ: 0, ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³: 0, ã‚¯ãƒªãƒƒã‚¯: 0, ç™»éŒ²: 0, å…¥é‡‘: 0 };
  let foundTotal = false;
  // TOTALè¡Œã‚’æ¢ã—ã¦ãã®å€¤ã‚’ä½¿ç”¨
  for (let i = 1; i < lines.length; i++) {
    const row = lines[i]; if (!row || row.length < 5) continue;
    const firstCell = String(row[0] || '').trim().toLowerCase();
    // TOTALè¡Œã‚’æ¤œå‡ºï¼ˆ"total", "åˆè¨ˆ", æœˆå+total ãªã©ï¼‰
    if (firstCell.includes('total') || firstCell.includes('åˆè¨ˆ')) {
      foundTotal = true;
      const parseVal = (idx, fb) => { if (idx < 0 && fb < 0) return 0; const v = row[idx >= 0 ? idx : fb] || ''; return parseFloat(String(v).replace(/[$ï¿¥Â¥,"\s]/g, '')) || 0; };
      totals.ã‚³ã‚¹ãƒˆ = parseVal(costIdx, 1);
      totals.ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ = parseVal(impIdx, 2);
      totals.ã‚¯ãƒªãƒƒã‚¯ = parseVal(clickIdx, 3);
      totals.ç™»éŒ² = parseVal(regIdx, 4);
      totals.å…¥é‡‘ = parseVal(depIdx, 5);
      break; // æœ€åˆã®TOTALè¡Œã‚’ä½¿ç”¨
    }
  }
  // TOTALè¡ŒãŒãªã„å ´åˆã¯å¾“æ¥é€šã‚Šåˆè¨ˆ
  if (!foundTotal) {
    for (let i = 1; i < lines.length; i++) { const row = lines[i]; if (!row || row.length < 5) continue; const parseVal = (idx, fb) => { if (idx < 0 && fb < 0) return 0; const v = row[idx >= 0 ? idx : fb] || ''; return parseFloat(String(v).replace(/[$ï¿¥Â¥,"\s]/g, '')) || 0; }; totals.ã‚³ã‚¹ãƒˆ += parseVal(costIdx, 1); totals.ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ += parseVal(impIdx, 2); totals.ã‚¯ãƒªãƒƒã‚¯ += parseVal(clickIdx, 3); totals.ç™»éŒ² += parseVal(regIdx, 4); totals.å…¥é‡‘ += parseVal(depIdx, 5); }
  }
  const ctr = totals.ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ > 0 ? totals.ã‚¯ãƒªãƒƒã‚¯ / totals.ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ : 0;
  const cvr = totals.ã‚¯ãƒªãƒƒã‚¯ > 0 ? totals.ç™»éŒ² / totals.ã‚¯ãƒªãƒƒã‚¯ : 0;
  const costYen = totals.ã‚³ã‚¹ãƒˆ < 10000 ? totals.ã‚³ã‚¹ãƒˆ * 150 : totals.ã‚³ã‚¹ãƒˆ;
  const regCpaYen = totals.ç™»éŒ² > 0 ? costYen / totals.ç™»éŒ² : 0;
  const depCpaYen = totals.å…¥é‡‘ > 0 ? costYen / totals.å…¥é‡‘ : 0;
  BUSINESSES['åºƒå‘Š'].data['å…¨æœŸé–“'] = { ã‚µãƒãƒªãƒ¼: { 'ã‚³ã‚¹ãƒˆ(ç¨è¾¼)': costYen, 'ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³': totals.ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³, 'ã‚¯ãƒªãƒƒã‚¯': totals.ã‚¯ãƒªãƒƒã‚¯, 'ç™»éŒ²æ•°': totals.ç™»éŒ², 'å…¥é‡‘æ•°': totals.å…¥é‡‘, 'CTR': ctr, 'CVR': cvr, 'ç™»éŒ²CPA': regCpaYen, 'å…¥é‡‘CPA': depCpaYen } };
  showStatus(`åºƒå‘Šãƒ‡ãƒ¼ã‚¿å–è¾¼å®Œäº†: ç™»éŒ²${totals.ç™»éŒ²}ä»¶, å…¥é‡‘${totals.å…¥é‡‘}ä»¶`);
  selectBusiness('åºƒå‘Š'); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

// ========== Excelå‡¦ç† ==========
function handleExcel(workbook, period, uploadType, filename) {
  const sheetNames = workbook.SheetNames;
  const fn = filename.toLowerCase();
  const slotenSheets = sheetNames.filter(s => /^\d{6}$/.test(s));
  if (uploadType === 'sloten' || (uploadType === 'auto' && (slotenSheets.length > 0 || fn.includes('ã‚¹ãƒ­å¤©') || fn.includes('kpi')))) { parseSlotenExcel(workbook, slotenSheets); return; }
  const hasBaccaraSheet = sheetNames.includes('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰') || sheetNames.includes('ã‚³ã‚¹ãƒˆ') || sheetNames.some(s => s.includes('ãƒã‚«ãƒ©'));
  if (uploadType === 'baccarat' || (uploadType === 'auto' && (hasBaccaraSheet || fn.includes('ãƒã‚«ãƒ©') || fn.includes('baccara')))) { parseBaccaratExcel(workbook, period); return; }
  const revenueSheets = sheetNames.filter(s => s.includes('åç›Š') && !s.includes('import'));
  if (revenueSheets.length > 0) { parseSamExcel(workbook, revenueSheets); return; }
  parseGenericExcel(workbook, period);
}

function parseSlotenExcel(workbook, monthlySheets) {
  let count = 0;
  const primaryKeys = ['GGR', 'ç·å…¥é‡‘é¡', 'ç·å‡ºé‡‘é¡', 'å…¥å‡ºé‡‘å·®åˆ†', 'T/O', 'RTP', 'NGR', 'ç™»éŒ²äººæ•°', 'ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°', 'GGRLTV'];
  monthlySheets.forEach(sheetName => {
    const sheet = workbook.Sheets[sheetName];
    const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
    const kpi = {}, depositMethods = {}, withdrawMethods = {}, gameData = {}, affData = {}, cryptoData = {}, providerData = {};
    data.forEach((row, idx) => { if (!row || row.length < 2) return; const rawLabel = String(row[0] || '').trim(); if (!rawLabel || rawLabel === 'é …ç›®å' || rawLabel.includes('ã€')) return; const label = rawLabel.split('/')[0].trim(); const val = parseNumber(row[1]); if (val === null) return; const isPrimaryKey = primaryKeys.some(pk => label === pk || label.startsWith(pk)); if (isPrimaryKey && kpi[label] !== undefined) return; if (idx < 90 || !isPrimaryKey) kpi[label] = val; });
    for (let i = 191; i < Math.min(198, data.length); i++) { const row = data[i]; if (row && row[0] && row[1] !== undefined) { const key = String(row[0]).trim(); if (key && key !== 'å…¥é‡‘' && key !== 'åˆè¨ˆé‡‘é¡') { const val = parseNumber(row[1]); if (val !== null && val > 0) depositMethods[key] = val; } } }
    for (let i = 199; i < Math.min(206, data.length); i++) { const row = data[i]; if (row && row[0] && row[1] !== undefined) { const key = String(row[0]).trim(); if (key && key !== 'å‡ºé‡‘' && key !== 'åˆè¨ˆé‡‘é¡') { const val = parseNumber(row[1]); if (val !== null && val > 0) withdrawMethods[key] = val; } } }
    for (let i = 216; i < Math.min(227, data.length); i++) { const row = data[i]; if (row && row[0]) { const key = String(row[0]).trim(); if (key && /^(BTC|ETH|USDT|TRX|XRP|LTC)/i.test(key)) { const cnt = parseNumber(row[1]) || 0; const amt = parseNumber(row[2]) || 0; if (cnt > 0 || amt > 0) cryptoData[key] = { ä»¶æ•°: cnt, é‡‘é¡: amt }; } } }
    for (let i = 226; i < Math.min(270, data.length); i++) { const row = data[i]; if (row && row[0]) { const key = String(row[0]).trim(); if (key === 'ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼' || key.includes('ã‚¢ã‚¯ãƒ†ã‚£ãƒ–')) continue; const users = parseNumber(row[1]) || 0; const bet = parseNumber(row[2]) || 0; const payout = parseNumber(row[3]) || 0; if (users > 0 || bet > 0) providerData[key] = { ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: users, è³­ã‘é‡‘é¡: bet, é…å½“é‡‘é¡: payout, GGR: bet - payout }; } }
    const gamePositions = [{ name: 'ãƒ‘ãƒãƒ³ã‚³', userRow: 123, toRow: 124, ggrRow: 127 },{ name: 'ãƒ‘ãƒã‚¹ãƒ­', userRow: 142, toRow: 143, ggrRow: 146 },{ name: 'ã‚¹ãƒ­ãƒƒãƒˆ', userRow: 161, toRow: 162, ggrRow: 165 },{ name: 'ãƒ©ã‚¤ãƒ–', userRow: 180, toRow: 181, ggrRow: 184 }];
    gamePositions.forEach(g => { if (data[g.userRow] && data[g.toRow] && data[g.ggrRow]) { gameData[g.name] = { ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: parseNumber(data[g.userRow]?.[1]) || 0, TO: parseNumber(data[g.toRow]?.[1]) || 0, GGR: parseNumber(data[g.ggrRow]?.[1]) || 0 }; } });
    for (let i = 92; i < Math.min(112, data.length); i++) { const row = data[i]; if (row && row[0] && row[1] !== undefined) { const key = String(row[0]).trim().split('/')[0].trim(); if (key && key.includes('AFF')) { const val = parseNumber(row[1]); if (val !== null) affData[key] = val; } } }
    const year = sheetName.substring(0, 4), month = parseInt(sheetName.substring(4, 6)), periodName = `${year}å¹´${month}æœˆ`;
    if (Object.keys(kpi).length > 0) {
      const existingSloten2 = BUSINESSES['ã‚¹ãƒ­å¤©'].data[periodName] || {};
      const existingSummary = existingSloten2.ã‚µãƒãƒªãƒ¼ || {};
      BUSINESSES['ã‚¹ãƒ­å¤©'].data[periodName] = { 
        ...existingSloten2,
        ã‚µãƒãƒªãƒ¼: { ...existingSummary, ...kpi }, 
        ...(Object.keys(depositMethods).length > 0 ? { å…¥é‡‘æ–¹æ³•: depositMethods } : (existingSloten2.å…¥é‡‘æ–¹æ³• ? { å…¥é‡‘æ–¹æ³•: existingSloten2.å…¥é‡‘æ–¹æ³• } : {})), 
        ...(Object.keys(withdrawMethods).length > 0 ? { å‡ºé‡‘æ–¹æ³•: withdrawMethods } : (existingSloten2.å‡ºé‡‘æ–¹æ³• ? { å‡ºé‡‘æ–¹æ³•: existingSloten2.å‡ºé‡‘æ–¹æ³• } : {})), 
        ...(Object.keys(cryptoData).length > 0 ? { ä»®æƒ³é€šè²¨: cryptoData } : (existingSloten2.ä»®æƒ³é€šè²¨ ? { ä»®æƒ³é€šè²¨: existingSloten2.ä»®æƒ³é€šè²¨ } : {})), 
        ...(Object.keys(providerData).length > 0 ? { ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼: providerData } : (existingSloten2.ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ ? { ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼: existingSloten2.ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ } : {})), 
        ...(Object.keys(gameData).length > 0 ? { ã‚²ãƒ¼ãƒ åˆ¥: gameData } : (existingSloten2.ã‚²ãƒ¼ãƒ åˆ¥ ? { ã‚²ãƒ¼ãƒ åˆ¥: existingSloten2.ã‚²ãƒ¼ãƒ åˆ¥ } : {})), 
        ...(Object.keys(affData).length > 0 ? { Affiliate: affData } : (existingSloten2.Affiliate ? { Affiliate: existingSloten2.Affiliate } : {})) 
      };
      count++;
    }
  });
  showStatus(`ã‚¹ãƒ­å¤©ãƒ‡ãƒ¼ã‚¿å–è¾¼å®Œäº†: ${count}æœŸé–“`);
  selectBusiness('ã‚¹ãƒ­å¤©'); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseBaccaratExcel(workbook, period) {
  // å„ã‚·ãƒ¼ãƒˆã‚’å–å¾—
  const dashSheetName = workbook.SheetNames.find(s => s.includes('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰') || s.includes('ã‚µãƒãƒªãƒ¼'));
  const dashSheet = dashSheetName ? workbook.Sheets[dashSheetName] : null;
  const costSheet = workbook.Sheets['ã‚³ã‚¹ãƒˆ'] || workbook.Sheets['cost'];
  const userSheet = workbook.Sheets['ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»åç›Šåˆ†æ'] || workbook.Sheets['ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†æ'];
  const followerSheet = workbook.Sheets['SNSãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°'] || workbook.Sheets['ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°'];
  
  const extractedData = {
    'Twitter': 0, 'Instagram': 0, 'TikTok': 0, 'YouTube': 0, 'LINEå…¬å¼': 0, 'KICK': 0,
    'ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 0, 'ç·å…¥é‡‘é¡': 0, 'å¹³å‡T/O': 0, 'ç·GGR': 0, 'ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³': 0, 'ã‚³ã‚¹ãƒˆ': 0, 'NGR': 0
  };
  
  // SNSãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ã‚·ãƒ¼ãƒˆã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  if (followerSheet) {
    const followerData = XLSX.utils.sheet_to_json(followerSheet, { header: 1 });
    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’æ¢ã™
    let colMap = {};
    followerData.forEach((row, idx) => {
      if (!row) return;
      const first = String(row[0] || '').trim();
      if (first === 'æ—¥ä»˜' || first.includes('æ—¥ä»˜')) {
        row.forEach((cell, colIdx) => {
          const h = String(cell || '').trim();
          if (h === 'Twitter' || h === 'X') colMap['Twitter'] = colIdx;
          else if (h === 'Instagram') colMap['Instagram'] = colIdx;
          else if (h === 'TikTok') colMap['TikTok'] = colIdx;
          else if (h === 'YouTube') colMap['YouTube'] = colIdx;
          else if (h.includes('LINE')) colMap['LINEå…¬å¼'] = colIdx;
          else if (h === 'KICK' || h === 'Kick') colMap['KICK'] = colIdx;
        });
      }
    });
    // æœ€æ–°ã®æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã‚’ä¸‹ã‹ã‚‰æ¢ã™
    for (let i = followerData.length - 1; i >= 0; i--) {
      const row = followerData[i];
      if (!row) continue;
      let hasData = false;
      for (const [key, colIdx] of Object.entries(colMap)) {
        const val = parseNumber(row[colIdx]);
        if (val !== null && val > 0 && extractedData[key] === 0) {
          extractedData[key] = val;
          hasData = true;
        }
      }
      if (hasData) break;
    }
  }
  
  // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ã‚µãƒãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
  if (dashSheet) {
    const dashData = XLSX.utils.sheet_to_json(dashSheet, { header: 1 });
    dashData.forEach(row => {
      if (!row || row.length < 2) return;
      const label = String(row[0] || '').trim();
      const value = parseNumber(row[1]);
      if (value === null) return;
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»åç›Š
      if (label.includes('ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼')) extractedData['ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°'] = value;
      else if (label.includes('ç·å…¥é‡‘')) extractedData['ç·å…¥é‡‘é¡'] = value;
      else if (label.includes('å¹³å‡T/O') || label.includes('å¹³å‡TO')) extractedData['å¹³å‡T/O'] = value;
      else if (label.includes('ç·GGR') || (label.includes('GGR') && !label.includes('NGR'))) extractedData['ç·GGR'] = value;
      else if (label.includes('ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³')) extractedData['ã‚³ãƒŸãƒƒã‚·ãƒ§ãƒ³'] = value;
      else if (label === 'ã‚³ã‚¹ãƒˆ' || label === 'cost') extractedData['ã‚³ã‚¹ãƒˆ'] = value;
      else if (label === 'NGR' || label.includes('NGR')) extractedData['NGR'] = value;
    });
  }
  
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»åç›Šåˆ†æã‚·ãƒ¼ãƒˆã‹ã‚‰åˆè¨ˆè¡Œã‚’å–å¾—ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
  if (userSheet) {
    const userData = XLSX.utils.sheet_to_json(userSheet, { header: 1 });
    // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’æ¢ã™
    let headerIdx = -1;
    let colMap = {};
    userData.forEach((row, idx) => {
      if (!row) return;
      const first = String(row[0] || '').trim();
      if (first === 'æ—¥ä»˜' || first.includes('æ—¥ä»˜')) {
        headerIdx = idx;
        row.forEach((cell, colIdx) => {
          const h = String(cell || '').trim();
          if (h.includes('ãƒ¦ãƒ¼ã‚¶ãƒ¼')) colMap['users'] = colIdx;
          else if (h.includes('å…¥é‡‘é¡')) colMap['deposit'] = colIdx;
          else if (h.includes('T/O') || h.includes('ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼')) colMap['to'] = colIdx;
          else if (h.includes('GGR')) colMap['ggr'] = colIdx;
        });
      }
      // åˆè¨ˆè¡Œ
      if (first === 'åˆè¨ˆ') {
        if (colMap['users'] && extractedData['ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°'] === 0) {
          const v = parseNumber(row[colMap['users']]);
          if (v !== null) extractedData['ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°'] = v;
        }
        if (colMap['deposit'] && extractedData['ç·å…¥é‡‘é¡'] === 0) {
          const v = parseNumber(row[colMap['deposit']]);
          if (v !== null) extractedData['ç·å…¥é‡‘é¡'] = v;
        }
        if (colMap['ggr'] && extractedData['ç·GGR'] === 0) {
          const v = parseNumber(row[colMap['ggr']]);
          if (v !== null) extractedData['ç·GGR'] = v;
        }
      }
    });
  }
  
  // ã‚³ã‚¹ãƒˆã‚·ãƒ¼ãƒˆã‹ã‚‰åˆè¨ˆã‚’å–å¾—
  if (costSheet) {
    const costData = XLSX.utils.sheet_to_json(costSheet, { header: 1 });
    costData.forEach(row => {
      if (!row) return;
      const label = String(row[0] || '').trim();
      if (label === 'åˆè¨ˆ' || label.toLowerCase() === 'total') {
        // é‡‘é¡åˆ—ï¼ˆé€šå¸¸ã¯åˆ—2ï¼‰
        const costVal = parseNumber(row[2]) || parseNumber(row[1]) || 0;
        if (costVal > 0 && extractedData['ã‚³ã‚¹ãƒˆ'] === 0) extractedData['ã‚³ã‚¹ãƒˆ'] = costVal;
      }
    });
  }
  
  // NGRãŒ0ã®å ´åˆã¯è¨ˆç®—
  if (extractedData['NGR'] === 0 && (extractedData['ç·GGR'] !== 0 || extractedData['ã‚³ã‚¹ãƒˆ'] !== 0)) {
    extractedData['NGR'] = extractedData['ç·GGR'] - extractedData['ã‚³ã‚¹ãƒˆ'];
  }
  
  // ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°åˆè¨ˆã‚’è¨ˆç®—
  extractedData['åˆè¨ˆãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼'] = extractedData['Twitter'] + extractedData['Instagram'] + 
                                   extractedData['TikTok'] + extractedData['YouTube'] + extractedData['LINEå…¬å¼'] + extractedData['KICK'];
  
  // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
  BUSINESSES['ãƒã‚«ãƒ©ãƒ„ãƒ¼ãƒ«'].data['å…¨æœŸé–“'] = { ã‚µãƒãƒªãƒ¼: extractedData };
  
  const ggrStr = extractedData['ç·GGR'] >= 0 ? `GGR Â¥${Math.round(extractedData['ç·GGR']).toLocaleString()}` : `GGR Â¥${Math.round(extractedData['ç·GGR']).toLocaleString()}`;
  const ngrStr = extractedData['NGR'] >= 0 ? `NGR Â¥${Math.round(extractedData['NGR']).toLocaleString()}` : `NGR Â¥${Math.round(extractedData['NGR']).toLocaleString()}`;
  showStatus(`ãƒã‚«ãƒ©ãƒ„ãƒ¼ãƒ«å–è¾¼å®Œäº†: ãƒ¦ãƒ¼ã‚¶ãƒ¼${extractedData['ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°']}äºº, ${ggrStr}, ${ngrStr}`);
  selectBusiness('ãƒã‚«ãƒ©ãƒ„ãƒ¼ãƒ«'); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseSamExcel(workbook, revenueSheets) {
  let amuseCount = 0, dscCount = 0;
  revenueSheets.forEach(sheetName => { const sheet = workbook.Sheets[sheetName]; const data = XLSX.utils.sheet_to_json(sheet, { header: 1 }); const isDSC = sheetName.endsWith('D'); let periodName = sheetName.replace('åç›Š', '').replace(/D$/, ''); const extracted = {}; data.forEach(row => { if (row[1] && row[2] !== undefined && row[2] !== null && row[2] !== '') { const key = String(row[1]).trim().replace(/ï¼ˆ/g, '(').replace(/ï¼‰/g, ')'); const val = parseNumber(row[2]); if (val !== null && !String(row[2]).startsWith('#') && !key.startsWith('0.')) extracted[key] = val; } if (row[3] && row[4] !== undefined && row[4] !== null && row[4] !== '') { const key = String(row[3]).trim().replace(/ï¼ˆ/g, '(').replace(/ï¼‰/g, ')'); const val = parseNumber(row[4]); if (val !== null && !String(row[4]).startsWith('#') && !key.startsWith('0.')) extracted[key] = val; } }); if (Object.keys(extracted).length > 0) { if (isDSC) { const existingDSC = BUSINESSES['DSC'].data[periodName]?.ã‚µãƒãƒªãƒ¼ || {}; BUSINESSES['DSC'].data[periodName] = { ...BUSINESSES['DSC'].data[periodName], ã‚µãƒãƒªãƒ¼: { ...existingDSC, ...extracted } }; dscCount++; } else { const existingAmuse = BUSINESSES['å…ƒamuse'].data[periodName]?.ã‚µãƒãƒªãƒ¼ || {}; BUSINESSES['å…ƒamuse'].data[periodName] = { ...BUSINESSES['å…ƒamuse'].data[periodName], ã‚µãƒãƒªãƒ¼: { ...existingAmuse, ...extracted } }; amuseCount++; } } });
  showStatus(`åç›Šã‚·ãƒ¼ãƒˆå–è¾¼å®Œäº†: å…ƒamuse ${amuseCount}ä»¶, DSC ${dscCount}ä»¶`);
  if (dscCount > 0) selectBusiness('DSC'); else selectBusiness('å…ƒamuse');
  saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function parseGenericExcel(workbook, period) {
  const sheet = workbook.Sheets[workbook.SheetNames[0]];
  const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
  const kpi = {};
  data.forEach(row => { if (!row || row.length < 2) return; const label = String(row[0] || '').trim(); const val = parseNumber(row[1]); if (label && val !== null) kpi[label] = val; });
  const existingData = BUSINESSES[currentBusiness].data[period]?.ã‚µãƒãƒªãƒ¼ || {};
  BUSINESSES[currentBusiness].data[period] = { ...BUSINESSES[currentBusiness].data[period], ã‚µãƒãƒªãƒ¼: { ...existingData, ...kpi } };
  showStatus(`Excelå–è¾¼å®Œäº†: ${Object.keys(kpi).length}é …ç›®`);
  selectBusiness(currentBusiness); saveBusinessData(); setTimeout(hideUploadModal, 1500);
}

function addBusiness() { const name = document.getElementById('new-business-name').value.trim(); const type = document.getElementById('new-business-type').value; if (!name) { alert('äº‹æ¥­åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; } if (BUSINESSES[name]) { alert('åŒåã®äº‹æ¥­ãŒå­˜åœ¨ã—ã¾ã™'); return; } BUSINESSES[name] = { data: {}, type: type }; saveBusinessData(); hideAddBusinessModal(); selectBusiness(name); }
function deleteBusiness() { if (Object.keys(BUSINESSES).length <= 1) { alert('æœ€å¾Œã®äº‹æ¥­ã¯å‰Šé™¤ã§ãã¾ã›ã‚“'); return; } if (confirm(`ã€Œ${currentBusiness}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) { delete BUSINESSES[currentBusiness]; saveBusinessData(); selectBusiness(Object.keys(BUSINESSES)[0]); } }

// ========== å–¶æ¥­å ±å‘Šæ›¸ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ ==========
function showReportPromptModal() {
  const business = BUSINESSES[currentBusiness];
  if (!business) { alert('äº‹æ¥­ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
  
  let data;
  let periodLabel;
  if (viewMode === 'total') {
    const result = calculateTotalsAndAverages(currentBusiness);
    if (!result) { alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“'); return; }
    data = result.totals;
    periodLabel = 'å…¨æœŸé–“ãƒˆãƒ¼ã‚¿ãƒ«';
  } else {
    const periodData = business.data?.[currentPeriod];
    data = periodData?.ã‚µãƒãƒªãƒ¼ || periodData || {};
    periodLabel = currentPeriod || 'æœªé¸æŠ';
  }
  
  if (!data || Object.keys(data).length === 0) { alert('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“'); return; }
  
  document.getElementById('report-business-period').textContent = `${currentBusiness} - ${periodLabel}`;
  document.getElementById('report-prompt-text').value = generateReportPrompt(currentBusiness, periodLabel, data, business.type);
  document.getElementById('report-prompt-modal').classList.remove('hidden');
}

function hideReportPromptModal() { document.getElementById('report-prompt-modal').classList.add('hidden'); }

function copyReportPrompt() {
  const text = document.getElementById('report-prompt-text').value;
  navigator.clipboard.writeText(text).then(() => {
    showStatus('ğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
  }).catch(() => {
    document.getElementById('report-prompt-text').select();
    document.execCommand('copy');
    showStatus('ğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
  });
}

function generateReportPrompt(businessName, period, data, type) {
  const formatVal = (key, val) => {
    if (val == null) return null;
    if (key.includes('ç‡') || key.includes('å‰²åˆ') || key === 'RTP') {
      return (val * 100).toFixed(2) + '%';
    }
    if (typeof val === 'number') {
      if (Math.abs(val) >= 1000000) return 'Â¥' + (val / 1000000).toFixed(2) + 'M';
      if (Math.abs(val) >= 1000) return 'Â¥' + Math.round(val).toLocaleString();
      return val.toLocaleString();
    }
    return val;
  };
  
  let prompt = `ä»¥ä¸‹ã¯ã€Œ${businessName}ã€ã®${period}ã®å–¶æ¥­ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«å–¶æ¥­å ±å‘Šæ›¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\n`;
  prompt += `ã€äº‹æ¥­åã€‘${businessName}\nã€æœŸé–“ã€‘${period}\n\n`;
  prompt += `ã€ä¸»è¦KPIãƒ‡ãƒ¼ã‚¿ã€‘\n`;
  
  // äº‹æ¥­ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸä¸»è¦KPIã®é †åº
  let keyOrder = [];
  if (type === 'konibet') {
    keyOrder = ['ç™»éŒ²äººæ•°', 'FTDæ•°', 'å…¥é‡‘è€…æ•°', 'ç·å…¥é‡‘é¡', 'ç·å‡ºé‡‘é¡', 'å…¥å‡ºé‡‘å·®åˆ†', 'T/O', 'GGR', 'NGR', 'ãƒœãƒ¼ãƒŠã‚¹', 'ã‚²ãƒ¼ãƒ ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãƒ•ã‚£ãƒ¼', 'PSPæ‰‹æ•°æ–™', 'AFFå ±é…¬', 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤äººæ•°', 'æ–°è¦å…¥é‡‘è»¢ç§»ç‡', 'å¹³å‡å…¥é‡‘é¡', 'å‡ºé‡‘äººæ•°å‰²åˆ', 'T/Oå€ç‡', 'ãƒœãƒ¼ãƒŠã‚¹ä»˜ä¸ç‡', 'GGRç‡', 'NGRç‡', 'RTP'];
  } else if (type === 'sloten') {
    keyOrder = ['GGR', 'ç·å…¥é‡‘é¡', 'ç·å‡ºé‡‘é¡', 'å…¥å‡ºé‡‘å·®åˆ†', 'T/O', 'RTP', 'NGR', 'ç™»éŒ²äººæ•°', 'ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°'];
  } else if (type === 'baccara') {
    keyOrder = ['Twitter', 'Instagram', 'TikTok', 'YouTube', 'LINEå…¬å¼', 'KICK', 'åˆè¨ˆãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼', 'ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°', 'ç·å…¥é‡‘é¡', 'å¹³å‡T/O', 'ç·GGR', 'ã‚³ã‚¹ãƒˆ', 'NGR'];
  } else if (type === 'ads') {
    keyOrder = ['ã‚³ã‚¹ãƒˆ(ç¨è¾¼)', 'ã‚¤ãƒ³ãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³', 'ã‚¯ãƒªãƒƒã‚¯', 'ç™»éŒ²æ•°', 'å…¥é‡‘æ•°', 'ç™»éŒ²CPA', 'å…¥é‡‘CPA', 'CTR', 'CVR'];
  } else {
    keyOrder = ['T/O', 'GGR', 'NGR', 'å›åç‡', 'å…¥å‡ºé‡‘å·®åˆ†'];
  }
  
  // ä¸»è¦KPIã‚’å‡ºåŠ›
  keyOrder.forEach(key => {
    const val = data[key];
    if (val != null) {
      prompt += `ãƒ»${key}: ${formatVal(key, val)}\n`;
    }
  });
  
  // ãã®ä»–ã®KPIã‚‚å‡ºåŠ›
  prompt += `\nã€ãã®ä»–ãƒ‡ãƒ¼ã‚¿ã€‘\n`;
  Object.keys(data).forEach(key => {
    if (!keyOrder.includes(key) && key !== 'ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆ(USD/JPY)') {
      const val = data[key];
      if (val != null) {
        prompt += `ãƒ»${key}: ${formatVal(key, val)}\n`;
      }
    }
  });
  
  prompt += `\n---\n`;
  prompt += `ä¸Šè¨˜ãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«ã€ä»¥ä¸‹ã®æ§‹æˆã§å–¶æ¥­å ±å‘Šæ›¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š\n`;
  prompt += `1. ã‚µãƒãƒªãƒ¼ï¼ˆä¸»è¦æŒ‡æ¨™ã®æ¦‚è¦ï¼‰\n`;
  prompt += `2. å‰æœŸæ¯”è¼ƒãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰\n`;
  prompt += `3. èª²é¡Œã¨æ”¹å–„ç‚¹\n`;
  prompt += `4. æ¬¡æœŸã®ç›®æ¨™ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³\n`;
  
  return prompt;
}

</script>

<!-- Telegramé€ä¿¡ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="telegramModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:10000; justify-content:center; align-items:center;">
  <div style="background:white; padding:30px; border-radius:16px; width:90%; max-width:500px; box-shadow:0 20px 60px rgba(0,0,0,0.3);">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
      <h3 style="margin:0; color:#0088cc;">ğŸ“¨ Telegramé€ä¿¡è¨­å®š</h3>
      <button onclick="closeTelegramModal()" style="background:none; border:none; font-size:24px; cursor:pointer;">Ã—</button>
    </div>
    
    <div style="margin-bottom:20px;">
      <label style="font-weight:bold; display:block; margin-bottom:8px;">ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹:</label>
      <textarea id="telegramMessage" rows="4" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:14px; box-sizing:border-box;">ğŸ“Šç¾åœ¨ã®å„äº‹æ¥­ã®é€²æ—

ğŸ”— ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: https://tking510.github.io/business-dashboard/</textarea>
    </div>
    
    <div style="margin-bottom:20px;">
      <label style="font-weight:bold; display:block; margin-bottom:8px;">â° é€ä¿¡ã‚¿ã‚¤ãƒŸãƒ³ã‚°:</label>
      <select id="telegramTiming" onchange="toggleScheduleInput()" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:14px;">
        <option value="now">ä»Šã™ãé€ä¿¡</option>
        <option value="schedule">æ™‚é–“æŒ‡å®š</option>
      </select>
    </div>
    
    <div id="scheduleInputDiv" style="display:none; margin-bottom:20px;">
      <label style="font-weight:bold; display:block; margin-bottom:8px;">ğŸ“… é€ä¿¡æ—¥æ™‚:</label>
      <input type="datetime-local" id="scheduledTime" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-size:14px; box-sizing:border-box;">
      <p style="color:#666; font-size:12px; margin-top:5px;">â€»ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã„ãŸã¾ã¾ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™</p>
    </div>
    
    <div id="scheduledList" style="margin-bottom:20px; display:none;">
      <label style="font-weight:bold; display:block; margin-bottom:8px;">ğŸ“‹ äºˆç´„æ¸ˆã¿é€ä¿¡:</label>
      <div id="scheduledItems" style="background:#f5f5f5; padding:10px; border-radius:8px; max-height:100px; overflow-y:auto;"></div>
    </div>
    
    <div style="display:flex; gap:10px;">
      <button onclick="sendTelegram()" style="flex:1; background:linear-gradient(135deg, #0088cc 0%, #00aced 100%); color:white; border:none; padding:14px; border-radius:8px; cursor:pointer; font-weight:bold; font-size:16px;">
        é€ä¿¡
      </button>
      <button onclick="closeTelegramModal()" style="flex:1; background:#f0f0f0; color:#333; border:none; padding:14px; border-radius:8px; cursor:pointer; font-weight:bold; font-size:16px;">
        ã‚­ãƒ£ãƒ³ã‚»ãƒ«
      </button>
    </div>
    
    <div id="telegramStatus" style="margin-top:15px; padding:10px; border-radius:8px; display:none;"></div>
  </div>
</div>

<script>
// Telegramè¨­å®š
const TELEGRAM_CONFIG = {
  botToken: '8508666327:AAHmOzk8YlXku9bLT1f-HcS2Kn_BD7BLrZk',
  chatId: '-5255488789'
};

let scheduledSends = [];

function openTelegramModal() {
  document.getElementById('telegramModal').style.display = 'flex';
  updateScheduledList();
}

function closeTelegramModal() {
  document.getElementById('telegramModal').style.display = 'none';
}

function toggleScheduleInput() {
  const timing = document.getElementById('telegramTiming').value;
  document.getElementById('scheduleInputDiv').style.display = timing === 'schedule' ? 'block' : 'none';
}

function updateScheduledList() {
  const listDiv = document.getElementById('scheduledList');
  const itemsDiv = document.getElementById('scheduledItems');
  
  if (scheduledSends.length === 0) {
    listDiv.style.display = 'none';
    return;
  }
  
  listDiv.style.display = 'block';
  itemsDiv.innerHTML = scheduledSends.map((s, i) => 
    '<div style="display:flex; justify-content:space-between; align-items:center; padding:5px 0; border-bottom:1px solid #ddd;">' +
    '<span>' + new Date(s.time).toLocaleString('ja-JP') + '</span>' +
    '<button onclick="cancelScheduled(' + i + ')" style="background:#ff4444; color:white; border:none; padding:3px 8px; border-radius:4px; cursor:pointer; font-size:12px;">å–æ¶ˆ</button>' +
    '</div>'
  ).join('');
}

function cancelScheduled(index) {
  clearTimeout(scheduledSends[index].timerId);
  scheduledSends.splice(index, 1);
  updateScheduledList();
  showTelegramStatus('äºˆç´„ã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ', 'info');
}

async function sendTelegram() {
  const timing = document.getElementById('telegramTiming').value;
  const message = document.getElementById('telegramMessage').value;
  
  if (timing === 'schedule') {
    const scheduledTime = document.getElementById('scheduledTime').value;
    if (!scheduledTime) {
      showTelegramStatus('é€ä¿¡æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
      return;
    }
    
    const sendTime = new Date(scheduledTime);
    const now = new Date();
    const delay = sendTime - now;
    
    if (delay <= 0) {
      showTelegramStatus('æœªæ¥ã®æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
      return;
    }
    
    const timerId = setTimeout(() => {
      executeTelegramSend(message);
      scheduledSends = scheduledSends.filter(s => s.timerId !== timerId);
      updateScheduledList();
    }, delay);
    
    scheduledSends.push({ time: sendTime, timerId: timerId, message: message });
    updateScheduledList();
    showTelegramStatus('ğŸ“… ' + sendTime.toLocaleString('ja-JP') + ' ã«é€ä¿¡äºˆç´„ã—ã¾ã—ãŸ', 'success');
  } else {
    await executeTelegramSend(message);
  }
}

async function executeTelegramSend(message) {
  showTelegramStatus('é€ä¿¡ä¸­...', 'info');
  
  try {
    const url = 'https://api.telegram.org/bot' + TELEGRAM_CONFIG.botToken + '/sendMessage';
    const response = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        chat_id: TELEGRAM_CONFIG.chatId,
        text: message,
        parse_mode: 'HTML'
      })
    });
    
    const result = await response.json();
    
    if (result.ok) {
      showTelegramStatus('âœ… é€ä¿¡æˆåŠŸã—ã¾ã—ãŸï¼', 'success');
    } else {
      showTelegramStatus('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.description, 'error');
    }
  } catch (error) {
    showTelegramStatus('âŒ é€ä¿¡å¤±æ•—: ' + error.message, 'error');
  }
}

function showTelegramStatus(message, type) {
  const statusDiv = document.getElementById('telegramStatus');
  statusDiv.style.display = 'block';
  statusDiv.style.background = type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#d1ecf1';
  statusDiv.style.color = type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460';
  statusDiv.textContent = message;
  
  if (type === 'success') {
    setTimeout(() => { statusDiv.style.display = 'none'; }, 3000);
  }
}

// ========== ãƒªãƒ³ã‚¯é›†ãƒ‡ãƒ¼ã‚¿ ==========
const ALL_LINKS_DATA = [{"name": "https://admin.sloten.io/#/login", "url": "https://admin.sloten.io/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "Affiliate-ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½_æ¥­å‹™ãƒãƒ‹ãƒ¥ã‚¢ãƒ« (1).pdf", "url": "https://drive.google.com/file/d/1MD17WZ-1_3FPfbSda8ZazXFoHPDBWs5q/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "CSãƒãƒ¼ãƒ _æ¥­å‹™ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1yaJLp77zkMbuRSklo9c5nTsfJTv7pESC/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ã‚¹ã‚¿ãƒƒãƒ•ã‚·ãƒ•ãƒˆè¡¨_å®Œå…¨ç‰ˆ", "url": "https://docs.google.com/spreadsheets/d/1tR0hRKy7wyKMc9Nk1MhQ_kOqs3Acg6LoG-nau1VETIA/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "Affiliate-ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½", "url": "https://docs.google.com/spreadsheets/d/1GLaqQEoqEJZSRUUkYHiPKMhPXG7X7gwRmpoCe14FTQ8/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "customersupport-ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½", "url": "https://docs.google.com/spreadsheets/d/1lmjDjjwtQvykisZAqUD2OsI9zB_Xru8nTkGIPo5NSsY/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "https://sloten.io/", "url": "https://sloten.io/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "AFFç®¡ç†ã‚·ãƒ¼ãƒˆ_ä½¿ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1ggZL19MNxwF6C3C3uFzocOXiDxIv1OLu/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒã‚§ãƒƒã‚¯ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰_ä½¿ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1MPfM_gxH3QujbA2zJoXC_BvKiVYUjm3y/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "https://affiliate2.sloten.io/", "url": "https://affiliate2.sloten.io/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ æ“ä½œå®Œå…¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1cakCLShY7zL7htExWaTtYsWTvXtQ3cbO/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒã‚§ãƒƒã‚¯ç®¡ç†", "url": "https://docs.google.com/spreadsheets/d/1CvFwZ3HDKjEUvzUjOH5xrKYGq2hwlWwAifxWWdUZRmk/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "é–‹ç™ºãƒªã‚¯ã‚¨ã‚¹ãƒˆç”¨", "url": "https://docs.google.com/spreadsheets/d/1qjfoPKpugtf9flrfDsdHHsnLQyIM6ARI4EmPJ-_EYGY/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆäº¤æ¸‰", "url": "https://docs.google.com/document/d/1wDR8F_PS6d1uOexvzy32z-mGK2R1LvSQlKvjwN2Lbqg/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½ã‚²ãƒ¼ãƒ ã‚¨ãƒ©ãƒ¼ç”¨", "url": "https://docs.google.com/spreadsheets/d/1vKFFoEYVw7z1C7bU3thgwf_U7scmVSuLpz_xGJPjWpc/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ãƒ‡ã‚¶ã‚¤ãƒ³ä¾é ¼ãƒ†ãƒ³ãƒ—ãƒ¬", "url": "https://docs.google.com/document/d/1aZeeeN3jeTOtFIPb-w522eUPwqFQa-HA1jtunnlwhI4/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "AFFæƒ³å®šã€€Q&A", "url": "https://docs.google.com/document/d/17p1U1gxVsVXPyluIi6Df5yXHRPCAlULtfbHMA0sl7Dc/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://im.slot-h.com/app/accounts/3/dashboard", "url": "https://im.slot-h.com/app/accounts/3/dashboard", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ã‚¨ãƒ©ãƒ¼ä¾é ¼ãƒ†ãƒ³ãƒ—ãƒ¬", "url": "https://docs.google.com/document/d/140p9DoXIrl-g3ARPueRCktRcM6wMtYe0umLsBl_KzJw/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "æ³•æ”¹æ­£å¾Œç¨¼åƒAFF", "url": "https://docs.google.com/document/d/1PUDz6gnhQy1JY8wetz6-o7ID1l6teTlX2Up4AmoJ3GY/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ãƒšã‚¤ãƒ¡ãƒ³ãƒˆéƒ¨é–€_æ¥­å‹™ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1crHJAlc8zfV-x9jJFoxnDkZ45L0EFEq4/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ä¾é ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆçµ±åˆã‚¬ã‚¤ãƒ‰.pdf", "url": "https://drive.google.com/file/d/10Y28qgc_Qy9EdoqUDx7wGJw1_G7zw_Qd/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆäº¤æ¸‰ãƒãƒ‹ãƒ¥ã‚¢ãƒ«_å®Œå…¨ç‰ˆ.pdf", "url": "https://drive.google.com/file/d/1Yd45I7jsBpi0z0w64DgEObVBsgwyyjaO/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "Payment-ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½", "url": "https://docs.google.com/spreadsheets/d/1lBgXBn2GrDejUGd_p_SZJzFXIRRUosApgyJv-ns9PVY/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½_(sloten.io)_åˆ©ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1fjtVuJ7sEKVQI8ZojDSniCv-i2L6fIC5/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆäº¤æ¸‰å¯¾è±¡ä¸€è¦§", "url": "https://docs.google.com/spreadsheets/d/1RpzwRIDj9kdLA9IgiDyJp2FglPfFjonsehacHzhZA_Q/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "BigWinç®¡ç†ã‚·ãƒ¼ãƒˆ", "url": "https://docs.google.com/spreadsheets/d/1XuWNCPtObuebJ1zaPH5TisZzUh8Ro8r0mu1FTcX74is/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "Slotenç®¡ç†ç”»é¢æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1dH_Y-cBVIRs1PpOlRc4hrvckWeO5qQzG/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "AFF ç®¡ç†ã‚·ãƒ¼ãƒˆ ", "url": "https://docs.google.com/spreadsheets/d/1n_LugVAUAW3wwGvkXXNwl4W4u54Pb527wm_1q4ptZu8/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "BigWinç®¡ç†ã‚·ãƒ¼ãƒˆ_ä½¿ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1DD5-OpdLXkW_-RM_eeX_oX-1HtWHy2_n/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "SLOTENã‚·ã‚¹ãƒ†ãƒ å®Œå…¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1HmiZOhXS9BJIJebxOiLNGHH2VHp0qSiO/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆçµŒé¨“æƒ…å ±åé›†ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1w_ymENbPhoiOjb7hie7OoBR0wN9w-MPJ/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "PayPayæ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ _å®Œå…¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1oU-KV0fJDZrxxee-4Bp7Xh8kstX6Eh83/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ãƒ­ãƒˆæŠ½é¸ã‚·ã‚™ãƒ£ãƒƒã‚¯ãƒ›ã‚šãƒƒãƒˆæ©Ÿèƒ½ï½œã‚¹ã‚¿ãƒƒãƒ•èª¬æ˜è³‡æ–™.pdf", "url": "https://drive.google.com/file/d/1wuqU_JjlxRHZf6hsKXdPJDuyTJ7smkAN/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆåˆ¶åº¦_æ´»ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1vwrDJil97_49XN5KgMVnEhyysxtCkj_7/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "OKJéŠ€è¡ŒæŒ¯è¾¼ãƒãƒ‹ãƒ¥ã‚¢ãƒ«_-_å®‰å…¨ãªå…¥é‡‘ã®ãŸã‚ã®å®Œå…¨ã‚¬ã‚¤ãƒ‰.pdf", "url": "https://drive.google.com/file/d/1dQd_4fR7xczNgZQAARcrh1_UMUKDjqZ6/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "https://discord.gg/7hrDaJfw", "url": "https://discord.gg/7hrDaJfw", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆäº¤æ¸‰ãƒ»æ´»ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«çµ±åˆç‰ˆ.pdf", "url": "https://drive.google.com/file/d/1h43L7UCIKPOwgYYi6aB5sAPXhvKb-26Q/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ã‚»ãƒˆãƒ«ãƒ«ãƒ¼ãƒ«", "url": "https://drive.google.com/file/d/1utkzLJharn-H7AKGv-4kG_hPEeK_x2zC/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "https://lin.ee/jTDURj3", "url": "https://lin.ee/jTDURj3", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½_ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ  (3).pdf", "url": "https://drive.google.com/file/d/100M986dhIQlDBUu2b9ddtzgC-Oay0BMN/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "å…¥é‡‘ãƒ•ãƒ­ãƒ¼ã¾ã¨ã‚ï¼ˆå®Œå…¨ç‰ˆï¼‰.pdf", "url": "https://drive.google.com/file/d/1S2lkhPgb2CkafeCmisHzmczvYvpDiyEt/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "https://t.me/slotheavenbot", "url": "https://t.me/slotheavenbot", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://asp.sloten.io/login?redirect=/home", "url": "https://asp.sloten.io/login?redirect=/home", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ECæ±ºæ¸ˆç™ºè¡Œæ–¹æ³•ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1UYb9OgxGPKSBC-EbVrj7ECJD4H74R3en/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "SMART BIZ TECHNOLOGY INC SUB-LICENSE 2024.pdf", "url": "https://drive.google.com/file/d/1kzH1VXOoUiMXTPhhxF_uTWIjACeEMNBE/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆå–¶æ¥­ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ_ãƒãƒ‹ãƒ¥ã‚¢ãƒ« (2).pdf", "url": "https://drive.google.com/file/d/18GITRPM_x3BiTQv8KL0v6RsmWvEIZKZ5/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://add.sloten.io/", "url": "https://add.sloten.io/", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "https://lottojackpot-jkhjm2sm.manus.space", "url": "https://lottojackpot-jkhjm2sm.manus.space", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ç«¶é¦¬ç³»ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹_60å", "url": "https://docs.google.com/spreadsheets/d/1glOO7LnOfonaRDXqbjQp0olXBx4OCwm1w9oWJk1-mIE/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ã‚¹ãƒ­å¤©ï¼¥ï¼£ç€é‡‘", "url": "https://docs.google.com/spreadsheets/d/18KCWtE3_wFStjIE8RYlK47XaeAi3TRwGpvugBwSe3Qk/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³éƒ¨é–€_æ¥­å‹™ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/161xgqNM94UIKiszi_kr-UGLtfE-9gnJM/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ç«¶è‰‡ç³»ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹_50å", "url": "https://docs.google.com/spreadsheets/d/10n6lRdEQgjz-szgeqYiIAEbDKHWExG2wVsmv6ca6suk/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ã‚¹ãƒ­å¤©Paypay", "url": "https://docs.google.com/spreadsheets/d/1a-qM_--jYMaeYgurhRkZRiJH4r9INsrokjTzlzmhSds/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨-ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½", "url": "https://docs.google.com/spreadsheets/d/1-Yov3AcStVcdVIPNh1OicwaYssdg0Ei6mR80qlmUgq4/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ãƒãƒ¼ã‚«ãƒ¼ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä¸€è¦§", "url": "https://docs.google.com/spreadsheets/d/1n51wmJVayjYot1MSW5cBSDSDCnT2NiDZfFMOkb1PQoQ/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "å€‹äººç€é‡‘ç¢ºèªã‚·ãƒ¼ãƒˆ", "url": "https://docs.google.com/spreadsheets/d/1daNRR0EOVns0surDpfeng5CQ4PMNJ7j7kQ12jiRJkw8/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ã‚¹ãƒ­å¤©KPIã‚·ãƒ¼ãƒˆ", "url": "https://docs.google.com/spreadsheets/d/1oGnetFNtGd1ZB-A9YkzzfqIU4Bxh3djsABeEX_bHl8M/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "å®ãã˜ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼", "url": "https://docs.google.com/spreadsheets/d/1sVrc6Yhsu9qOF-CiMxM48r1jVxbKQFl08oxRWGtUcmg/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ã‚¹ãƒ­å¤©_å…¥å‡ºé‡‘ã®æµã‚Œï¼ˆã¾ã¨ã‚ï¼‰.pdf", "url": "https://drive.google.com/file/d/1UxWGSvb05zWFZ-hkoPTwk-vCd7c_eS6H/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "SMS-LPâ‘ è¨ˆæ¸¬", "url": "https://docs.google.com/spreadsheets/d/18QiN_BoVS-hdP-e4vNOAzjDZaFLTtnWlogJ5AW1hQSY/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ãƒ‘ãƒãƒ³ã‚³ãƒ»ãƒ‘ãƒã‚¹ãƒ­ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä¸€è¦§", "url": "https://docs.google.com/spreadsheets/d/17YCTAGla5a2daKbqm48k7Tr7PZq0ols8yhr38m78V-Y/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ãƒšã‚¤ãƒ¡ãƒ³ãƒˆã‚³ã‚¹ãƒˆã‚·ãƒ¼ãƒˆ", "url": "https://docs.google.com/spreadsheets/d/1wcSLMZ-Yrk3sMN2b1I7hOfUpyGveB7YjeK4o34UkFUE/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ", "url": "https://docs.google.com/spreadsheets/d/1w2bVg5jhKNzkSPrOfdu2siWq1wwRRq3YZGZ5XdhZQBo/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "éº»é›€ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä¸€è¦§", "url": "https://docs.google.com/spreadsheets/d/17qJkfdSvBnuQ1ym-AOACHZc2ZcsbAUAJHD9zej9tlak/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½é€šä¿¡è²»ç®¡ç†", "url": "https://docs.google.com/spreadsheets/d/1KjTPZUD5ymtu9RyBMdpVOmHCh1YONfJ1ZnyVoFd_Tnw/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "å…¬å¼SNSæŠ•ç¨¿ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½", "url": "https://docs.google.com/spreadsheets/d/1FHYqOfah4QAELcteQ5D_uh7eaNOxShrs7Uw9FFC22rU/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚«ã‚¸ãƒã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ä¸€è¦§", "url": "https://docs.google.com/spreadsheets/d/1IS_kyOhRxbBryaKKys_2_wrQuZeH1rKfSdhtMoXXyFk/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ã‚³ãƒ³ãƒ“ãƒ‹æ‰•ã„ã®ã”åˆ©ç”¨æ–¹æ³• (2).pdf", "url": "https://drive.google.com/file/d/1nbIZCGfwppBDNvl0FRehflzsZcB1Jh2d/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ãƒ¡ãƒ«ãƒã‚¬", "url": "https://docs.google.com/spreadsheets/d/1B0VSScmblCgUszAxIKvFzdTRSUSqxTnzJSv7djSB5DQ/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "FXç³»ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹", "url": "https://docs.google.com/spreadsheets/d/1k9ytUTFIu3S6yeyRMun-QnUN0kM5Ub_cnafyki5VCQo/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "PayPayé€é‡‘ãƒãƒ‹ãƒ¥ã‚¢ãƒ« (1).pdf", "url": "https://drive.google.com/file/d/1GmMvnSXvbl3vd5NxrGeDvguUHO3Zh0-4/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆä¼ç”»ææ¡ˆ.pdf", "url": "https://drive.google.com/file/d/12IG73qt6L8vE2YPdRLSNW418DXhAOTil/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ãƒã‚¤ãƒŠãƒªãƒ¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç³»ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹", "url": "https://docs.google.com/spreadsheets/d/13NkpKKL1c9EommpLHz4s3Acq0ppGesw4JS1_gPe1gAc/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "KYCæ’®å½±", "url": "https://drive.google.com/file/d/1EGt6Pu3vpF_2FHJsqxK7ZezfXE8na3PZ/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "SocialDog_å¾¹åº•æ´»ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1IrvtVSvbTeT7qc-UH1cR3D2TY2P0i5oe/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ä»®æƒ³é€šè²¨ç³»ã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹", "url": "https://docs.google.com/spreadsheets/d/1BE5L25av_kK4m3Pbrfn3ELrfbsHHtn7Gt_niEpcM3Oc/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ATMæŒ¯è¾¼æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ« (2).pdf", "url": "https://drive.google.com/file/d/1T2NIkb5CUgqpcljvX9-BYhNZqO2TaaSv/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ãƒœãƒ¼ãƒŠã‚¹ä½œæˆã®å®Ÿè·µä¾‹.pdf", "url": "https://drive.google.com/file/d/1s17K-oe5mmz28O1S5Y_7RIF5S1NwT-AB/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆã¨ã¯", "url": "https://drive.google.com/file/d/1sxRBdrnisb2nj9mbJ2VMTdai7OXra_SD/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "æ”¯æ‰•ã„æ–¹æ³•ç®¡ç†ã‚·ãƒ¼ãƒˆ", "url": "https://docs.google.com/spreadsheets/d/18Tv8K86jey2-ljIMIXfrnWe3XuGEhUGBcYBgNSSrys4/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ãƒ¡ãƒ«ãƒã‚¬ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰_ä½¿ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1PJqbjZv125x6wzwZjRe01qZxc5NkY2nf/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚²ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆå‚å…¥ãƒãƒ‹ãƒ¥ã‚¢ãƒ« (1).pdf", "url": "https://drive.google.com/file/d/1drlObkpN75njpLE0Z-v5cQQ6WwtrvuL9/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ãƒ­ã‚¸ãƒƒã‚¯", "url": "https://docs.google.com/spreadsheets/d/1bzncOP78MQz60lIzD-jamDraTXcdDNFfsrG-MZ5Adzw/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰_ä½¿ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1VCWfMwo09oAHjw691R-hgLBJJSc2MSLf/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚²ãƒ¼ãƒŸãƒ³ã‚°æœªçµŒé¨“è€…", "url": "https://drive.google.com/file/d/17rMfFcGpwGsjVLNL6Pj9kdituGOHzuZ0/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "å…¥å‡ºé‡‘ãƒ•ãƒ­ãƒ¼", "url": "https://docs.google.com/spreadsheets/d/13kyzH7kR5mDD4MBKVHfQXAYmxh5H0sYzZsJkEv8ROI4/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "SMSé€ä¿¡ç®¡ç†ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½", "url": "https://docs.google.com/spreadsheets/d/1_pMLIN8bHkaVUcAZS0PiQQiBCGpJmcWMeywDeIE-TLY/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚²ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆSNSãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1v5GEHQWKwgmsF89IAMR3PRfzQbXt9Cl4/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://docs.google.com/spreadsheets/d/1pYIWw-irXlN__nVfeJ3pK62LAPjmWLTBUnGvJmfa370/edit?usp=sharingg", "url": "https://docs.google.com/spreadsheets/d/1pYIWw-irXlN__nVfeJ3pK62LAPjmWLTBUnGvJmfa370/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "SMS-LPâ‘ è¨ˆæ¸¬ä½¿ç”¨æ–¹æ³•", "url": "https://drive.google.com/file/d/1vHabuP-EWFtGKhyAA5HvcUjcNpGMWcEV/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚²ãƒ¼ãƒŸãƒ³ã‚°çµŒé¨“è€…", "url": "https://drive.google.com/file/d/10UJ7ZQplHSdl85_tsNwmWjD6SFKe4jrY/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "å…¥é‡‘å‡ºé‡‘é›†è¨ˆBO", "url": "https://docs.google.com/spreadsheets/d/1jmEs_orPFe7y5YPnj7_bFT1JHiIs-cCFOptQsNOCqsM/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ"}, {"name": "SMS-LPâ‘ è¨ˆæ¸¬_ä½¿ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/132mVbncdAtkabvag_1mVUjaGTMu2hi6G/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "åˆå¿ƒè€…å‘ã‘ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆå‰¯æ¥­ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1CMJn0pV8fJpNNwl1-rVhmOxJvIRYbHj9/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "Lafficç•ªå·åˆ¥é€ä¿¡æ–¹æ³•", "url": "https://drive.google.com/file/d/1fEFLONFUt1AuL7aRrT_3f9_gMc2j0KP9/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "åˆå¿ƒè€…æ­“è¿ï¼ã‚¹ãƒãƒ›ã§å§‹ã‚ã‚‹ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆå‰¯æ¥­ãƒãƒ‹ãƒ¥ã‚¢ãƒ«_br_å¯¾è±¡ï¼šã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆæœªçµŒé¨“è€….pdf", "url": "https://drive.google.com/file/d/1EuNc7ikGlVhN1P56FtcPOampg0ZeTkTs/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://lp.diamond-secret.club/reports/secure/click_report_SLOTENTEST.php", "url": "https://lp.diamond-secret.club/reports/secure/click_report_SLOTENTEST.php", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "AFFå¿…é”ã‚¹ãƒ­å¤©", "url": "https://docs.google.com/spreadsheets/d/1sX2tFlm-Fo4vML8HaisPqzLj3sIhYXBzJxHvTLzZxbU/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://millionheaven.site/", "url": "https://millionheaven.site/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "æ—¢å­˜å®¢ã‚¢ãƒ•ã‚£ãƒªãƒ¬ãƒãƒ¼ãƒˆ", "url": "https://docs.google.com/spreadsheets/d/1CRkRQrlqEOy0Wn4YPZNwaPHu9VYcEGg7I4CMrqNxGbo/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½TIKTOKè¨ˆæ¸¬ç”¨", "url": "https://docs.google.com/spreadsheets/d/1RmVdM24EZKDhKem3htNazU_fod4JJXL-U2bCiJPJmgA/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://casino-affiliate-pulse.lovable.app/", "url": "https://casino-affiliate-pulse.lovable.app/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://millionheaven.space", "url": "https://millionheaven.space/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "VIP-ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½_æ¥­å‹™ãƒãƒ‹ãƒ¥ã‚¢ãƒ«.pdf", "url": "https://drive.google.com/file/d/1ifRKr1I94k2YMjJ0x9rfoLOL4lkBxqnq/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "FB10.xlsx", "url": "https://docs.google.com/spreadsheets/d/1GsPqdAcd2TjRKj4GPk6QzziLsM9IHg4K/edit?usp=sharing&ouid=117427496538087859948&rtpof=true&sd=true", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "VIP-ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½", "url": "https://docs.google.com/spreadsheets/d/1UdC202Mx0UP_qzIIJY3tI3DyI4OGAJg88o5C7GIklU0/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://fviainboxes.com/", "url": "https://fviainboxes.com/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ç›®çš„åˆ¥ã‚¢ãƒƒãƒ—ã‚»ãƒ«ãƒˆãƒ¼ã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚¹ãƒ­å¤©_å®Œå…¨ç‰ˆï¼‰.pdf", "url": "https://drive.google.com/file/d/1alGFHvW-gO_1dCv9MeiFEYXZsYfzom1I/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "LPç®¡ç†", "url": "https://docs.google.com/spreadsheets/d/1yLbPPOr85l5x15CoIPTWMbFQqQV0CQjdeoi1dSauX6U/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "é›»è©±å–¶æ¥­ãƒªã‚¹ãƒˆç®¡ç†ãƒ„ãƒ¼ãƒ«", "url": "https://docs.google.com/spreadsheets/d/1TKIejq0QR2bywgZ67xsDQKjH5ZYqn3ijJZRzs4t2y9Y/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://panel.cloudzy.com/dashboard", "url": "https://panel.cloudzy.com/dashboard", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "VIP-ã‚¹ãƒ­ãƒƒãƒˆå¤©å›½", "url": "https://docs.google.com/spreadsheets/d/1UdC202Mx0UP_qzIIJY3tI3DyI4OGAJg88o5C7GIklU0/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://lptracker-8dhyg4ut.manus.space", "url": "https://lptracker-8dhyg4ut.manus.space", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "VIPåˆ¤å®šã‚·ã‚¹ãƒ†ãƒ ", "url": "https://docs.google.com/spreadsheets/d/1cRDYJQKkPqdzJcSx7zeEy83XMS8pDgLQRcP---lzg-4/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ"}, {"name": "https://sloten-dashboard.manus.space/", "url": "https://sloten-dashboard.manus.space/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼ç®¡ç†ãƒãƒ‹ãƒ¥ã‚¢ãƒ«_æœ€çµ‚ç‰ˆ.pdf", "url": "https://drive.google.com/file/d/1oKkODqjpZTJbd-wvudUM5Gbn2uiDjPxc/view?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://sloten-link.manus.space", "url": "https://sloten-link.manus.space", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ãƒ¡ãƒ¼ãƒ«", "url": "https://docs.google.com/spreadsheets/d/1-_GzRGpqZqm-lmI32XBA9yhhr4bGm5H0eN04PzRxg-0/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://sloten-aff.xyz", "url": "https://sloten-aff.xyz", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://sloten-manga.xyz", "url": "https://sloten-manga.xyz/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "ãƒ˜ãƒ–ãƒ³ã‚ºã‚·ãƒ§ãƒƒãƒˆ", "url": "https://docs.google.com/spreadsheets/d/1j8-qutGdAON0W0Fn4KIiQdt4HiXmkudMNGQ21Ba0ZMw/edit?gid=0", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "SMSé€ä¿¡ãƒªã‚¹ãƒˆ", "url": "https://docs.google.com/spreadsheets/d/1dZo7cQL1pM1Z2sU8P5qoYIvsyBs0PS16lnKPxtDJ3yE/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "SMSé€ä¿¡æœ¬å±‹", "url": "https://docs.google.com/spreadsheets/d/1yTu17jNIgIGEbgJK639mrbH_lgBWA79vUSfNdACK_dM/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://docs.google.com/spreadsheets/d/1qGd0hneNNqNNZCNMXbO89wYusHIbB0nnNqZNvjsqnbY/edit?usp=sharing", "url": "https://docs.google.com/spreadsheets/d/1qGd0hneNNqNNZCNMXbO89wYusHIbB0nnNqZNvjsqnbY/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://docs.google.com/spreadsheets/d/1Qh4xxb6pIXP1TMdRY24zcJcjDts-2MFgXcTYfKjHNg8/edit?usp=sharing", "url": "https://docs.google.com/spreadsheets/d/1Qh4xxb6pIXP1TMdRY24zcJcjDts-2MFgXcTYfKjHNg8/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://docs.google.com/spreadsheets/d/14nWspAUsHzmCewIySecFwxAROP2xpy56zoVChBRJNYw/edit?usp=sharing", "url": "https://docs.google.com/spreadsheets/d/14nWspAUsHzmCewIySecFwxAROP2xpy56zoVChBRJNYw/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://docs.google.com/spreadsheets/d/1_Wfe1tqWIyuLWYZ73QQPMYeDL8FInQTWCAvsn0ptogA/edit?usp=sharing", "url": "https://docs.google.com/spreadsheets/d/1_Wfe1tqWIyuLWYZ73QQPMYeDL8FInQTWCAvsn0ptogA/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://docs.google.com/spreadsheets/d/1Z-fVjbHWAUXLgajlDba1Pm1fU6Ble52ddbVLBcxFEcU/edit?usp=sharing", "url": "https://docs.google.com/spreadsheets/d/1Z-fVjbHWAUXLgajlDba1Pm1fU6Ble52ddbVLBcxFEcU/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://docs.google.com/spreadsheets/d/1o58Zmm6dhcFbLRfLZajLjsWbeE57DOQqY5ncH1FunUs/edit?usp=sharing", "url": "https://docs.google.com/spreadsheets/d/1o58Zmm6dhcFbLRfLZajLjsWbeE57DOQqY5ncH1FunUs/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://docs.google.com/spreadsheets/d/1tmBj1U_pclbuIFk1lQz8cSTAH0aPOPW9G92j4Mo5tq8/edit?usp=sharing", "url": "https://docs.google.com/spreadsheets/d/1tmBj1U_pclbuIFk1lQz8cSTAH0aPOPW9G92j4Mo5tq8/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://share.dc-ace.com/login?redirect=/folder/DC%2520Lobby/Promo%2520Package/", "url": "https://share.dc-ace.com/login?redirect=/folder/DC%2520Lobby/Promo%2520Package/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://docs.google.com/spreadsheets/d/1c58Oz88Y-8Yg8Xz4yqQYk8KgFIjufZefbC94krz3dwo/edit?usp=sharing", "url": "https://docs.google.com/spreadsheets/d/1c58Oz88Y-8Yg8Xz4yqQYk8KgFIjufZefbC94krz3dwo/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://crm-segmentation-tool-gnwlkpueqvcdgapck3uv8z.streamlit.app/", "url": "https://crm-segmentation-tool-gnwlkpueqvcdgapck3uv8z.streamlit.app/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "SMSãƒ‡ãƒ¼ã‚¿", "url": "https://docs.google.com/spreadsheets/d/1o58Zmm6dhcFbLRfLZajLjsWbeE57DOQqY5ncH1FunUs/edit?usp=sharing", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://shared-calendar-app-iota.vercel.app/", "url": "https://shared-calendar-app-iota.vercel.app/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://crm-segmentation-tool-gnwlkpueqvcdgapck3uv8z.streamlit.app/", "url": "https://crm-segmentation-tool-gnwlkpueqvcdgapck3uv8z.streamlit.app/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://nexus-seo-u5uq936q.manus.space/", "url": "https://nexus-seo-u5uq936q.manus.space/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://userdash-eanx4o83.manus.space/?code=C9CEZYMehvBKv3HUVMoNGw", "url": "https://userdash-eanx4o83.manus.space/?code=C9CEZYMehvBKv3HUVMoNGw", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://gamblingtourn-abc2g3fa.manus.space/", "url": "https://gamblingtourn-abc2g3fa.manus.space/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://manus.im/app/gSl7xKgVa6DexT3bvJsx0J", "url": "https://manus.im/app/gSl7xKgVa6DexT3bvJsx0J", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://expvaluecalc-krrpfvay.manus.space/", "url": "https://expvaluecalc-krrpfvay.manus.space/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "https://upapp.io/", "url": "https://upapp.io/", "business": "ã‚¹ãƒ­å¤©", "category": "ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º"}, {"name": "SMSãƒ»ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒã‚§ãƒƒã‚¯", "url": "https://smsmailtool.slomanga.com/", "business": "ã‚¹ãƒ­å¤©", "category": "ãƒ„ãƒ¼ãƒ«"}, {"name": "ãƒã‚¤ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒãƒ³ã‚³", "url": "https://lp.diamond-secret.club/Hiratepachi5/", "business": "DSC", "category": "ã‚¤ãƒ™ãƒ³ãƒˆLP"}, {"name": "ï¼•ã®ã¤ãæ—¥CB30% ", "url": "https://lp.diamond-secret.club/5day/", "business": "DSC", "category": "ã‚¤ãƒ™ãƒ³ãƒˆLP"}, {"name": "ï¼“ã®ã¤ãæ—¥ã‚¹ãƒ­ãƒƒãƒˆ", "url": "https://lp.diamond-secret.club/complete/", "business": "DSC", "category": "ã‚¤ãƒ™ãƒ³ãƒˆLP"}, {"name": "ï¼™ã®ã¤ãæ—¥â‘¥ç¢ºå®š", "url": "https://lp.diamond-secret.club/9day/", "business": "DSC", "category": "ã‚¤ãƒ™ãƒ³ãƒˆLP"}, {"name": "é«˜é…å½“è²·å–", "url": "https://lp.diamond-secret.club/ReplayLink/", "business": "DSC", "category": "ã‚¤ãƒ™ãƒ³ãƒˆLP"}, {"name": "æ–°è¦ç”¨é«˜é…å½“è²·å–â‘ ", "url": "https://lp.diamond-secret.club/kaitoriip/", "business": "DSC", "category": "ã‚¤ãƒ™ãƒ³ãƒˆLP"}, {"name": "æ–°è¦ç”¨é«˜é…å½“è²·å–â‘¡", "url": "https://lp.diamond-secret.club/maxkaitori/", "business": "DSC", "category": "ã‚¤ãƒ™ãƒ³ãƒˆLP"}, {"name": "AIãƒ„ãƒ¼ãƒ«ä¸€è¦§", "url": "https://aitoolsdir-lzighuyw.manus.space/", "business": "å…±é€š", "category": "AIãƒ„ãƒ¼ãƒ«"}];

function renderLinksTab() {
  const container = document.getElementById('summary-section');
  const searchQuery = document.getElementById('linkSearchQuery')?.value?.toLowerCase() || '';
  const businessFilter = document.getElementById('linkBusinessFilter')?.value || 'all';
  const categoryFilter = document.getElementById('linkCategoryFilter')?.value || 'all';
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  let filtered = ALL_LINKS_DATA.filter(link => {
    const matchSearch = !searchQuery || 
      link.name.toLowerCase().includes(searchQuery) || 
      link.url.toLowerCase().includes(searchQuery);
    const matchBusiness = businessFilter === 'all' || link.business === businessFilter;
    const matchCategory = categoryFilter === 'all' || link.category === categoryFilter;
    return matchSearch && matchBusiness && matchCategory;
  });
  
  // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªäº‹æ¥­ã¨ã‚«ãƒ†ã‚´ãƒªã‚’å–å¾—
  const businesses = [...new Set(ALL_LINKS_DATA.map(l => l.business))];
  const categories = [...new Set(ALL_LINKS_DATA.map(l => l.category))];
  
  let html = `
    <div style="background:white; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
      <h3 style="margin:0 0 15px 0; color:#333;">ğŸ”— ãƒªãƒ³ã‚¯é›† (å…¨${ALL_LINKS_DATA.length}ä»¶)</h3>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <input type="text" id="linkSearchQuery" onkeyup="renderLinksTab()" placeholder="ğŸ” æ¤œç´¢..." 
          style="flex:1; min-width:200px; padding:10px; border:1px solid #ddd; border-radius:8px;" value="${searchQuery}">
        <select id="linkBusinessFilter" onchange="renderLinksTab()" style="padding:10px; border:1px solid #ddd; border-radius:8px;">
          <option value="all">å…¨äº‹æ¥­</option>
          ${businesses.map(b => '<option value="' + b + '"' + (businessFilter === b ? ' selected' : '') + '>' + b + '</option>').join('')}
        </select>
        <select id="linkCategoryFilter" onchange="renderLinksTab()" style="padding:10px; border:1px solid #ddd; border-radius:8px;">
          <option value="all">å…¨ã‚«ãƒ†ã‚´ãƒª</option>
          ${categories.map(c => '<option value="' + c + '"' + (categoryFilter === c ? ' selected' : '') + '>' + c + '</option>').join('')}
        </select>
      </div>
    </div>
  `;
  
  // äº‹æ¥­åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  const grouped = {};
  filtered.forEach(link => {
    const key = link.business + '|' + link.category;
    if (!grouped[key]) grouped[key] = [];
    grouped[key].push(link);
  });
  
  // äº‹æ¥­ã”ã¨ã®è‰²
  const businessColors = {
    'ã‚¹ãƒ­å¤©': '#10b981',
    'DSC': '#8b5cf6',
    'å…±é€š': '#3b82f6'
  };
  
  // ã‚«ãƒ†ã‚´ãƒªã‚¢ã‚¤ã‚³ãƒ³
  const categoryIcons = {
    'ã‚·ã‚¹ãƒ†ãƒ ãƒ»é–‹ç™º': 'ğŸ’»',
    'ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ': 'ğŸ¤',
    'CSãƒ»ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ': 'ğŸ’°',
    'ãƒ„ãƒ¼ãƒ«': 'ğŸ”§',
    'ã‚¤ãƒ™ãƒ³ãƒˆLP': 'ğŸ‰',
    'AIãƒ„ãƒ¼ãƒ«': 'ğŸ¤–'
  };
  
  // è¡¨ç¤º
  Object.keys(grouped).sort().forEach(key => {
    const [business, category] = key.split('|');
    const links = grouped[key];
    const color = businessColors[business] || '#6b7280';
    const icon = categoryIcons[category] || 'ğŸ“';
    
    html += `
      <div style="background:white; padding:20px; border-radius:12px; margin-bottom:15px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
        <h4 style="margin:0 0 15px 0; color:${color};">
          <span style="background:${color}; color:white; padding:3px 10px; border-radius:20px; font-size:12px; margin-right:10px;">${business}</span>
          ${icon} ${category} (${links.length}ä»¶)
        </h4>
        <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:10px;">
    `;
    
    links.forEach(link => {
      const displayName = link.name.length > 40 ? link.name.substring(0, 40) + '...' : link.name;
      html += `
        <a href="${link.url}" target="_blank" 
          style="display:block; padding:12px 15px; background:#f8f9fa; border-radius:8px; text-decoration:none; color:#333; border-left:3px solid ${color}; transition:all 0.2s;"
          onmouseover="this.style.background='#e5e7eb'; this.style.transform='translateX(5px)'" 
          onmouseout="this.style.background='#f8f9fa'; this.style.transform='translateX(0)'">
          <span style="font-size:13px;">${displayName}</span>
        </a>
      `;
    });
    
    html += '</div></div>';
  });
  
  if (filtered.length === 0) {
    html += '<div style="text-align:center; padding:40px; color:#666;">è©²å½“ã™ã‚‹ãƒªãƒ³ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“</div>';
  }
  
  container.innerHTML = html;
}

</script>




</body>
</html>
